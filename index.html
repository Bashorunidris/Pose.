<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Record & Edit - Full Flow</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #4C1D95;
            --primary-light: #6D28D9;
            --primary-dark: #3B0764;
            --accent: #FF0050;
            --success: #10b981;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background: #000;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #fff;
            -webkit-font-smoothing: antialiased;
        }

        /* ====== SCREEN WRAPPER ====== */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.4s ease;
            z-index: 1;
        }

        .screen.hidden {
            opacity: 0;
            pointer-events: none;
            z-index: 0;
        }

        /* ====== RECORDING SCREEN ====== */
        .record-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .record-video-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 9/16;
            background: #1a1a2e;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex: 1;
            border-radius: 0;
        }

        #recordVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }

        /* Camera Placeholder */
        .camera-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            height: 100%;
            color: rgba(255, 255, 255, 0.5);
        }

        .camera-placeholder i {
            font-size: 80px;
            opacity: 0.2;
        }

        .camera-placeholder p {
            text-align: center;
            font-size: 16px;
            font-weight: 500;
        }

        /* Recording Status Bar */
        .record-status-bar {
            position: absolute;
            top: 16px;
            left: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.8);
            padding: 12px 16px;
            border-radius: 20px;
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            font-weight: 600;
            z-index: 10;
        }

        .record-status-bar.active {
            display: flex;
        }

        .record-dot {
            width: 10px;
            height: 10px;
            background: #FF0050;
            border-radius: 50%;
            animation: pulse 1.2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Timer Display */
        .record-timer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 56px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: #FF0050;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        /* Control Buttons */
        .record-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 20;
        }

        .record-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.4);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
        }

        .record-btn:hover {
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.08);
        }

        .record-inner {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent);
            transition: var(--transition);
        }

        .record-btn.recording .record-inner {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .record-action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .record-action-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .record-action-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* ====== EDIT SCREEN ====== */
        .edit-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .edit-video-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            aspect-ratio: 9/16;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex: 1;
        }

        #editVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
            display: block !important;
        }

        /* Edit Top Bar */
        .edit-top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            z-index: 100;
        }

        .top-back-btn,
        .top-next-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .top-back-btn {
            background: rgba(255, 255, 255, 0.2);
        }

        .top-back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .top-title {
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .top-next-btn {
            background: var(--accent);
            font-weight: 700;
        }

        .top-next-btn:hover {
            transform: scale(1.1);
        }

        /* Edit Right Panel */
        .edit-right-panel {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 50;
        }

        .edit-side-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .edit-side-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.1);
        }

        .edit-side-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 0, 80, 0.5);
        }

        /* Time Indicator */
        .time-indicator {
            position: absolute;
            bottom: 20px;
            left: 16px;
            background: rgba(0, 0, 0, 0.6);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 5;
        }

        /* Edit Bottom Sheet */
        .edit-bottom-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.95) 100%);
            padding: 40px 16px 30px;
            max-height: 50vh;
            overflow-y: auto;
            z-index: 40;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }

        .sheet-handle {
            width: 40px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            margin: -30px auto 20px;
        }

        .edit-tool-section {
            margin-bottom: 24px;
        }

        .tool-section-title {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Speed Buttons */
        .speed-group {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .speed-btn {
            padding: 10px 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: var(--transition);
        }

        .speed-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .speed-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(255, 0, 80, 0.4);
        }

        /* Effects Carousel */
        .effects-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 8px;
            scrollbar-width: none;
        }

        .effects-scroll::-webkit-scrollbar {
            display: none;
        }

        .effect-btn {
            flex-shrink: 0;
            width: 60px;
            aspect-ratio: 1;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: var(--transition);
            font-size: 24px;
        }

        .effect-btn span:last-child {
            font-size: 12px;
            font-weight: 600;
        }

        .effect-btn:hover {
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-4px);
        }

        .effect-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(255, 0, 80, 0.5);
        }

        /* Trim section */
        .trim-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .trim-info {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .trim-slider {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .trim-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 0, 80, 0.6);
        }

        .trim-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(255, 0, 80, 0.6);
        }

        /* Volume */
        .volume-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .volume-slider {
            flex: 1;
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            border: none;
        }

        .volume-value {
            font-size: 12px;
            font-weight: 600;
            min-width: 35px;
        }

        /* Action Buttons */
        .edit-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .action-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .action-btn-save {
            background: var(--accent);
            color: #fff;
        }

        .action-btn-save:hover {
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(255, 0, 80, 0.5);
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        .notification.show {
            display: flex;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .speed-group {
                grid-template-columns: repeat(3, 1fr);
            }

            .record-btn {
                width: 70px;
                height: 70px;
            }

            .record-inner {
                width: 50px;
                height: 50px;
            }

            .record-btn.recording .record-inner {
                width: 35px;
                height: 35px;
            }

            .record-timer {
                font-size: 40px;
            }
        }
    </style>
</head>

<body>
    <!-- RECORDING SCREEN -->
    <div class="screen record-screen" id="recordScreen">
        <div class="record-video-wrapper">
            <video id="recordVideo" playsinline autoplay muted></video>
            <div class="camera-placeholder" id="cameraPlaceholder">
                <i class="fas fa-video"></i>
                <p>Click to start recording</p>
            </div>

            <div class="record-status-bar" id="recordStatusBar">
                <div class="record-dot"></div>
                <span>Recording...</span>
            </div>

            <div class="record-timer" id="recordTimer">0:00</div>

            <div class="record-controls">
                <button class="record-action-btn" id="switchCameraBtn" onclick="switchCamera()" title="Switch Camera">
                    <i class="fas fa-sync"></i>
                </button>
                <button class="record-btn" id="recordBtn" onclick="toggleRecord()">
                    <div class="record-inner"></div>
                </button>
                <button class="record-action-btn" id="flashBtn" onclick="toggleFlash()" title="Flash">
                    <i class="fas fa-bolt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- EDIT SCREEN -->
    <div class="screen edit-screen hidden" id="editScreen">
        <div class="edit-video-wrapper">
            <div class="edit-top-bar">
                <button class="top-back-btn" onclick="backToRecord()">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="top-title">Edit Video</div>
                <button class="top-next-btn" onclick="uploadVideo()">‚úì</button>
            </div>

            <video id="editVideo" playsinline autoplay muted style="width: 100%; height: 100%; background: #000;"></video>

            <div class="time-indicator" id="timeIndicator">0:00</div>

            <!-- Right Side Buttons -->
            <div class="edit-right-panel">
                <button class="edit-side-btn" onclick="toggleEditTool('trim')" title="Trim">
                    <i class="fas fa-cut"></i>
                </button>
                <button class="edit-side-btn" onclick="toggleEditTool('speed')" title="Speed">
                    <i class="fas fa-tachometer-alt"></i>
                </button>
                <button class="edit-side-btn active" onclick="toggleEditTool('effects')" title="Effects">
                    <i class="fas fa-palette"></i>
                </button>
                <button class="edit-side-btn" onclick="toggleEditTool('volume')" title="Volume">
                    <i class="fas fa-volume-up"></i>
                </button>
            </div>
        </div>

        <!-- Bottom Sheet -->
        <div class="edit-bottom-sheet">
            <div class="sheet-handle"></div>

            <!-- Trim Tool -->
            <div class="edit-tool-section" id="trimTool" style="display: none;">
                <div class="tool-section-title">
                    <i class="fas fa-cut"></i> Trim
                </div>
                <div class="trim-section">
                    <div class="trim-info">
                        <span id="trimStartTime">Start: 0:00</span>
                        <span id="trimEndTime">End: --</span>
                    </div>
                    <input type="range" class="trim-slider" min="0" value="0" oninput="updateTrimStart(this)">
                    <input type="range" class="trim-slider" value="0" oninput="updateTrimEnd(this)">
                </div>
            </div>

            <!-- Speed Tool -->
            <div class="edit-tool-section" id="speedTool" style="display: none;">
                <div class="tool-section-title">
                    <i class="fas fa-tachometer-alt"></i> Speed
                </div>
                <div class="speed-group">
                    <button class="speed-btn" onclick="setSpeed(0.5, this)">0.5x</button>
                    <button class="speed-btn" onclick="setSpeed(0.75, this)">0.75x</button>
                    <button class="speed-btn active" onclick="setSpeed(1, this)">1x</button>
                    <button class="speed-btn" onclick="setSpeed(1.5, this)">1.5x</button>
                    <button class="speed-btn" onclick="setSpeed(2, this)">2x</button>
                </div>
            </div>

            <!-- Effects Tool -->
            <div class="edit-tool-section" id="effectsTool">
                <div class="tool-section-title">
                    <i class="fas fa-palette"></i> Effects
                </div>
                <div class="effects-scroll">
                    <button class="effect-btn active" onclick="selectEffect(this, 'Normal')">
                        <span>‚≠ò</span>
                        <span>Normal</span>
                    </button>
                    <button class="effect-btn" onclick="selectEffect(this, 'Sepia')">
                        <span>üü§</span>
                        <span>Sepia</span>
                    </button>
                    <button class="effect-btn" onclick="selectEffect(this, 'B&W')">
                        <span>‚¨ú</span>
                        <span>B&W</span>
                    </button>
                    <button class="effect-btn" onclick="selectEffect(this, 'Cool')">
                        <span>üîµ</span>
                        <span>Cool</span>
                    </button>
                    <button class="effect-btn" onclick="selectEffect(this, 'Warm')">
                        <span>üî¥</span>
                        <span>Warm</span>
                    </button>
                    <button class="effect-btn" onclick="selectEffect(this, 'Vintage')">
                        <span>üìΩÔ∏è</span>
                        <span>Retro</span>
                    </button>
                </div>
            </div>

            <!-- Volume Tool -->
            <div class="edit-tool-section" id="volumeTool" style="display: none;">
                <div class="tool-section-title">
                    <i class="fas fa-volume-up"></i> Volume
                </div>
                <div class="volume-section">
                    <input type="range" class="volume-slider" min="0" max="100" value="100" oninput="updateVolume(this)">
                    <div class="volume-value" id="volumeValue">100%</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="edit-action-buttons">
                <button class="action-btn action-btn-cancel" onclick="resetEdits()">
                    <i class="fas fa-redo"></i> Reset
                </button>
                <button class="action-btn action-btn-save" onclick="saveEdits()">
                    <i class="fas fa-check"></i> Save
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Done!</span>
    </div>

    <script>
        let mediaStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let recordingTime = 0;
        let recordingInterval = null;
        let recordedBlob = null;
        let facingMode = 'user';

        // Initialize camera
        async function initCamera() {
            try {
                mediaStream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: facingMode, width: { ideal: 1280 }, height: { ideal: 1920 } },
                    audio: true
                });
                document.getElementById('recordVideo').srcObject = mediaStream;
                document.getElementById('cameraPlaceholder').style.display = 'none';
            } catch (err) {
                console.error('Camera error:', err);
                document.getElementById('cameraPlaceholder').innerHTML = `
                    <i class="fas fa-ban"></i>
                    <p>Camera access denied<br><br>Using demo mode - click record to test</p>
                `;
            }
        }

        // Toggle recording
        function toggleRecord() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        function startRecording() {
            if (!mediaStream && !document.getElementById('recordVideo').srcObject) {
                // Demo mode - simulate recording
                simulateRecording();
                return;
            }

            recordedChunks = [];
            try {
                // Try different codecs for compatibility
                let options = { mimeType: 'video/webm;codecs=vp9' };
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options = { mimeType: 'video/webm;codecs=vp8' };
                }
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options = { mimeType: 'video/webm' };
                }
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options = {};
                }
                
                console.log('Using codec:', options.mimeType || 'default');
                mediaRecorder = new MediaRecorder(mediaStream, options);

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });
                    startEditing();
                };

                mediaRecorder.start();
                isRecording = true;
                recordingTime = 0;

                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordStatusBar').classList.add('active');
                document.getElementById('recordTimer').textContent = '0:00';

                recordingInterval = setInterval(() => {
                    recordingTime++;
                    const mins = Math.floor(recordingTime / 60);
                    const secs = recordingTime % 60;
                    document.getElementById('recordTimer').textContent = `${mins}:${String(secs).padStart(2, '0')}`;
                }, 1000);

                showNotification('Recording started...');
            } catch (err) {
                console.error('Recording error:', err);
                simulateRecording();
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            isRecording = false;
            clearInterval(recordingInterval);

            document.getElementById('recordBtn').classList.remove('recording');
            document.getElementById('recordStatusBar').classList.remove('active');

            showNotification('Recording stopped! Opening editor...');
            
            // In demo mode, transition to edit after a brief delay
            if (recordedChunks.length === 0) {
                setTimeout(() => startEditing(), 800);
            }
        }

        function simulateRecording() {
            isRecording = true;
            recordingTime = 0;

            document.getElementById('recordBtn').classList.add('recording');
            document.getElementById('recordStatusBar').classList.add('active');
            document.getElementById('recordTimer').textContent = '0:00';

            recordingInterval = setInterval(() => {
                recordingTime++;
                const mins = Math.floor(recordingTime / 60);
                const secs = recordingTime % 60;
                document.getElementById('recordTimer').textContent = `${mins}:${String(secs).padStart(2, '0')}`;
            }, 1000);

            showNotification('Demo Recording started...');
        }

        function switchCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
            }
            facingMode = facingMode === 'user' ? 'environment' : 'user';
            initCamera();
            showNotification('Camera switched');
        }

        function toggleFlash() {
            showNotification('Flash toggled');
        }

        // EDIT SCREEN FUNCTIONS
        function startEditing() {
            document.getElementById('recordScreen').classList.add('hidden');
            document.getElementById('editScreen').classList.remove('hidden');

            // Set up video for editing
            const editVideo = document.getElementById('editVideo');
            
            if (recordedBlob && recordedChunks.length > 0) {
                console.log('Loading recorded video...');
                const videoURL = URL.createObjectURL(recordedBlob);
                editVideo.src = videoURL;
                
                editVideo.onloadedmetadata = () => {
                    console.log('Video loaded, duration:', editVideo.duration);
                    const duration = Math.floor(editVideo.duration);
                    document.getElementById('trimStartTime').textContent = `Start: 0:00`;
                    document.getElementById('trimEndTime').textContent = `End: ${Math.floor(duration / 60)}:${String(duration % 60).padStart(2, '0')}`;
                    
                    document.querySelectorAll('.trim-slider')[0].max = duration;
                    document.querySelectorAll('.trim-slider')[1].max = duration;
                    document.querySelectorAll('.trim-slider')[1].value = duration;
                };

                editVideo.onerror = () => {
                    console.error('Video load error');
                    editVideo.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                };
            } else {
                // Demo mode - show gradient background
                console.log('Demo mode - no recorded video');
                editVideo.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                editVideo.src = '';
                
                // Set demo duration
                document.getElementById('trimStartTime').textContent = `Start: 0:00`;
                document.getElementById('trimEndTime').textContent = `End: 0:15`;
                document.querySelectorAll('.trim-slider')[0].max = 15;
                document.querySelectorAll('.trim-slider')[1].max = 15;
                document.querySelectorAll('.trim-slider')[1].value = 15;
            }

            showNotification('Video ready to edit!');
        }

        function backToRecord() {
            if (confirm('Go back to recording? Changes will be lost.')) {
                document.getElementById('editScreen').classList.add('hidden');
                document.getElementById('recordScreen').classList.remove('hidden');
                initCamera();
            }
        }

        function toggleEditTool(tool) {
            document.getElementById('trimTool').style.display = 'none';
            document.getElementById('speedTool').style.display = 'none';
            document.getElementById('effectsTool').style.display = 'none';
            document.getElementById('volumeTool').style.display = 'none';

            document.querySelectorAll('.edit-side-btn').forEach(btn => btn.classList.remove('active'));

            document.getElementById(tool + 'Tool').style.display = 'block';
            event.target.closest('.edit-side-btn').classList.add('active');
        }

        function updateTrimStart(input) {
            const value = parseInt(input.value);
            const mins = Math.floor(value / 60);
            const secs = value % 60;
            document.getElementById('trimStartTime').textContent = `Start: ${mins}:${String(secs).padStart(2, '0')}`;
        }

        function updateTrimEnd(input) {
            const value = parseInt(input.value);
            const mins = Math.floor(value / 60);
            const secs = value % 60;
            document.getElementById('trimEndTime').textContent = `End: ${mins}:${String(secs).padStart(2, '0')}`;
        }

        function setSpeed(speed, btn) {
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            showNotification(`Speed: ${speed}x`);
        }

        function selectEffect(btn, name) {
            document.querySelectorAll('.effect-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            showNotification(`${name} applied`);
        }

        function updateVolume(input) {
            document.getElementById('volumeValue').textContent = input.value + '%';
        }

        function resetEdits() {
            if (confirm('Reset all edits?')) {
                document.querySelectorAll('.speed-btn')[2].click();
                document.querySelectorAll('.effect-btn')[0].click();
                document.querySelector('.volume-slider').value = 100;
                updateVolume(document.querySelector('.volume-slider'));
                showNotification('Edits reset');
            }
        }

        function saveEdits() {
            showNotification('Saving video...');
            setTimeout(() => {
                showNotification('Video saved!');
            }, 800);
        }

        function uploadVideo() {
            alert('‚úì Video saved and ready to upload!');
        }

        function showNotification(text) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationText').textContent = text;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // Initialize
        window.addEventListener('load', initCamera);
    </script>
</body>

</html>

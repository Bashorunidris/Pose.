<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose - African Creator Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* ====== CSS Variables for Theme ====== */
        :root {
            --primary: #4C1D95;
            --primary-light: #6D28D9;
            --primary-dark: #3B0764;
            --bg-main: #f7f8fb;
            --bg-card: #ffffff;
            --text-primary: #111;
            --text-secondary: #666;
            --text-muted: #999;
            --border: #e5e7eb;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ====== Reset & Base ====== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        html {
            scroll-behavior: smooth
        }

        html,
        body {
            height: 100%;
            overflow-x: hidden
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-main);
            -webkit-font-smoothing: antialiased;
        }

        a {
            color: inherit;
            text-decoration: none;
            transition: var(--transition)
        }

        button {
            font-family: inherit;
            cursor: pointer;
            transition: var(--transition)
        }

        img {
            max-width: 100%;
            display: block
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #1a1a1a;
            border-radius: var(--radius-md);
            padding: 30px;
            width: 90%;
            max-width: 400px;
            color: white;
            position: relative;
            box-shadow: var(--shadow-lg);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal h2 {
            margin: 0 0 20px 0;
            font-size: 24px;
        }

        .modal input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background: #2a2a2a;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 14px;
            transition: var(--transition);
        }

        .modal input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: var(--transition);
        }

        .modal-btn:hover {
            opacity: 0.9;
        }

        .modal-switch {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #aaa;
        }

        .modal-switch a {
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
        }

        .error-msg {
            background: var(--primary);
            padding: 10px;
            border-radius: var(--radius-sm);
            margin-bottom: 15px;
            font-size: 14px;
            box-shadow: var(--shadow-sm);
        }

        /* ====== UPLOAD PROGRESS CONTAINER ====== */
        .upload-progress-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background: #1a1a1a;
            border: 1px solid #4C1D95;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 2500;
            display: none;
            flex-direction: column;
            max-height: 500px;
        }

        .upload-progress-container.active {
            display: flex;
        }

        .upload-progress-header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #4C1D95, #6D28D9);
            border-radius: 12px 12px 0 0;
            user-select: none;
        }

        .upload-progress-header h3 {
            font-size: 14px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-progress-body {
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
        }

        .upload-progress-container.collapsed .upload-progress-body {
            display: none;
        }

        /* Step Item */
        .upload-step {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .step-icon.pending {
            background: #333;
            color: #888;
        }

        .step-icon.active {
            background: #4C1D95;
            color: white;
            animation: pulse 1s infinite;
        }

        .step-icon.completed {
            background: #22c55e;
            color: white;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .step-content {
            flex: 1;
        }

        .step-label {
            font-size: 13px;
            font-weight: 600;
            color: white;
            margin-bottom: 4px;
        }

        .step-progress {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
        }

        .step-bar {
            width: 100%;
            height: 4px;
            background: #222;
            border-radius: 2px;
            overflow: hidden;
            display: none;
        }

        .step-bar.active {
            display: block;
        }

        .step-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4C1D95, #6D28D9);
            width: 0%;
            transition: width 0.3s;
        }

        /* Overall Progress */
        .overall-progress {
            border-top: 1px solid #333;
            padding-top: 12px;
            margin-top: 8px;
        }

        .overall-bar {
            width: 100%;
            height: 6px;
            background: #222;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .overall-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4C1D95, #22c55e);
            width: 0%;
            transition: width 0.3s;
        }

        .overall-stats {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
        }

        /* ====== SUCCESS/ERROR MESSAGE MODAL ====== */
        .upload-result-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .upload-result-modal.active {
            display: flex;
        }

        .upload-result-content {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            max-width: 300px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            border: 1px solid #4C1D95;
        }

        .upload-result-thumbnail {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #4C1D95, #6D28D9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            overflow: hidden;
        }

        .upload-result-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-result-title {
            font-size: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .upload-result-message {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .upload-result-message.success {
            color: #86efac;
        }

        .upload-result-message.error {
            color: #fca5a5;
        }

        .upload-result-btn {
            background: linear-gradient(135deg, #4C1D95, #6D28D9);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .upload-result-btn:hover {
            opacity: 0.9;
        }

        /* Countdown Progress Bar */
        .upload-result-countdown {
            margin-top: 20px;
            text-align: center;
        }

        .upload-result-countdown-text {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .countdown-bar {
            width: 100%;
            height: 6px;
            background: #222;
            border-radius: 3px;
            overflow: hidden;
        }

        .countdown-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4C1D95, #22c55e);
            width: 100%;
            transition: width 0.1s linear;
        }

        .countdown-time {
            font-size: 20px;
            font-weight: bold;
            color: #4C1D95;
            margin-top: 10px;
        }

        /* ====== NOTIFICATIONS PAGE ====== */
        .notifications-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-main);
            z-index: 1999;
            display: none;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        .notifications-overlay.active {
            display: flex;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .notifications-header h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }

        .notifications-close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
            padding: 4px 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notifications-container {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .notification-item {
            display: flex;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-card);
        }

        .notification-item:hover {
            background: #f9fafb;
        }

        .notification-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            object-fit: cover;
        }

        .notification-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .notification-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .notification-time {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .notification-badge {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
            flex-shrink: 0;
            margin-top: 8px;
        }

        .notifications-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            gap: 12px;
            color: var(--text-muted);
            padding: 40px 20px;
        }

        .notifications-empty-icon {
            font-size: 48px;
            opacity: 0.5;
        }

        .notifications-empty-text {
            font-size: 16px;
            font-weight: 500;
        }

        /* ====== RECORDING UI OVERLAY ====== */
        .recording-ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 1998;
            display: none;
            flex-direction: column;
            animation: slideUpRecording 0.3s ease;
        }

        .recording-ui-overlay.active {
            display: flex;
        }

        @keyframes slideUpRecording {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        /* Main Recording Screen Container */
        .recording-screen {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
            flex-direction: column;
        }

        .recording-screen.active {
            display: flex;
        }

        /* Camera Preview */
        .camera-preview {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Ratio Guide Frame - Shows what will be captured */
        .ratio-guide-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid rgba(76, 29, 149, 0.7);
            border-radius: 8px;
            background: transparent;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.35);
            pointer-events: none;
            z-index: 8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.85;
        }

        /* Corner indicators for professional look */
        .ratio-guide-frame::before,
        .ratio-guide-frame::after {
            content: '';
            position: absolute;
            background: rgba(76, 29, 149, 0.8);
        }

        .ratio-guide-frame::before {
            width: 40px;
            height: 3px;
            top: -15px;
            left: -15px;
        }

        /* Top Bar */
        .rec-top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 10;
        }

        .rec-icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .rec-icon-btn:active {
            transform: scale(0.9);
        }

        /* Left Side Menu */
        .rec-left-menu {
            position: absolute;
            left: 20px;
            top: 80px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-10px) scale(0.95);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 9;
        }

        .rec-left-menu.show {
            opacity: 1;
            pointer-events: all;
            transform: translateY(0) scale(1);
        }

        .rec-menu-item {
            padding: 12px 20px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            color: #fff;
        }

        .rec-menu-item:active {
            transform: scale(0.95);
        }

        /* Right Side Effects */
        .rec-effects-bar {
            position: absolute;
            right: 20px;
            top: 80px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 9;
        }

        .rec-effect-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .rec-effect-icon:active {
            transform: scale(0.9);
        }

        /* Effect Filters */
        .camera-preview.effect-sparkle {
            filter: brightness(1.2) contrast(1.1);
        }

        .camera-preview.effect-mask {
            filter: saturate(1.5) hue-rotate(15deg);
        }

        .camera-preview.effect-ghost {
            filter: opacity(0.8) blur(2px) brightness(1.1);
        }

        .camera-preview.effect-star {
            filter: saturate(1.8) brightness(1.15) contrast(1.2);
        }

        /* Bottom Controls */
        .rec-bottom-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
        }

        .rec-control-row {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            width: 100%;
        }

        .rec-control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            background: none;
            border: none;
            color: #fff;
        }

        .rec-control-btn:active {
            transform: scale(0.9);
        }

        .rec-control-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .rec-control-label {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Record Button */
        .rec-record-btn-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
        }

        .rec-record-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 6px solid #fff;
            background: #ff0050;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .rec-record-btn:active {
            transform: scale(0.95);
        }

        .rec-record-btn.recording {
            border-radius: 15px;
            width: 60px;
            height: 60px;
        }

        /* Mode Tabs */
        .rec-mode-tabs {
            display: flex;
            justify-content: center;
            gap: 35px;
            padding: 15px 10px 10px 10px;
            position: relative;
        }

        .rec-mode-tab {
            font-size: 16px;
            opacity: 0.4;
            cursor: pointer;
            transition: all 0.3s ease;
            background: none;
            border: none;
            color: #fff;
            font-weight: 600;
            position: relative;
            padding: 8px 15px;
        }

        .rec-mode-tab:hover:not(.active) {
            opacity: 0.7;
        }

        .rec-mode-tab:active {
            transform: scale(0.95);
        }

        .rec-mode-tab.active {
            opacity: 1;
            font-size: 20px;
            color: #fff;
            text-shadow: 0 2px 8px rgba(255, 255, 255, 0.3);
        }

        .rec-mode-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: #fff;
            border-radius: 2px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* Photo Mode Controls */
        .photo-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .photo-control-row {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 30px;
            width: 100%;
        }

        .photo-control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            background: none;
            border: none;
            color: #fff;
        }

        .photo-control-btn:active {
            transform: scale(0.9);
        }

        .photo-record-btn-wrapper {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }

        .photo-record-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 5px solid #fff;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .photo-record-btn:active {
            transform: scale(0.92);
        }

        /* Photo Filters Panel - Vertical on Right, Responsive */
        .photo-filters-panel {
            position: absolute;
            right: 20px;
            top: 50px;
            width: 85px;
            height: auto;
            max-height: calc(100vh - 150px);
            border-radius: 20px;
            padding: 10px 6px;
            z-index: 99;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(20, 20, 20, 0.92);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .photo-filters-panel.show {
            display: block;
        }

        .photo-filters-scroll {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
            align-items: center;
            scroll-behavior: smooth;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .photo-filters-panel {
                right: 12px;
                top: 48px;
                width: 75px;
                padding: 8px 5px;
            }

            .photo-filters-scroll {
                gap: 8px;
            }
        }

        @media (max-width: 480px) {
            .photo-filters-panel {
                right: 10px;
                top: 45px;
                width: 65px;
                padding: 6px 4px;
            }

            .photo-filters-scroll {
                gap: 6px;
            }
        }

        .photo-filters-scroll::-webkit-scrollbar {
            width: 4px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .photo-filters-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .photo-filters-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            transition: background 0.3s;
        }

        .photo-filters-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .photo-filter-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: 1.5px solid transparent;
            cursor: pointer;
            padding: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #fff;
            font-size: 9px;
            border-radius: 10px;
            flex-shrink: 0;
            min-width: fit-content;
            position: relative;
        }

        .photo-filter-btn:hover {
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.08);
        }

        .photo-filter-btn:active {
            transform: scale(0.92);
        }

        .photo-filter-btn.active {
            border-color: #4C1D95;
            background: rgba(76, 29, 149, 0.3);
            box-shadow: 0 0 12px rgba(76, 29, 149, 0.5), inset 0 0 8px rgba(76, 29, 149, 0.2);
        }

        .photo-filter-btn.active .photo-filter-preview {
            border-color: #4C1D95;
            box-shadow: 0 0 15px rgba(76, 29, 149, 0.8);
        }

        .photo-filter-preview {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        /* Mobile Responsive Button Sizes */
        @media (max-width: 768px) {
            .photo-filter-btn {
                padding: 5px;
                gap: 3px;
                font-size: 8px;
                border-radius: 9px;
            }

            .photo-filter-preview {
                width: 48px;
                height: 48px;
                border: 1.3px solid rgba(255, 255, 255, 0.3);
            }
        }

        @media (max-width: 480px) {
            .photo-filter-btn {
                padding: 4px;
                gap: 2px;
                font-size: 7px;
                border-radius: 8px;
            }

            .photo-filter-preview {
                width: 40px;
                height: 40px;
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
        }

        /* Filter Preview Styles */
        .photo-filter-preview.original {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .photo-filter-preview.bw {
            background: linear-gradient(135deg, #333 0%, #666 100%);
            filter: grayscale(100%);
        }

        .photo-filter-preview.sepia {
            background: linear-gradient(135deg, #8b6f47 0%, #a0826d 100%);
            filter: sepia(100%);
        }

        .photo-filter-preview.vintage {
            background: linear-gradient(135deg, #8b7355 0%, #a08575 100%);
            filter: sepia(50%) contrast(90%) brightness(90%);
        }

        .photo-filter-preview.vivid {
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 100%);
            filter: saturate(150%) contrast(110%);
        }

        .photo-filter-preview.warm {
            background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%);
            filter: brightness(110%) saturate(130%);
        }

        .photo-filter-preview.cool {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            filter: hue-rotate(-20deg) saturate(120%);
        }

        .photo-filter-btn:hover .photo-filter-preview {
            border-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        /* ====== RECORDING CONTROLS - SCREEN 2 ====== */
        .rec-recording-controls {
            position: absolute;
            bottom: 40px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 40px;
        }

        .rec-recording-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rec-recording-btn.stop {
            width: 70px;
            height: 70px;
            border: 6px solid #fff;
            background: #ff0050;
        }

        .rec-recording-btn:active {
            transform: scale(0.9);
        }

        /* ====== EDIT CONTROLS - SCREEN 3 ====== */
        .rec-edit-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
        }

        .rec-add-sound-btn {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .rec-add-sound-btn:active {
            transform: scale(0.98);
        }

        .rec-action-buttons {
            display: flex;
            gap: 10px;
        }

        .rec-action-btn {
            flex: 1;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .rec-action-btn.draft {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .rec-action-btn.story {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .rec-action-btn.post {
            background: #ff0050;
            color: #fff;
        }

        /* ====== TEXT MODE STYLING ====== */
        /* Color Picker Bar */
        .rec-color-picker-bar {
            position: absolute;
            top: 80px;
            left: 0;
            right: 0;
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            overflow-x: auto;
            z-index: 10;
        }

        /* Text Mode Styles */
        .rec-text-editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .rec-color-option {
            min-width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .rec-color-option:hover {
            transform: scale(1.1);
        }

        .rec-color-option.active {
            border-color: #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .text-canvas {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: background 0.3s;
        }

        .rec-text-input {
            width: 100%;
            max-width: 500px;
            min-height: 200px;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 32px;
            font-weight: 600;
            text-align: center;
            resize: none;
            outline: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .rec-text-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .char-count {
            position: absolute;
            bottom: 120px;
            right: 20px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10;
        }

        .rec-text-tools {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
        }


        .rec-text-tool-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .rec-text-tool-btn:active {
            transform: scale(0.9);
        }

        .rec-text-tool-btn.active {
            background: #ff0050;
        }

        .rec-text-bottom-action {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 10;
        }

        .rec-text-next-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ff0050;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(255, 0, 80, 0.4);
        }

        .rec-text-next-btn:active {
            transform: scale(0.9);
        }

        /* ====== TOGGLE SWITCH ====== */
        .rec-toggle-switch {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .rec-toggle-switch input {
            display: none;
        }

        .rec-toggle-slider {
            position: relative;
            width: 50px;
            height: 28px;
            background: #444;
            border-radius: 20px;
            transition: background 0.3s;
        }

        .rec-toggle-slider::before {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .rec-toggle-switch input:checked+.rec-toggle-slider {
            background: #ff0050;
        }

        .rec-toggle-switch input:checked+.rec-toggle-slider::before {
            left: 24px;
        }

        /* Text Preview Thumbnail */
        .rec-text-preview-thumbnail {
            width: 100px;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            padding: 10px;
            text-align: center;
            word-break: break-word;
        }

        /* ====== POPUPS ====== */
        .rec-popup {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a1a;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
            z-index: 2100;
            display: none;
            flex-direction: column;
            animation: slideUpPopup 0.3s ease;
        }

        .rec-popup.active {
            display: flex;
        }

        @keyframes slideUpPopup {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .rec-popup-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rec-popup-header {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .rec-popup-tab {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 14px;
            padding: 8px 12px;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .rec-popup-tab.active {
            color: #ff0050;
            border-bottom-color: #ff0050;
        }

        .rec-popup-content {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .rec-popup-item {
            aspect-ratio: 1;
            background: #222;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .rec-popup-item:active {
            transform: scale(0.95);
            background: #333;
            border-color: #ff0050;
        }

        /* ====== POST SETTINGS SECTIONS ====== */
        /* Toggle Section */
        .toggle-section {
            display: flex;
            justify-content: space-between !important;
            align-items: center !important;
        }

        .rec-post-section.toggle-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rec-action-btn:active {
            transform: scale(0.98);
        }

        /* ====== POST SETTINGS SCREEN ====== */
        .rec-post-header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rec-post-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        .rec-post-section {
            margin-bottom: 20px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rec-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            font-size: 15px;
            font-weight: 500;
            color: #fff;
        }

        .rec-caption-input {
            width: 100%;
            min-height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            color: #fff;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
        }

        .rec-caption-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .rec-input-field {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
        }

        .rec-input-field::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .rec-post-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        /* ====== RECORDING INDICATOR - SCREEN 2 ====== */
        .rec-recording-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 15px;
            background: rgba(255, 0, 80, 0.9);
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 11;
        }

        .rec-rec-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #fff;
            animation: recPulse 1.5s infinite;
        }

        @keyframes recPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* ====== RECORDING UI TOAST ====== */
        .recording-toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(20px);
            padding: 15px 25px;
            border-radius: 25px;
            color: #fff;
            font-size: 14px;
            z-index: 2001;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recording-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .recording-toast-icon {
            font-size: 16px;
        }

        .recording-toast.success {
            background: rgba(67, 233, 123, 0.95);
        }

        .recording-toast.error {
            background: rgba(255, 0, 80, 0.95);
        }

        .recording-toast.info {
            background: rgba(79, 172, 254, 0.95);
        }

        /* ====== TIKTOK-STYLE COUNTDOWN MODAL ====== */
        .tiktok-countdown-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3500;
        }

        .tiktok-countdown-modal.active {
            display: flex;
        }

        .tiktok-countdown-content {
            text-align: center;
        }

        .tiktok-countdown-number {
            font-size: 180px;
            font-weight: 900;
            color: white;
            line-height: 1;
            text-shadow: 0 10px 30px rgba(76, 29, 149, 0.5);
            animation: countdownScale 1s ease-in forwards;
        }

        @keyframes countdownScale {
            0% {
                transform: scale(1.5);
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ====== PRICE OPTIONS ====== */
        .price-options-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .price-options {
            display: flex;
            gap: 8px;
            flex: 1;
        }

        .price-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #333;
            background: #222;
            color: #aaa;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s;
        }

        .price-btn:hover {
            border-color: #4C1D95;
            color: white;
        }

        .price-btn.active {
            border-color: #4C1D95;
            background: #4C1D95;
            color: white;
        }

        .price-info-icon {
            background: none;
            border: none;
            color: #4C1D95;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: color 0.3s;
        }

        .price-info-icon:hover {
            color: #6D28D9;
        }

        /* Tooltip */
        .price-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            margin-bottom: 8px;
            border: 1px solid #4C1D95;
            display: none;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .price-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #4C1D95;
        }

        .price-info-icon:hover .price-tooltip {
            display: block;
        }

        /* Profile Page Styles */
        .profile-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 1500;
            overflow-y: auto;
        }

        .profile-page.active {
            display: block;
        }

        .profile-header {
            position: relative;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
        }

        .profile-back-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
        }

        .profile-settings-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
        }

        .profile-info-section {
            position: relative;
            margin-top: -50px;
            padding: 0 20px;
        }

        .profile-pic-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid #000;
            background: #333;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            font-weight: bold;
        }

        .profile-name {
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-top: 15px;
        }

        .profile-username {
            text-align: center;
            color: #888;
            font-size: 16px;
            margin-top: 5px;
        }

        .profile-bio {
            text-align: center;
            color: #aaa;
            font-size: 14px;
            margin-top: 15px;
            line-height: 1.4;
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px 0;
            border-top: 1px solid #222;
            border-bottom: 1px solid #222;
        }

        .stat {
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .profile-tabs {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            background: #111;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .profile-tab {
            color: #888;
            font-size: 14px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
        }

        .profile-tab.active {
            color: white;
            background: #222;
        }

        .profile-content {
            padding: 20px;
            min-height: 400px;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
        }

        .video-item {
            aspect-ratio: 9/16;
            background: #222;
            position: relative;
            cursor: pointer;
        }

        .video-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-stats {
            position: absolute;
            bottom: 5px;
            left: 5px;
            right: 5px;
            color: white;
            font-size: 11px;
            display: flex;
            gap: 8px;
        }

        .post-section {
            background: #111;
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .post-input {
            width: 100%;
            min-height: 100px;
            background: #222;
            border: 1px solid #333;
            border-radius: var(--radius-sm);
            color: white;
            padding: 12px;
            font-size: 14px;
            resize: vertical;
        }

        .post-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .post-btn {
            flex: 1;
            padding: 10px;
            background: var(--primary);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-btn:hover {
            background: var(--primary-light);
        }

        .feed-post {
            background: #111;
            border-radius: var(--radius-md);
            padding: 15px;
            margin-bottom: 15px;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
        }

        .post-author {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .post-text {
            color: #ddd;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .post-stats {
            display: flex;
            gap: 20px;
            color: #888;
            font-size: 13px;
        }

        /* Original Feed Styles */
        .video-feed {
            height: 100%;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
        }

        .video-post {
            position: relative;
            height: 100vh;
            width: 100%;
            scroll-snap-align: start;
            overflow: hidden;
            background: #111;
            cursor: pointer;
        }

        .video-post video {
            height: 100%;
            width: 100%;
            object-fit: cover;
        }

        .play-pause-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }

        .play-pause-overlay.show {
            opacity: 1;
        }

        .play-pause-overlay svg {
            width: 40px;
            height: 40px;
            fill: white;
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            color: white;
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 20px;
            background: #0a0a0a;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #222;
        }

        .profile-icon {
            position: absolute;
            left: 20px;
            font-size: 22px;
            background: rgba(76, 29, 149, 0.8);
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            border: 2px solid var(--primary-light);
            flex-shrink: 0;
        }

        .profile-icon:hover {
            background: rgba(76, 29, 149, 1);
            transform: scale(1.1);
        }

        .profile-icon img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .tabs {
            display: flex;
            gap: 15px;
            font-size: 18px;
            font-weight: 500;
        }

        .tabs span {
            cursor: pointer;
            position: relative;
            color: white;
        }

        .tabs .active::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            right: 0;
            margin: auto;
            width: 60%;
            height: 2px;
            background: white;
        }

        .search-icon {
            position: absolute;
            right: 20px;
            background: white;
            border-radius: 50%;
            padding: 8px;
            font-size: 18px;
            color: black;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .sidebar {
            position: absolute;
            right: 10px;
            top: 30%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            font-size: 14px;
        }

        .sidebar div {
            text-align: center;
        }

        .sidebar i {
            font-size: 26px;
            display: block;
            margin-bottom: 5px;
        }

        .profile-section {
            position: absolute;
            bottom: 280px;
            left: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            right: 80px;
            transition: bottom 0.3s ease;
        }

        .profile-section.ad-closed {
            bottom: 150px;
        }

        .profile-pic {
            position: relative;
            width: 50px;
            height: 50px;
            flex-shrink: 0;
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .infinity-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: black;
            border: 2px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 0;
        }

        .profile-info .name {
            font-weight: bold;
            font-size: 16px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-info .followers {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        }

        .follow-btn {
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            border: none;
            outline: none;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(76, 29, 149, 0.3);
            flex-shrink: 0;
        }

        .ad-caption {
            position: absolute;
            bottom: 210px;
            left: 10px;
            font-size: 13px;
            max-width: 280px;
            line-height: 1.4em;
            transition: bottom 0.3s ease;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .ad-caption.ad-closed {
            bottom: 80px;
        }

        .banner-ad {
            position: absolute;
            bottom: 100px;
            left: 10px;
            width: 250px;
            height: 130px;
            border-radius: var(--radius-sm);
            overflow: hidden;
            background: var(--bg-card);
            transition: var(--transition);
            box-shadow: var(--shadow-md);
        }

        .banner-ad.hidden {
            opacity: 0;
            transform: translateX(-100%);
            pointer-events: none;
        }

        .banner-ad img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .bottom-nav {
            position: fixed;
            bottom: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 14px;
            z-index: 1000;
            color: white;
        }

        .bottom-nav div {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .bottom-nav i {
            font-size: 24px;
            margin-bottom: 3px;
        }

        /* Edit Profile Styles */
        .edit-profile-btn {
            position: absolute;
            top: 15px;
            right: 60px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .profile-pic-upload {
            position: relative;
            display: inline-block;
        }

        .profile-pic-large {
            background-size: cover;
            background-position: center;
        }

        .upload-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid #000;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ========== VIDEO GRID PAGE ========== */
        .video-grid-page {
            background: #000;
            min-height: 100vh;
            padding: 70px 0 90px 0;
        }

        .grid-page-header {
            padding: 20px;
            border-bottom: 1px solid #222;
            background: #0a0a0a;
        }

        .grid-page-header h1 {
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .video-grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 15px;
        }

        .grid-video-card {
            background: #111;
            border-radius: var(--radius-sm);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .grid-video-card:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-md);
        }

        .grid-thumbnail {
            width: 100%;
            aspect-ratio: 9/16;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .play-overlay {
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .grid-video-info {
            padding: 10px;
            background: #0a0a0a;
        }

        .grid-video-title {
            color: white;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .grid-video-stats {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .grid-video-stats .views,
        .grid-video-stats .earnings {
            color: #888;
            font-size: 11px;
            font-weight: 500;
        }

        .grid-video-stats .earnings {
            color: #4ecdc4;
            font-weight: 600;
        }

        /* ========== TWEET FEED PAGE ========== */
        .tweet-feed-page {
            background: #000;
            min-height: 100vh;
            padding: 70px 0 90px 0;
        }

        .create-post-card {
            background: #0a0a0a;
            border-bottom: 1px solid #222;
            padding: 20px;
            margin-bottom: 10px;
        }

        .create-post-header {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
            flex-shrink: 0;
        }

        .create-post-input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            font-family: Arial, sans-serif;
            resize: none;
            min-height: 60px;
            line-height: 1.5;
        }

        .create-post-input:focus {
            outline: none;
        }

        .create-post-input::placeholder {
            color: #555;
        }

        .create-post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-left: 57px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-icon-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .action-icon-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        .post-submit-btn {
            background: linear-gradient(45deg, var(--primary), var(--primary-light));
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .post-submit-btn:hover {
            opacity: 0.9;
            box-shadow: var(--shadow-md);
        }

        /* Timeline Posts */
        .feed-timeline {
            padding: 0;
        }

        .timeline-post {
            background: #0a0a0a;
            border-bottom: 1px solid #222;
            padding: 20px;
        }

        .post-user-info {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            color: white;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .verified {
            color: #1da1f2;
            font-size: 14px;
        }

        .user-handle {
            color: #666;
            font-size: 13px;
        }

        .post-content {
            margin-bottom: 12px;
        }

        .post-text {
            color: #e0e0e0;
            font-size: 15px;
            line-height: 1.5;
            margin: 0 0 12px 0;
        }

        .post-media {
            margin-top: 10px;
        }

        .media-thumbnail {
            width: 100%;
            border-radius: var(--radius-md);
        }

        .post-interactions {
            display: flex;
            gap: 20px;
            padding-top: 12px;
            border-top: 1px solid #1a1a1a;
        }

        .interaction-btn {
            color: #666;
            font-size: 13px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .interaction-btn:hover {
            color: #888;
        }

        .tip-btn {
            color: #4ecdc4;
            font-weight: 600;
        }

        .tip-btn:hover {
            color: #6ee7df;
        }

        /* Load More Section */
        .load-more-section {
            text-align: center;
            padding: 30px 20px;
        }

        .load-more-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 10px;
        }

        .load-more-btn:hover {
            background: #222;
            border-color: #444;
        }

        .load-more-text {
            color: #666;
            font-size: 12px;
            margin: 10px 0 0 0;
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .video-grid-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
                padding: 10px;
            }

            .grid-video-title {
                font-size: 11px;
            }

            .grid-video-stats {
                font-size: 10px;
            }

            .action-buttons {
                flex-wrap: wrap;
            }

            .action-icon-btn {
                font-size: 11px;
                padding: 5px 10px;
            }
        }

        /* Improve touch scrolling on mobile */
        body {
            overscroll-behavior-y: contain;
        }

        /* Prevent body scroll when tabs are active */
        body.tab-active {
            overflow: hidden;
        }

        /* Tab Content Scrolling */
        .tab-content {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: scroll;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            z-index: 100;
        }

        .tab-content.active {
            display: block;
        }

        /* Video Grid Page Scrollable */
        .video-grid-page {
            background: #000;
            min-height: 100vh;
            padding: 70px 0 90px 0;
            overflow-y: auto;
        }

        /* Tweet Feed Page Scrollable */
        .tweet-feed-page {
            background: #000;
            min-height: 100vh;
            padding: 70px 0 90px 0;
            overflow-y: auto;
        }

        /* Ensure video feed is also scrollable */
        .video-feed {
            height: 100vh;
            width: 100%;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }

        /* Hide scrollbar but keep functionality */
        .tab-content::-webkit-scrollbar,
        .video-grid-page::-webkit-scrollbar,
        .tweet-feed-page::-webkit-scrollbar,
        .video-feed::-webkit-scrollbar {
            width: 0px;
            display: none;
        }

        /* For Firefox */
        .tab-content,
        .video-grid-page,
        .tweet-feed-page,
        .video-feed {
            scrollbar-width: none;
        }

        /* Smooth scrolling */
        .tab-content {
            scroll-behavior: smooth;
        }

        /* Make sure content doesn't hide behind fixed elements */
        #poseTab .video-grid-page,
        #friendTab .tweet-feed-page {
            padding-top: 80px;
            padding-bottom: 100px;
        }

        /* Welcome Popup Overlay */
        .welcome-overlay {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .welcome-overlay.hidden {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }


        .welcome-modal {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);

            border-radius: 20px;
            padding: 40px 30px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            border: 1px solid #333;
            box-shadow: 0 20px 60px rgba(255, 0, 80, 0.3);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Logo Section */
        .welcome-logo {
            margin-bottom: 25px;
        }

        .logo-icon {
            margin: 0 auto 15px;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255, 0, 80, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .logo-text {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(45deg, #ff0050, #ff4081, #ff0050);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            letter-spacing: 3px;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* Welcome Message */
        .welcome-message {
            margin-bottom: 30px;
        }

        .welcome-message h2 {
            color: white;
            font-size: 26px;
            font-weight: 700;
            margin: 0 0 15px 0;
        }

        .welcome-message p {
            color: #bbb;
            font-size: 16px;
            line-height: 1.6;
            margin: 0 0 20px 0;
        }

        .welcome-message strong {
            color: #ff4081;
            font-weight: 700;
        }

        /* Features List */
        .features-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: left;
            margin-top: 20px;
        }

        .feature-item {
            color: #ddd;
            font-size: 14px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #ff0050;
        }

        /* Action Buttons */
        .welcome-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .welcome-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .signup-btn {
            background: linear-gradient(45deg, #ff0050, #ff4081);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 0, 80, 0.4);
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 0, 80, 0.6);
        }

        .login-btn {
            background: transparent;
            color: white;
            border: 2px solid #ff0050;
        }

        .login-btn:hover {
            background: rgba(255, 0, 80, 0.1);
            transform: translateY(-2px);
        }

        .skip-btn {
            background: transparent;
            border: none;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            padding: 10px;
            transition: color 0.2s;
        }

        .skip-btn:hover {
            color: #888;
            text-decoration: underline;
        }

        /* Footer */
        .welcome-footer {
            padding-top: 20px;
            border-top: 1px solid #222;
        }

        .welcome-footer p {
            color: #777;
            font-size: 13px;
            margin: 0;
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .welcome-modal {
                padding: 30px 20px;
                width: 95%;
            }

            .logo-text {
                font-size: 36px;
            }

            .welcome-message h2 {
                font-size: 22px;
            }

            .welcome-message p {
                font-size: 15px;
            }

            .feature-item {
                font-size: 13px;
            }

            .welcome-btn {
                padding: 13px;
                font-size: 15px;
            }
        }

        .logo-img {
            width: 80px;
            /* adjust size as needed */
            height: auto;
            border-radius: 12px;
            /* optional rounded corners */
        }


        /* Upload Page Styles */
        .upload-page {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            z-index: 2000;
            overflow-y: auto;
        }

        .upload-page.active {
            display: block;
        }

        .upload-header {
            position: sticky;
            top: 0;
            background: #1a1a1a;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            z-index: 100;
        }

        .back-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
        }

        .upload-header h1 {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .header-spacer {
            width: 44px;
        }

        .upload-tabs {
            display: flex;
            justify-content: space-around;
            background: #1a1a1a;
            padding: 15px 0;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 61px;
            z-index: 99;
        }

        .upload-tab {
            padding: 10px 20px;
            cursor: pointer;
            color: #888;
            font-weight: 600;
            border-radius: 20px;
            transition: all 0.3s;
        }

        .upload-tab.active {
            color: white;
            background: linear-gradient(45deg, #4C1D95, #6D28D9);
        }

        .tab-content-upload {
            display: none;
            padding: 20px;
        }

        .tab-content-upload.active {
            display: block;
        }

        .upload-form {
            max-width: 600px;
            margin: 0 auto;
        }

        .upload-textarea {
            width: 100%;
            min-height: 150px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            color: white;
            padding: 15px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
            font-family: Arial, sans-serif;
        }

        .upload-textarea:focus {
            outline: none;
            border-color: #4C1D95;
        }

        .media-upload-section {
            margin-bottom: 20px;
        }

        .media-label {
            display: block;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .media-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .media-btn {
            flex: 1;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .media-btn:hover {
            background: #222;
            border-color: #4C1D95;
        }

        .media-preview {
            min-height: 100px;
            background: #1a1a1a;
            border: 2px dashed #333;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .media-preview img,
        .media-preview video {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .text-input {
            width: 100%;
            padding: 12px 15px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }

        .text-input:focus {
            outline: none;
            border-color: #4C1D95;
        }

        .file-input {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .monetization-options {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #aaa;
            font-size: 14px;
            cursor: pointer;
        }

        .toggle-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .done-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #4C1D95, #6D28D9);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .done-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* Preview Popup */
        .preview-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 20px;
        }

        .preview-popup.active {
            display: flex;
        }

        .preview-modal {
            background: #1a1a1a;
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .preview-modal h2 {
            color: white;
            font-size: 22px;
            margin-bottom: 20px;
        }

        .preview-content {
            color: white;
        }

        .preview-media {
            width: 100%;
            min-height: 200px;
            background: #0a0a0a;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .preview-media img,
        .preview-media video {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
        }

        /* ====== RECORD TAB STYLES ====== */

        /* Recording Interface */
        .record-interface {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #000;
            color: white;
        }

        .record-interface.active {
            display: flex;
        }

        .record-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: #000;
            overflow: hidden;
            flex: 1;
        }

        .camera-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .effects-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .grid-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
        }

        .grid-line.horizontal {
            width: 100%;
            height: 1px;
        }

        .grid-line.horizontal.top {
            top: 33.33%;
        }

        .grid-line.horizontal.middle {
            top: 50%;
        }

        .grid-line.horizontal.bottom {
            top: 66.67%;
        }

        .grid-line.vertical {
            height: 100%;
            width: 1px;
        }

        .grid-line.vertical.left {
            left: 33.33%;
        }

        .grid-line.vertical.middle {
            left: 50%;
        }

        .grid-line.vertical.right {
            left: 66.67%;
        }

        .timer-display {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #ff0000;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            font-family: monospace;
            z-index: 100;
        }

        .clips-preview {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 8px;
            z-index: 100;
        }

        .clip-thumbnail {
            width: 60px;
            height: 80px;
            background: #222;
            border-radius: 6px;
            border: 2px solid #4C1D95;
            overflow: hidden;
        }

        .clip-thumbnail video,
        .clip-thumbnail canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .record-top-controls {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
        }

        .control-btn {
            background: #4C1D95;
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #6D28D9;
            transform: scale(1.05);
        }

        .beauty-panel {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-top: 1px solid #4C1D95;
        }

        .beauty-panel label {
            display: block;
            margin: 10px 0 5px;
            color: #aaa;
            font-size: 12px;
        }

        .beauty-panel input[type="range"] {
            width: 100%;
            margin-bottom: 15px;
        }

        .record-middle-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 1px solid #333;
        }

        .speed-control,
        .mode-control,
        .duration-control,
        .aspect-control {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .speed-control label,
        .mode-control label,
        .duration-control label,
        .aspect-control label {
            font-size: 12px;
            color: #aaa;
            font-weight: 600;
        }

        .speed-buttons,
        .mode-buttons,
        .aspect-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .speed-btn,
        .mode-btn,
        .aspect-btn {
            flex: 1;
            min-width: 40px;
            padding: 6px;
            background: #333;
            border: 1px solid #555;
            color: #aaa;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .speed-btn:hover,
        .mode-btn:hover,
        .aspect-btn:hover {
            border-color: #4C1D95;
            color: white;
        }

        .speed-btn.active,
        .mode-btn.active,
        .aspect-btn.active {
            background: #4C1D95;
            border-color: #4C1D95;
            color: white;
        }

        .duration-select {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .record-bottom-controls {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            border-top: 1px solid #333;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }

        .record-btn {
            background: #ff0000;
            color: white;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            padding: 0;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .record-btn:hover {
            background: #cc0000;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
        }

        .record-btn.stop-btn {
            background: #ff6600;
        }

        .delete-btn {
            background: #ff4444;
            color: white;
        }

        .delete-btn:hover {
            background: #cc0000;
        }

        .next-btn {
            background: linear-gradient(135deg, #4C1D95, #6D28D9);
            color: white;
        }

        .next-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .countdown-number {
            font-size: 120px;
            color: white;
            font-weight: bold;
            text-shadow: 0 10px 30px rgba(76, 29, 149, 0.5);
            animation: countdownScale 1s ease-in forwards;
        }

        /* Editor Interface */
        .editor-interface {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #0a0a0a;
            color: white;
            overflow-y: auto;
        }

        .editor-interface.active {
            display: flex;
        }

        .editor-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 8px;
        }

        .back-btn:hover {
            color: #4C1D95;
        }

        .editor-header h3 {
            flex: 1;
            margin: 0;
            font-size: 18px;
        }

        .editor-preview {
            padding: 15px;
            background: #111;
            border-bottom: 1px solid #333;
        }

        .editor-video {
            width: 100%;
            max-height: 300px;
            border-radius: 8px;
            background: #000;
        }

        .clips-timeline {
            padding: 15px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .clips-timeline h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }

        .timeline-tracks {
            display: flex;
            gap: 8px;
            overflow-x: auto;
        }

        .timeline-clip {
            min-width: 80px;
            height: 60px;
            background: #333;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .timeline-clip:hover {
            border-color: #4C1D95;
        }

        .timeline-clip.selected {
            border-color: #6D28D9;
        }

        .editor-tabs {
            display: flex;
            gap: 8px;
            padding: 12px 15px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            overflow-x: auto;
        }

        .editor-tab-btn {
            background: #333;
            border: none;
            color: #aaa;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .editor-tab-btn:hover {
            color: white;
            border-bottom: 2px solid #4C1D95;
        }

        .editor-tab-btn.active {
            background: #4C1D95;
            color: white;
        }

        .editor-tab-content {
            padding: 15px;
            display: none;
        }

        .editor-tab-content.active {
            display: block;
        }

        .filters-grid,
        .effects-grid,
        .stickers-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .filter-btn,
        .effect-btn,
        .sticker-btn {
            background: #333;
            border: 1px solid #555;
            color: white;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .filter-btn:hover,
        .effect-btn:hover,
        .sticker-btn:hover {
            background: #4C1D95;
            border-color: #4C1D95;
            transform: scale(1.05);
        }

        .effect-category {
            margin-bottom: 20px;
        }

        .effect-category h5 {
            margin: 0 0 10px 0;
            font-size: 12px;
            color: #aaa;
            text-transform: uppercase;
        }

        .text-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .text-controls input[type="text"],
        .text-controls input[type="color"],
        .text-controls select {
            padding: 8px;
            background: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 6px;
            font-size: 12px;
        }

        .text-controls input[type="color"] {
            width: 100%;
            height: 40px;
            cursor: pointer;
        }

        .trim-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .trim-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .trim-item h5 {
            margin: 0 0 10px 0;
            font-size: 13px;
        }

        .trim-item input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
            padding: 15px;
            border-top: 1px solid #333;
            background: #1a1a1a;
        }

        .editor-actions .action-btn {
            flex: 1;
        }

        /* Pre-Posting Interface */
        .pre-posting-interface {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #0a0a0a;
            color: white;
            overflow-y: auto;
        }

        .posting-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .posting-preview {
            padding: 15px;
            background: #111;
            text-align: center;
        }

        .posting-video {
            width: 100%;
            max-width: 400px;
            max-height: 600px;
            border-radius: 12px;
            background: #000;
        }

        .posting-form {
            flex: 1;
            padding: 15px;
        }

        .posting-form .form-group {
            margin-bottom: 20px;
        }

        .posting-form label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            font-weight: 600;
            color: #aaa;
        }

        .posting-form textarea,
        .posting-form select,
        .posting-form input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: white;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
        }

        .posting-form textarea:focus,
        .posting-form input:focus,
        .posting-form select:focus {
            outline: none;
            border-color: #4C1D95;
            box-shadow: 0 0 10px rgba(76, 29, 149, 0.3);
        }

        .caption-suggestions {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .caption-suggestions button {
            background: #333;
            border: 1px solid #555;
            color: #aaa;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
        }

        .caption-suggestions button:hover {
            background: #4C1D95;
            border-color: #4C1D95;
            color: white;
        }

        .post-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .option-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 13px;
        }

        .option-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .cover-selector {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }

        .cover-preview {
            width: 100%;
            height: 200px;
            background: #111;
            display: block;
        }

        .cover-controls {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .posting-actions {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }

        .draft-btn {
            background: #666;
            color: white;
        }

        .draft-btn:hover {
            background: #777;
        }

        .post-btn {
            background: linear-gradient(135deg, #4C1D95, #6D28D9);
            color: white;
        }

        .post-btn:hover {
            opacity: 0.9;
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .upload-tabs {
                top: 56px;
            }

            .upload-tab {
                padding: 8px 15px;
                font-size: 14px;
            }

            .monetization-options {
                flex-direction: column;
                align-items: stretch;
            }

            .record-middle-controls {
                grid-template-columns: 1fr;
            }

            .post-options {
                grid-template-columns: 1fr;
            }

            .filters-grid,
            .effects-grid,
            .stickers-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }


        /* ====== SOUND LIBRARY MODAL ====== */
        .sound-library-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3500;
            animation: fadeIn 0.3s ease;
            flex-direction: column;
        }

        .sound-library-modal.active {
            display: flex;
        }

        .sound-library-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
        }

        .sound-library-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin: 0;
        }

        .sound-library-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .sound-library-close:hover {
            color: #ff0050;
            transform: scale(1.1);
        }

        /* Banner Ads Section */
        .sound-banner-ads {
            width: 100%;
            height: 180px;
            background: #0a0a0a;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid #333;
        }

        .banner-ads-slider {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease;
        }

        .banner-ad-item {
            min-width: 100%;
            height: 100%;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .banner-ad-item img,
        .banner-ad-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .banner-ad-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
            color: white;
        }

        .banner-ad-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .banner-ad-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }

        .banner-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .banner-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: var(--transition);
        }

        .banner-indicator.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }

        /* Sound Tabs */
        .sound-tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .sound-tabs::-webkit-scrollbar {
            display: none;
        }

        .sound-tab {
            flex: 1;
            min-width: 100px;
            padding: 15px 10px;
            background: transparent;
            border: none;
            color: #888;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
            white-space: nowrap;
        }

        .sound-tab:hover {
            color: #aaa;
        }

        .sound-tab.active {
            color: white;
        }

        .sound-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(45deg, #ff0050, #ff4081);
            border-radius: 2px 2px 0 0;
        }

        /* Tab Content */
        .sound-tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            background: #0a0a0a;
        }

        .sound-tab-content.active {
            display: block;
        }

        /* Search Bar */
        .sound-search {
            padding: 15px;
            background: #1a1a1a;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .sound-search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 25px;
            color: white;
            font-size: 14px;
        }

        .sound-search-input:focus {
            outline: none;
            border-color: #ff0050;
        }

        .sound-search-input::placeholder {
            color: #666;
        }

        .search-icon {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 16px;
        }

        /* Sound List */
        .sound-list {
            padding: 10px;
        }

        .sound-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #1a1a1a;
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .sound-item:hover {
            background: #222;
            border-color: #333;
        }

        .sound-item.active,
        .sound-item.playing {
            border-color: #ff0050;
            background: rgba(255, 0, 80, 0.1);
        }

        .sound-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-sm);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .sound-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sound-play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            background: rgba(255, 0, 80, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            opacity: 1;
            transition: var(--transition);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(255, 0, 80, 0.5);
        }

        .sound-item:hover .sound-play-icon {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.15);
            background: rgba(255, 0, 80, 1);
        }

        /* Trending Badge */
        .trending-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: linear-gradient(135deg, #ff0050 0%, #ff6b7a 100%);
            border-radius: 12px;
            padding: 4px 8px;
            box-shadow: 0 2px 8px rgba(255, 0, 80, 0.4);
            animation: trendingPulse 2s ease-in-out infinite;
        }

        .trending-text {
            font-size: 10px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 2px;
        }

        @keyframes trendingPulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(255, 0, 80, 0.4);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 15px rgba(255, 0, 80, 0.6);
            }
        }

        .sound-info {
            flex: 1;
            min-width: 0;
        }

        .sound-title {
            font-size: 14px;
            font-weight: 600;
            color: white;
            margin-bottom: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sound-artist {
            font-size: 12px;
            color: #888;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sound-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 11px;
            color: #666;
        }

        .sound-duration {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sound-uses {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sound-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            align-items: center;
        }

        .sound-favorite-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sound-favorite-btn:hover {
            background: rgba(255, 0, 80, 0.2);
            border-color: #ff0050;
            color: #ff0050;
            transform: scale(1.1);
        }

        .sound-favorite-btn.active {
            background: #ff0050;
            border-color: #ff0050;
            color: white;
        }

        .sound-action {
            background: transparent;
            border: 1px solid #333;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .sound-action:hover {
            background: #ff0050;
            border-color: #ff0050;
        }

        .sound-item.active .sound-action {
            background: #ff0050;
            border-color: #ff0050;
        }

        /* Empty State */
        .sound-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #666;
            text-align: center;
        }

        .sound-empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .sound-empty-title {
            font-size: 18px;
            font-weight: 600;
            color: #888;
            margin-bottom: 10px;
        }

        .sound-empty-text {
            font-size: 14px;
            color: #666;
        }

        /* Voice Recording Interface */
        .voice-recorder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            min-height: 400px;
        }

        .voice-visualizer {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff0050, #ff4081);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 30px;
            box-shadow: 0 0 0 0 rgba(255, 0, 80, 0.7);
        }

        .voice-visualizer.recording {
            animation: voicePulse 1.5s infinite;
        }

        @keyframes voicePulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 0, 80, 0.7);
            }

            50% {
                box-shadow: 0 0 0 30px rgba(255, 0, 80, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 0, 80, 0.7);
            }
        }

        .voice-icon {
            font-size: 64px;
            color: white;
        }

        .voice-timer {
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin-bottom: 30px;
            font-family: monospace;
        }

        .voice-controls {
            display: flex;
            gap: 20px;
        }

        .voice-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: var(--transition);
        }

        .voice-btn.record {
            background: #ff0050;
            color: white;
        }

        .voice-btn.record:hover {
            background: #cc0040;
            transform: scale(1.1);
        }

        .voice-btn.stop {
            background: #333;
            color: white;
        }

        .voice-btn.stop:hover {
            background: #444;
        }

        .voice-btn.save {
            background: #22c55e;
            color: white;
        }

        .voice-btn.save:hover {
            background: #16a34a;
        }

        /* Loading State */
        .sound-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: #888;
        }

        .sound-loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #333;
            border-top-color: #ff0050;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .sound-banner-ads {
                height: 140px;
            }

            .sound-tab {
                min-width: 80px;
                font-size: 13px;
                padding: 12px 8px;
            }

            .sound-item {
                gap: 10px;
                padding: 10px;
            }

            .sound-thumbnail {
                width: 45px;
                height: 45px;
            }

            .sound-title {
                font-size: 13px;
            }

            .sound-artist {
                font-size: 11px;
            }
        }

        /* ====== SELECTED SOUND DISPLAY - SCREEN 6 ====== */
        .selected-sound-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 12px 20px;
            z-index: 15;
            display: none;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            animation: slideDown 0.3s ease;
            max-width: calc(100% - 40px);
        }

        .selected-sound-container.show {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .sound-display-thumbnail {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            flex-shrink: 0;
            overflow: hidden;
        }

        .sound-display-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sound-display-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .sound-display-title {
            font-size: 14px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sound-display-artist {
            font-size: 12px;
            color: #aaa;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sound-display-controls {
            display: flex;
            gap: 8px;
            margin-left: auto;
            flex-shrink: 0;
        }

        .sound-play-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #ff0050;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sound-play-btn:hover {
            background: #cc0040;
            transform: scale(1.05);
        }

        .sound-play-btn:active {
            transform: scale(0.95);
        }

        .sound-play-btn.playing {
            background: #22c55e;
        }

        .sound-trim-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #6366f1;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sound-trim-btn:hover {
            background: #4f46e5;
            transform: scale(1.05);
        }

        .sound-trim-btn:active {
            transform: scale(0.95);
        }

        .sound-remove-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sound-remove-btn:hover {
            background: #ff0050;
            border-color: #ff0050;
        }

        .sound-remove-btn:active {
            transform: scale(0.95);
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .selected-sound-container {
                top: 15px;
                padding: 10px 15px;
                border-radius: 15px;
            }

            .sound-display-thumbnail {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .sound-display-title {
                font-size: 13px;
            }

            .sound-display-artist {
                font-size: 11px;
            }

            .sound-play-btn,
            .sound-remove-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
        }
    </style>
</head>

<body>
    <!-- Upload Progress Container -->
    <div class="upload-progress-container" id="uploadProgressContainer">
        <div class="upload-progress-header">
            <h3> <span id="uploadProgressTitle">Uploading</span></h3>
        </div>
        <div class="upload-progress-body">
            <!-- Step 1: Analyze -->
            <div class="upload-step">
                <div class="step-icon pending" id="step1Icon">1</div>
                <div class="step-content">
                    <div class="step-label">Analyzing Video</div>
                    <div class="step-progress" id="step1Progress">Checking size & format...</div>
                    <div class="step-bar" id="step1Bar">
                        <div class="step-bar-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Compress -->
            <div class="upload-step">
                <div class="step-icon pending" id="step2Icon">2</div>
                <div class="step-content">
                    <div class="step-label">Optimizing</div>
                    <div class="step-progress" id="step2Progress">Ready when needed</div>
                    <div class="step-bar" id="step2Bar">
                        <div class="step-bar-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Upload -->
            <div class="upload-step">
                <div class="step-icon pending" id="step3Icon">3</div>
                <div class="step-content">
                    <div class="step-label">Uploading to Cloud</div>
                    <div class="step-progress" id="step3Progress">Waiting...</div>
                    <div class="step-bar" id="step3Bar">
                        <div class="step-bar-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Overall Progress -->
            <div class="overall-progress">
                <div class="overall-bar">
                    <div class="overall-bar-fill" id="overallBarFill"></div>
                </div>
                <div class="overall-stats">
                    <span id="uploadElapsedTime">0s</span>
                    <span id="uploadStats">0 MB / 0 MB</span>
                    <span id="uploadSpeed">0 MB/s</span>
                </div>
            </div>
        </div>
    </div>

    <!-- TikTok-Style Countdown Modal -->
    <div class="tiktok-countdown-modal" id="tiktokCountdownModal">
        <div class="tiktok-countdown-content">
            <div class="tiktok-countdown-number" id="countdownNumberDisplay">5</div>
        </div>
    </div>

    <!-- Upload Result Modal (Success/Error) -->
    <div class="upload-result-modal" id="uploadResultModal">
        <div class="upload-result-content">
            <div class="upload-result-thumbnail" id="uploadResultThumbnail">
                
            </div>
            <div class="upload-result-title" id="uploadResultTitle">Success!</div>
            <div class="upload-result-message" id="uploadResultMessage">Your video has been uploaded successfully!</div>

            <!-- Countdown Progress -->
            <div class="upload-result-countdown" id="uploadResultCountdown" style="display: none;">
                <div class="upload-result-countdown-text">Closing in...</div>
                <div class="countdown-bar">
                    <div class="countdown-bar-fill" id="countdownBarFill"></div>
                </div>
                <div class="countdown-time" id="countdownNumber">5</div>
            </div>

            <button class="upload-result-btn" onclick="closeUploadResultModal()">Continue</button>
        </div>
    </div>

    <!-- Auth Modals -->
    <div class="modal-overlay" id="authModal">
        <div class="modal">
            <button class="modal-close" onclick="closeAuthModal()"></button>
            <div id="signupForm">
                <h2>Join Pose</h2>
                <div id="authError" class="error-msg" style="display:none;"></div>
                <input type="text" id="signupName" placeholder="Full Name" required>
                <input type="text" id="signupUsername" placeholder="Username" required>
                <input type="email" id="signupEmail" placeholder="Email" required>
                <input type="password" id="signupPassword" placeholder="Password (min 6 characters)" required>
                <button class="modal-btn" onclick="handleSignup()">Sign Up</button>
                <div class="modal-switch">
                    Already have an account? <a onclick="switchToLogin()">Log In</a>
                </div>
            </div>
            <div id="loginForm" style="display:none;">
                <h2>Welcome Back</h2>
                <div id="loginError" class="error-msg" style="display:none;"></div>
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button class="modal-btn" onclick="handleLogin()">Log In</button>
                <div class="modal-switch">
                    Don't have an account? <a onclick="switchToSignup()">Sign Up</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="profile-page" id="profilePage">
        <div class="profile-header">
            <button class="profile-back-btn" onclick="closeProfile()"></button>
            <button class="edit-profile-btn" onclick="openSettings()">Edit Profile</button>
            <button class="profile-settings-btn" onclick="logout()"></button>
        </div>
        <div class="profile-info-section">
            <div class="profile-pic-large" id="profilePicLarge">U</div>
            <div class="profile-name" id="profileDisplayName">User Name</div>
            <div class="profile-username" id="profileUsernameDisplay">@username</div>
            <div class="profile-bio">African Creator | Skits | Exclusive Content <br> Lagos, Nigeria</div>
            <div class="profile-stats">
                <div class="stat">
                    <div class="stat-value">12.5K</div>
                    <div class="stat-label">Followers</div>
                </div>
                <div class="stat">
                    <div class="stat-value">804</div>
                    <div class="stat-label">Following</div>
                </div>
                <div class="stat">
                    <div class="stat-value">108K</div>
                    <div class="stat-label">Likes</div>
                </div>
            </div>
            <div class="profile-stats">
                <div class="stat">
                    <div class="stat-value">550K</div>
                    <div class="stat-label">Total Views</div>
                </div>
                <div class="stat">
                    <div class="stat-value">82,400</div>
                    <div class="stat-label">Earnings</div>
                </div>
            </div>
        </div>

        <!-- Settings Modal (Add right after profile-info-section closing div) -->
        <div class="modal-overlay" id="settingsModal">
            <div class="modal">
                <button class="modal-close" onclick="closeSettings()"></button>
                <h2>Edit Profile</h2>
                <div id="settingsError" class="error-msg" style="display:none;"></div>

                <!-- Profile Picture Upload -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="profile-pic-large" id="previewPic" style="margin: 0 auto 15px;">U</div>
                    <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
                    <button class="modal-btn" onclick="document.getElementById('profilePicInput').click()"
                        style="background: #333;">
                         Change Photo
                    </button>
                </div>

                <input type="text" id="editName" placeholder="Full Name">
                <input type="text" id="editUsername" placeholder="Username">
                <textarea id="editBio" placeholder="Bio"
                    style="width: 100%; min-height: 80px; background: #2a2a2a; border: 1px solid #444; border-radius: 8px; color: white; padding: 12px; font-size: 14px; margin-bottom: 15px; resize: vertical; font-family: Arial, sans-serif;"></textarea>
                <input type="text" id="editLocation" placeholder="Location (e.g., Lagos, Nigeria)">

                <button class="modal-btn" onclick="saveProfile()">Save Changes</button>
                <button class="modal-btn" onclick="closeSettings()"
                    style="background: #333; margin-top: 10px;">Cancel</button>
            </div>
        </div>
        <div class="profile-tabs">
            <div class="profile-tab active" onclick="switchProfileTab('feed')"> Feed</div>
            <div class="profile-tab" onclick="switchProfileTab('exclusive')"> Exclusive</div>
            <div class="profile-tab" onclick="switchProfileTab('shorts')"> Shorts</div>
            <div class="profile-tab" onclick="switchProfileTab('tweets')"> Tweets</div>
            <div class="profile-tab" onclick="switchProfileTab('liked')"> Liked</div>
            <div class="profile-tab" onclick="switchProfileTab('stories')"> Stories</div>
        </div>
        <div class="profile-content" id="profileContent">
            <!-- Feed Videos Tab -->
            <div id="feedTab" class="profile-tab-content active">
                <div class="video-grid" id="feedGrid"></div>
            </div>
            <!-- Exclusive Tab (Paid Videos) -->
            <div id="exclusiveTab" class="profile-tab-content" style="display:none;">
                <div class="video-grid" id="exclusiveGrid"></div>
            </div>
            <!-- Shorts Tab (5-15 sec videos) -->
            <div id="shortsTab" class="profile-tab-content" style="display:none;">
                <div class="video-grid" id="shortsGrid"></div>
            </div>
            <!-- Tweets Tab -->
            <div id="tweetsTab" class="profile-tab-content" style="display:none;">
                <div class="post-compose-section">
                    <textarea class="post-input" placeholder="What's on your mind?" id="profileTweetInput"></textarea>
                    <div class="post-actions">
                        <button class="post-btn" onclick="attachMediaToTweet()"> Media</button>
                        <button class="post-btn" onclick="postNewTweet()">Post</button>
                    </div>
                </div>
                <div id="tweetsContainer"></div>
            </div>
            <!-- Liked Tab -->
            <div id="likedTab" class="profile-tab-content" style="display:none;">
                <div class="video-grid" id="likedGrid"></div>
            </div>
            <!-- Stories Tab -->
            <div id="storiesTab" class="profile-tab-content" style="display:none;">
                <div class="stories-container" id="storiesContainer"></div>
            </div>
        </div>
    </div>

    <!-- Original Feed UI (Keep these as is) -->
    <div class="navbar">
        <div class="profile-icon" onclick="handleProfileClick()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="white">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
        </div>
        <div class="tabs">
            <span class="tab active">For You</span>
            <span class="tab">tweet</span>
            <span class="tab">Pose</span>
        </div>
        <div class="search-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="black">
                <path
                    d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
            </svg>
        </div>
    </div>
    <div class="bottom-nav">
        <div>
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg></i>
            <span>Home</span>
        </div>
        <div onclick="openNotifications()">
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
                </svg></i>
            <span>Alert</span>
        </div>
        <div onclick="openRecordingUI()">
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5h3V9h4v3h3l-5 5z" />
                </svg></i>
            <span>Create</span>
        </div>
        <div onclick="openUploadPage()">
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z" />
                </svg></i>
        </div>
        <div>
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path
                        d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4zM14 13h-3v3H9v-3H6v-2h3V8h2v3h3v2z" />
                </svg></i>
            <span>Live</span>
        </div>
        <div>
            <i><svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z" />
                </svg></i>
            <span>Music</span>
        </div>
    </div>

    <!-- RECORDING TOAST -->
    <div class="recording-toast" id="recordingToast">
        <span class="recording-toast-icon" id="recordingToastIcon"></span>
        <span id="recordingToastMessage">Message</span>
    </div>

    <!-- RECORDING UI OVERLAY -->
    <div id="recordingUIOverlay" class="recording-ui-overlay">
        <!-- SCREEN 1: VIDEO SETUP -->
        <div id="screen1" class="recording-screen active">
            <div class="camera-preview"> Camera Preview</div>

            <!-- Top Bar -->
            <div class="rec-top-bar">
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="rec-icon-btn" onclick="closeRecordingUI()"><i
                            class="fa-solid fa-arrow-left"></i></button>
                    <button class="rec-icon-btn" onclick="toggleRecLeftMenu()"><i
                            class="fa-solid fa-caret-down"></i></button>
                </div>
                <button class="rec-icon-btn"><i class="fa-solid fa-rotate"></i></button>
            </div>

            <!-- Left Menu -->
            <div class="rec-left-menu" id="recLeftMenu">
                <div class="rec-menu-item"> Photo</div>
                <div class="rec-menu-item"> Layout</div>
                <div class="rec-menu-item"> Timer</div>
                <div class="rec-menu-item"> Filters</div>
                <div class="rec-menu-item"> Speed</div>
            </div>

            <!-- Right Effects -->
            <div class="rec-effects-bar">
                <div class="rec-effect-icon" onclick="toggleEffect('sparkle')"></div>
                <div class="rec-effect-icon" onclick="toggleEffect('mask')"></div>
                <div class="rec-effect-icon" onclick="toggleEffect('ghost')"></div>
                <div class="rec-effect-icon" onclick="toggleEffect('star')"></div>
            </div>

            <!-- Bottom Controls -->
            <div class="rec-bottom-controls">
                <div class="rec-control-row">
                    <button class="rec-control-btn">
                        <div class="rec-control-icon"></div>
                        <div class="rec-control-label">Effects</div>
                    </button>
                    <button class="rec-control-btn">
                        <div class="rec-control-icon"></div>
                        <div class="rec-control-label">15s</div>
                    </button>
                    <button class="rec-control-btn">
                        <div class="rec-control-icon">+</div>
                        <div class="rec-control-label">Add video</div>
                    </button>
                </div>

                <div class="rec-record-btn-wrapper">
                    <button class="rec-record-btn" onclick="startRecording()"></button>
                </div>

                <div class="rec-mode-tabs">
                    <button class="rec-mode-tab active" onclick="switchRecMode('video'); return false;">Video</button>
                    <button class="rec-mode-tab" onclick="switchRecMode('photo'); return false;">Photo</button>
                    <button class="rec-mode-tab" onclick="switchRecMode('text'); return false;">Text</button>
                </div>
            </div>
        </div>

        <!-- SCREEN 2: RECORDING -->
        <div id="screen2" class="recording-screen">
            <div class="camera-preview"> Recording...</div>

            <!-- Top Bar -->
            <div class="rec-top-bar">
                <button class="rec-icon-btn" onclick="backToScreen1()"><i class="fa-solid fa-arrow-left"></i></button>
            </div>

            <!-- Recording Indicator -->
            <div class="rec-recording-indicator">
                <div class="rec-rec-dot"></div>
                <span id="recTimer">0:05</span>
            </div>

            <!-- Recording Controls -->
            <div class="rec-recording-controls">
                <button class="rec-recording-btn" onclick="cancelRecording()"></button>
                <button class="rec-recording-btn stop" onclick="stopRecording()"></button>
                <button class="rec-recording-btn" onclick="acceptRecording()"></button>
            </div>
        </div>

        <!-- SCREEN 3: VIDEO EDIT -->
        <div id="screen3" class="recording-screen">
            <div class="camera-preview"> Video Preview</div>

            <!-- Top Bar -->
            <div class="rec-top-bar">
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="rec-icon-btn" onclick="backToScreen2()"><i
                            class="fa-solid fa-arrow-left"></i></button>
                    <button class="rec-icon-btn" onclick="toggleRecEditMenu()"><i
                            class="fa-solid fa-caret-down"></i></button>
                </div>
            </div>

            <!-- Left Menu -->
            <div class="rec-left-menu" id="recEditMenu">
                <div class="rec-menu-item"> Text</div>
                <div class="rec-menu-item"> Trim</div>
                <div class="rec-menu-item"> Effects</div>
                <div class="rec-menu-item"> Templates</div>
                <div class="rec-menu-item"> Edit</div>
            </div>

            <!-- Edit Controls -->
            <div class="rec-edit-controls">
                <button class="rec-add-sound-btn"
                    onclick="showToastRecording(' Add Sound feature coming soon', 'info', '')">
                     Add Sound
                </button>
                <button class="rec-action-btn post" style="width: 100%;" onclick="goToPostSettings()">Continue</button>
            </div>
        </div>

        <!-- SCREEN 5: PHOTO MODE -->
        <div id="screen5" class="recording-screen">
            <div class="camera-preview">
                <!-- Ratio Guide Frame (Live Preview) -->
                <div id="ratioGuide" class="ratio-guide-frame"></div>
            </div>
            <div class="rec-top-bar">
                <button class="rec-icon-btn" onclick="backToScreen1()"></button>
                <button class="rec-icon-btn" onclick="toggleRecLeftMenu()"></button>
                <button class="rec-icon-btn" onclick="switchPhotoCamera()"></button>
            </div>
            <div class="rec-left-menu" id="recPhotoLeftMenu">
                <div class="rec-menu-item" onclick="togglePhotoFlash()"> Flash</div>
                <div class="rec-menu-item" onclick="togglePhotoTimer()"> Timer</div>
                <div class="rec-menu-item" onclick="togglePhotoFilters()"> Filters</div>
                <div class="rec-menu-item" onclick="togglePhotoGrid()"> Grid</div>
                <div class="rec-menu-item" onclick="togglePhotoRatio()"> Ratio</div>
            </div>
            <div class="rec-effects-bar">


                <!-- Filters Panel (Right Side, Scrollable) -->
                <div class="photo-filters-panel">
                    <div class="photo-filters-scroll">
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('none')" title="Original">
                            <div class="photo-filter-preview original"></div>
                            <span>Original</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('bw')" title="Black & White">
                            <div class="photo-filter-preview bw"></div>
                            <span>B&W</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('sepia')" title="Sepia">
                            <div class="photo-filter-preview sepia"></div>
                            <span>Sepia</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('vintage')" title="Vintage">
                            <div class="photo-filter-preview vintage"></div>
                            <span>Vintage</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('vivid')" title="Vivid">
                            <div class="photo-filter-preview vivid"></div>
                            <span>Vivid</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('warm')" title="Warm">
                            <div class="photo-filter-preview warm"></div>
                            <span>Warm</span>
                        </button>
                        <button class="photo-filter-btn" onclick="applyPhotoFilter('cool')" title="Cool">
                            <div class="photo-filter-preview cool"></div>
                            <span>Cool</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="rec-bottom-controls photo-controls">
                <div class="photo-control-row">
                    <button class="photo-control-btn" onclick="openPhotoGallery()">
                        <div class="rec-control-icon"></div>
                        <div class="rec-control-label">Gallery</div>
                    </button>
                    <button class="photo-control-btn" onclick="togglePhotoFlash()">
                        <div class="rec-control-icon"></div>
                        <div class="rec-control-label">Flash</div>
                    </button>
                    <button class="photo-control-btn" onclick="togglePhotoTimer()">
                        <div class="rec-control-icon"></div>
                        <div class="rec-control-label">Timer</div>
                    </button>
                </div>

                <div class="photo-record-btn-wrapper">
                    <button class="photo-record-btn" onclick="capturePhoto()"></button>
                </div>

                <div class="rec-mode-tabs">
                    <button class="rec-mode-tab" onclick="switchRecMode('video'); return false;">Video</button>
                    <button class="rec-mode-tab active" onclick="switchRecMode('photo'); return false;">Photo</button>
                    <button class="rec-mode-tab" onclick="switchRecMode('text'); return false;">Text</button>
                </div>
            </div>
        </div>

        <!-- SCREEN 6: PHOTO EDIT -->
        <div id="screen6" class="recording-screen">
            <div class="camera-preview"> Photo Preview</div>
            <!-- Selected Sound Display -->
            <div class="selected-sound-container" id="selectedSoundContainer">
                <div class="sound-display-thumbnail" id="soundDisplayThumbnail"><i class="fas fa-music"></i></div>
                <div class="sound-display-info">
                    <div class="sound-display-title" id="soundDisplayTitle">Sound Name</div>
                    <div class="sound-display-artist" id="soundDisplayArtist">Artist Name</div>
                </div>
                <div class="sound-display-controls">
                    <button class="sound-play-btn" id="soundPlayBtn" onclick="toggleSelectedSoundPlayback()"
                        title="Play/Pause"><i class="fas fa-play"></i></button>
                    <button class="sound-trim-btn" id="soundTrimBtn" onclick="openSoundTrimmer()" title="Trim Sound"><i
                            class="fas fa-cut"></i></button>
                    <button class="sound-remove-btn" onclick="removeSelectedSound()" title="Remove"><i
                            class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="rec-top-bar">
                <button class="rec-icon-btn" onclick="backToScreen5()"></button>
                <button class="rec-icon-btn" onclick="toggleRecPhotoEditMenu()"></button>
            </div>
            <div class="rec-left-menu" id="recPhotoEditMenu">
                <div class="rec-menu-item" onclick="photoAddText()"> Text</div>
                <div class="rec-menu-item" onclick="photoCrop()"> Crop</div>
                <div class="rec-menu-item" onclick="photoAddEffects()"> Effects</div>
                <div class="rec-menu-item" onclick="photoAddFilters()"> Filters</div>
                <div class="rec-menu-item" onclick="photoDraw()"> Draw</div>
            </div>
            <div class="rec-edit-controls">
                <button class="rec-add-sound-btn" onclick="openSoundLibrary()"> Add Sound</button>

                <button class="rec-action-btn" style="background: rgba(255, 255, 255, 0.1); flex: 1;"
                    onclick="downloadCapturedPhoto()">
                     Download
                </button>
                <button class="rec-action-btn post" style="flex: 1;" onclick="goToPhotoPostSettings()">
                    Continue 
                </button>
            </div>

        </div>
        <div id="discardPhotoModal" class="modal-overlay">
            <div class="modal">
                <h2>Discard Photo?</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Are you sure you want to discard this photo?</p>
                <div style="display: flex; gap: 10px;">
                    <button class="modal-btn" style="background: rgba(255, 255, 255, 0.1); flex: 1;"
                        onclick="closeDiscardModal()">Stay</button>
                    <button class="modal-btn" style="flex: 1;" onclick="confirmDiscardPhoto()">Discard</button>
                </div>
            </div>
        </div>
        <!-- SCREEN 7: PHOTO POST SETTINGS -->
        <div id="screen7" class="recording-screen">
            <div class="rec-post-header">
                <button class="rec-icon-btn" onclick="backToScreen6()"></button>
                <h2 style="color: #fff; margin: 0;">Post Photo</h2>
                <div></div>
            </div>
            <div class="rec-post-content">
                <div class="rec-post-section">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="rec-section-header" style="margin: 0;">Caption</div>
                        <span id="photoCaptionCounter" style="color: #999; font-size: 12px;">0/300</span>
                    </div>
                    <textarea class="rec-caption-input" id="photoCaption" placeholder="Add a caption..." maxlength="300"
                        oninput="updatePhotoCaptionCounter()"></textarea>
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"># Hashtags</div>
                    <input type="text" class="rec-input-field" placeholder="Add hashtags">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header">@ Tags</div>
                    <input type="text" class="rec-input-field" placeholder="Tag people">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"> Privacy</div>
                    <select class="rec-input-field">
                        <option>Everyone</option>
                        <option>Friends</option>
                        <option>Only me</option>
                    </select>
                </div>
            </div>
            <div class="rec-post-actions">
                <button class="rec-action-btn draft" onclick="saveDraftPhoto()">Draft</button>
                <button class="rec-action-btn story" onclick="postPhotoStory()">Your Story</button>
                <button class="rec-action-btn post" onclick="publishPhotoPost()">Post</button>
            </div>
        </div>

        <!-- SCREEN 8: TEXT MODE -->
        <div id="screen8" class="recording-screen">
            <div class="rec-text-editor-container">
                <!-- Color Picker Bar -->
                <div class="rec-color-picker-bar">
                    <div class="rec-color-option active"
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"
                        onclick="changeTextBg(this)">
                    </div>
                    <div class="rec-color-option" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"
                        onclick="changeTextBg(this)"></div>
                    <div class="rec-color-option" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"
                        onclick="changeTextBg(this)"></div>
                    <div class="rec-color-option" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"
                        onclick="changeTextBg(this)"></div>
                    <div class="rec-color-option" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"
                        onclick="changeTextBg(this)"></div>
                    <div class="rec-color-option" style="background: #000;" onclick="changeTextBg(this)"></div>
                    <div class="rec-color-option" style="background: #fff;" onclick="changeTextBg(this)"></div>
                </div>

                <div class="rec-top-bar">
                    <button class="rec-icon-btn" onclick="backToScreen1()"></button>
                    <button class="rec-icon-btn" onclick="closeRecordingUI()"></button>
                </div>

                <!-- Text Input Area -->
                <div class="text-canvas" id="textEditorBg">
                    <textarea class="rec-text-input" id="textInput" placeholder="Type something..."
                        maxlength="500"></textarea>
                </div>
                <!-- Text Formatting Tools -->
                <div class="rec-text-tools">
                    <button class="rec-text-tool-btn" onclick="changeTextAlign('left')"><i
                            class="fa-solid fa-align-left"></i></button>
                    <button class="rec-text-tool-btn active" onclick="changeTextAlign('center')"><i
                            class="fa-solid fa-align-center"></i></button>
                    <button class="rec-text-tool-btn" onclick="changeTextAlign('right')"><i
                            class="fa-solid fa-align-right"></i></button>
                    <button class="rec-text-tool-btn" onclick="toggleBold()"><i class="fa-solid fa-bold"></i></button>
                    <button class="rec-text-tool-btn" onclick="changeTextColor()"><i
                            class="fa-solid fa-palette"></i></button>
                </div>

                <div style="position: absolute; bottom: 40px; right: 20px;">
                    <button onclick="goToTextPostSettings()"
                        style="width: 60px; height: 60px; border-radius: 50%; background: #ff0050; border: none; color: #fff; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;"></button>
                </div>
            </div>
        </div>

        <!-- SCREEN 9: TEXT POST SETTINGS -->
        <div id="screen9" class="recording-screen">
            <div class="rec-post-header">
                <button class="rec-icon-btn" onclick="backToScreen8()"></button>
                <h2 style="color: #fff; margin: 0;">Post Text</h2>
                <div></div>
            </div>
            <div class="rec-post-content">
                <!-- Text Preview Thumbnail -->
                <div class="post-preview">
                    <div class="rec-text-preview-thumbnail" id="textPreview">
                        <span>Your Text</span>
                    </div>
                </div>
                <div class="rec-post-section">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="rec-section-header" style="margin: 0;">Caption</div>
                        <span id="textPostCaptionCounter" style="color: #999; font-size: 12px;">0/300</span>
                    </div>
                    <textarea class="rec-caption-input" id="textPostCaption" placeholder="Add a caption..."
                        maxlength="300" oninput="updateTextPostCaptionCounter()"></textarea>
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"># Hashtags</div>
                    <input type="text" class="rec-input-field" placeholder="Add hashtags">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header">@ Tags</div>
                    <input type="text" class="rec-input-field" placeholder="Tag people">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"> Privacy</div>
                    <select class="rec-input-field">
                        <option>Everyone</option>
                        <option>Friends</option>
                        <option>Only me</option>
                    </select>
                </div>

                <!-- Allow Comments -->
                <div class="post-section toggle-section">
                    <div class="section-header">
                        <i class="fa-solid fa-comment"></i>
                        <span>Allow comments</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Comments</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox" checked>
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>

            </div>

            <div class="rec-post-actions">
                <button class="rec-action-btn draft" onclick="saveDraftText()">Draft</button>
                <button class="rec-action-btn story" onclick="postTextStory()">Your Story</button>
                <button class="rec-action-btn post" onclick="publishTextPost()">Post</button>
            </div>
        </div>

        <!-- SCREEN 4: POST SETTINGS -->
        <div id="screen4" class="recording-screen">
            <div class="rec-post-header">
                <button class="rec-icon-btn" onclick="backToScreen3()"></button>
                <h2 style="color: #fff; margin: 0;">Post</h2>
                <div></div>
            </div>
            <div class="rec-post-content">
                <div class="rec-post-section">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <div class="rec-section-header" style="margin: 0;">Caption</div>
                        <span id="captionCounter" style="color: #999; font-size: 12px;">0/300</span>
                    </div>
                    <textarea class="rec-caption-input" id="recCaption" placeholder="Add a caption..." maxlength="300"
                        oninput="updateCaptionCounter()"></textarea>
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"># Hashtags</div>
                    <input type="text" class="rec-input-field" placeholder="Add hashtags">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header">@ Tags</div>
                    <input type="text" class="rec-input-field" placeholder="Tag people">
                </div>
                <div class="rec-post-section">
                    <div class="rec-section-header"> Privacy</div>
                    <select class="rec-input-field">
                        <option>Everyone</option>
                        <option>Friends</option>
                        <option>Only me</option>
                    </select>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Comments</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox" checked>
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Duet</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox" checked>
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Stitch</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox" checked>
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Sound Reuse</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox" checked>
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>
                <div class="rec-post-section toggle-section">
                    <div class="rec-section-header"> Allow Download</div>
                    <label class="rec-toggle-switch">
                        <input type="checkbox">
                        <span class="rec-toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div class="rec-post-actions">
                <button class="rec-action-btn draft" onclick="saveDraftRecording()">Draft</button>
                <button class="rec-action-btn story" onclick="postStory()">Your Story</button>
                <button class="rec-action-btn post" onclick="publishRecordingPost()">Post</button>
            </div>
        </div>
    </div>

    <!-- Effects Popup -->
    <div class="rec-popup" id="effectsPopup">
        <button class="rec-popup-close" onclick="closeRecPopup('effectsPopup')"></button>
        <div class="rec-popup-header">
            <button class="rec-popup-tab active">Trending</button>
            <button class="rec-popup-tab">New</button>
            <button class="rec-popup-tab">Favorites</button>
        </div>
        <div class="rec-popup-content">
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
        </div>
    </div>

    <!-- Sound Popup -->
    <div class="rec-popup" id="soundPopup">
        <button class="rec-popup-close" onclick="closeRecPopup('soundPopup')"></button>
        <div class="rec-popup-header">
            <button class="rec-popup-tab active">Sounds</button>
            <button class="rec-popup-tab">Your Sounds</button>
        </div>
        <div class="rec-popup-content">
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
            <div class="rec-popup-item"></div>
        </div>
    </div>

    <!-- NOTIFICATIONS PAGE -->
    <div id="notificationsOverlay" class="notifications-overlay">
        <div class="notifications-header">
            <h2>Notifications</h2>
            <button class="notifications-close-btn" onclick="closeNotifications()"></button>
        </div>
        <div class="notifications-container" id="notificationsContainer">
            <!-- Notifications will be populated here -->
        </div>
    </div>

    <!-- The rest remains the same (friendTab and poseTab) --><!-- Tab Content Containers -->
    <div id="busTab" class="tab-content active">
        <!-- Video Feed (TikTok style) - This is your existing video-feed -->
        <!-- Scrollable feed -->
        <div class="video-feed">
            <!-- Post 1 -->
            <div class="video-post">
                <video src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" autoplay
                    muted loop></video>
                <div class="play-pause-overlay">
                    <svg class="play-icon" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <svg class="pause-icon" viewBox="0 0 24 24" style="display: none;">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                    </svg>
                </div>
                <div class="overlay">
                    <div class="sidebar">
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                </svg>
                            </i>
                            <span>223k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                                </svg>
                            </i>
                            <span>223k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z" />
                                </svg>
                            </i>
                            <span>223k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                                </svg>
                            </i>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg>
                            </i>
                        </div>
                        <div class="speaker">
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                                </svg>
                            </i>
                        </div>
                    </div>
                    <div class="profile-section">
                        <div class="profile-pic">
                            <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='50' height='50'><rect width='50' height='50' fill='%23ff6b6b'/><text x='25' y='32' text-anchor='middle' fill='white' font-size='14' font-family='Arial'>CM</text></svg>"
                                alt="profile">
                            <div class="infinity-badge"></div>
                        </div>
                        <div class="profile-info">
                            <div class="name">CRAVING THE MONSTER</div>
                            <div class="followers">1.5M followers</div>
                        </div>
                        <button class="follow-btn">FOLLOW</button>
                    </div>
                    <div class="ad-caption">
                        <b>Discover the stories behind artists.</b> <span>See more >></span><br>
                        #Pose #meesu #oml
                    </div>
                    <div class="banner-ad">
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='250' height='130'><rect width='250' height='130' fill='%234ecdc4'/><text x='125' y='70' text-anchor='middle' fill='white' font-size='18' font-family='Arial'> Dream Home</text></svg>"
                            alt="ad">
                        <div class="close-btn"></div>
                    </div>
                </div>
            </div>

            <!-- Post 2 -->
            <div class="video-post">
                <video src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"
                    autoplay muted loop></video>
                <div class="play-pause-overlay">
                    <svg class="play-icon" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <svg class="pause-icon" viewBox="0 0 24 24" style="display: none;">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                    </svg>
                </div>
                <div class="overlay">
                    <div class="sidebar">
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                                </svg>
                            </i>
                            <span>89k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
                                </svg>
                            </i>
                            <span>14k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z" />
                                </svg>
                            </i>
                            <span>5k</span>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                                </svg>
                            </i>
                        </div>
                        <div>
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                </svg>
                            </i>
                        </div>
                        <div class="speaker">
                            <i>
                                <svg width="26" height="26" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                                </svg>
                            </i>
                        </div>
                    </div>
                    <div class="profile-section">
                        <div class="profile-pic">
                            <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='50' height='50'><rect width='50' height='50' fill='%234ecdc4'/><text x='25' y='32' text-anchor='middle' fill='white' font-size='16' font-family='Arial'>DJ</text></svg>"
                                alt="profile">
                            <div class="infinity-badge"></div>
                        </div>
                        <div class="profile-info">
                            <div class="name">DJ SMOKEY</div>
                            <div class="followers">900K followers</div>
                        </div>
                        <button class="follow-btn">FOLLOW</button>
                    </div>
                    <div class="ad-caption">
                        <b>Join the hottest party of 2025!</b> <span>Tap now >></span><br>
                        #Party #Vibes #Live
                    </div>
                    <div class="banner-ad">
                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='250' height='130'><rect width='250' height='130' fill='%23667eea'/><text x='125' y='70' text-anchor='middle' fill='white' font-size='18' font-family='Arial'> Club Night</text></svg>"
                            alt="ad">
                        <div class="close-btn"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="friendTab" class="tab-content" style="display: none;">
        <div class="tweet-feed-page">
            <!-- Create Post Section -->
            <div class="create-post-card">
                <div class="create-post-header">
                    <div class="user-avatar" id="tweetUserAvatar"></div>
                    <textarea class="create-post-input" placeholder="What's happening?" maxlength="500"></textarea>
                </div>
                <div class="create-post-actions">
                    <div class="action-buttons">
                        <button class="action-icon-btn"> Add Media</button>
                        <button class="action-icon-btn"> Video</button>
                        <button class="action-icon-btn"> Tag Creator</button>
                    </div>
                    <button class="post-submit-btn">POST </button>
                </div>
            </div>

            <!-- Feed Timeline -->
            <div class="feed-timeline">
                <!-- Post 1 -->
                <div class="timeline-post">
                    <div class="post-user-info">
                        <div class="user-avatar"></div>
                        <div class="user-details">
                            <div class="user-name">Display Name <span class="verified"></span></div>
                            <div class="user-handle">@username  2m ago</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="post-text">Just dropped my latest dance clip  #PoseChallenge</p>
                        <div class="post-media">
                            <div class="media-thumbnail"
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 250px; border-radius: 12px;">
                            </div>
                        </div>
                    </div>
                    <div class="post-interactions">
                        <span class="interaction-btn"> 3.2K</span>
                        <span class="interaction-btn"> 220</span>
                        <span class="interaction-btn"> 80</span>
                        <span class="interaction-btn tip-btn"> Tip Creator</span>
                    </div>
                </div>

                <!-- Post 2 -->
                <div class="timeline-post">
                    <div class="post-user-info">
                        <div class="user-avatar"></div>
                        <div class="user-details">
                            <div class="user-name">Creator Name <span class="verified"></span></div>
                            <div class="user-handle">@creatorhandle  25m ago</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="post-text">I made 10,000 today from exclusive views </p>
                        <div class="post-media">
                            <div class="media-thumbnail"
                                style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); height: 200px; border-radius: 12px;">
                            </div>
                        </div>
                    </div>
                    <div class="post-interactions">
                        <span class="interaction-btn"> 2.1K</span>
                        <span class="interaction-btn"> 180</span>
                        <span class="interaction-btn"> 75</span>
                        <span class="interaction-btn tip-btn"> Tip Creator</span>
                    </div>
                </div>

                <!-- Post 3 -->
                <div class="timeline-post">
                    <div class="post-user-info">
                        <div class="user-avatar"></div>
                        <div class="user-details">
                            <div class="user-name">@user</div>
                            <div class="user-handle">1h ago</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="post-text">Pose feed is cleaner than Twitter ngl </p>
                    </div>
                    <div class="post-interactions">
                        <span class="interaction-btn"> 540</span>
                        <span class="interaction-btn"> 70</span>
                        <span class="interaction-btn"> 18</span>
                        <span class="interaction-btn tip-btn"> Tip Creator</span>
                    </div>
                </div>

                <!-- Post 4 -->
                <div class="timeline-post">
                    <div class="post-user-info">
                        <div class="user-avatar"></div>
                        <div class="user-details">
                            <div class="user-name">@creator</div>
                            <div class="user-handle">3h ago</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="post-text">Uploading new exclusive content tonight </p>
                        <div class="post-media">
                            <div class="media-thumbnail"
                                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); height: 220px; border-radius: 12px;">
                            </div>
                        </div>
                    </div>
                    <div class="post-interactions">
                        <span class="interaction-btn"> 1.9K</span>
                        <span class="interaction-btn"> 200</span>
                        <span class="interaction-btn"> 60</span>
                        <span class="interaction-btn tip-btn"> Tip Creator</span>
                    </div>
                </div>
            </div>

            <!-- Show More Section -->
            <div class="load-more-section">
                <button class="load-more-btn">Show More Posts </button>
                <p class="load-more-text">Scroll to load more...</p>
            </div>
        </div>
    </div>

    <div id="poseTab" class="tab-content" style="display: none;">
        <!-- Video Grid -->
        <div class="video-grid-page">
            <div class="grid-header">
                <h2>My Videos</h2>
            </div>

            <div class="video-grid-container">
                <!-- Video Item 1 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Dance Challenge Day 1</div>
                        <div class="grid-stats">
                            <span> 12K</span>
                            <span>2,000</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 2 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Comedy Skit #5</div>
                        <div class="grid-stats">
                            <span> 8.5K</span>
                            <span>1,500</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 5 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Behind The Scenes</div>
                        <div class="grid-stats">
                            <span> 7.2K</span>
                            <span>1,000</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 6 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Live Stream Recap</div>
                        <div class="grid-stats">
                            <span> 4.1K</span>
                            <span>600</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>
                <!-- Video Item 3 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Tutorial Video</div>
                        <div class="grid-stats">
                            <span> 5K</span>
                            <span>800</span>
                        </div>
                    </div>
                </div>

                <!-- Video Item 4 -->
                <div class="grid-video-item">
                    <div class="grid-thumbnail" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    </div>
                    <div class="grid-info">
                        <div class="grid-title">Music Video</div>
                        <div class="grid-stats">
                            <span> 9K</span>
                            <span>1,200</span>
                        </div>
                    </div>
                </div>

            </div>

            <div class="load-more">
                <button class="load-more-btn">Load More Videos </button>
            </div>
        </div>
    </div>
    <!-- Welcome Popup -->
    <div class="welcome-overlay" id="welcomePopup">
        <div class="welcome-modal">
            <!-- Logo and Branding -->
            <div class="welcome-logo">
                <div class="logo-icon">
                    <img src="https://i.ibb.co/60JJMHGJ/Red-and-White-Video-Centric-Coming-Soon-Instagram-Post-20250917-230708-0000.png"
                        alt="Red-and-White-Video-Centric-Coming-Soon-Instagram-Post-20250917-230708-0000"
                        class="logo-img" />
                </div>
                <h1 class="logo-text">POSE</h1>
            </div>



            <!-- Welcome Message -->
            <div class="welcome-message">
                <h2>Welcome to Pose (sample version)</h2>
                <p>Pose helps African creators get <strong>instant</strong> and <strong>multiple revenue models</strong>
                </p>
                <div class="features-list">
                    <div class="feature-item"> Get paid from 100 views</div>
                    <div class="feature-item"> Earn 70-85% of your revenue</div>
                    <div class="feature-item"> Multiple income streams</div>
                    <div class="feature-item"> Instant withdrawals</div>
                </div>
            </div>

            <!-- Auth Buttons -->
            <div class="welcome-actions">
                <button class="welcome-btn signup-btn" onclick="openSignupFromWelcome()">
                    Create Account
                </button>
                <button class="welcome-btn login-btn" onclick="openLoginFromWelcome()">
                    Sign In
                </button>
                <button class="skip-btn" onclick="closeWelcomePopup()">
                    Skip for now
                </button>
            </div>

            <!-- Footer -->
            <div class="welcome-footer">
                <p>Join thousands of African creators earning today </p>
            </div>
        </div>
    </div>

    <!-- Upload Page -->
    <div class="upload-page" id="uploadPage">
        <!-- Header -->
        <div class="upload-header">
            <button class="back-btn" onclick="closeUploadPage()"></button>
            <h1>Upload Content</h1>
            <div class="header-spacer"></div>
        </div>

        <!-- Tabs -->
        <div class="upload-tabs">
            <div class="upload-tab active" onclick="switchUploadTab('tweet')">Tweet</div>
            <div class="upload-tab" onclick="switchUploadTab('post')">Post</div>
            <div class="upload-tab" onclick="switchUploadTab('record')"> Record</div>
        </div>

        <!-- Tweet Tab Content -->
        <div class="tab-content-upload active" id="tweetTab">
            <div class="upload-form">
                <textarea class="upload-textarea" id="tweetText" placeholder="What's on your mind?"
                    maxlength="500"></textarea>

                <div class="media-upload-section">
                    <label class="media-label">Attach Media (Optional)</label>
                    <div class="media-buttons">
                        <input type="file" id="tweetMedia" accept="image/*,video/*" style="display: none;"
                            onchange="autoUploadVideo(this, 'tweet')">
                        <button class="media-btn" onclick="document.getElementById('tweetMedia').click()">
                            Image</button>
                        <button class="media-btn" onclick="document.getElementById('tweetMedia').click()">
                            Video</button>
                    </div>
                    <div id="tweetUploadStatus" style="color: #aaa; font-size: 12px; margin-top: 8px;"></div>
                    <div id="tweetMediaPreview" class="media-preview"></div>
                </div>

                <button class="done-btn" onclick="openTweetPreview()">Done</button>
            </div>
        </div>

        <!-- Debug Panel -->
        <div id="debugPanel"
            style="background: #222; color: #0f0; padding: 15px; margin-bottom: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 150px; overflow-y: auto; display: none;">
            <div style="text-align: right;">
                <button onclick="document.getElementById('debugPanel').style.display='none'"
                    style="background: #444; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px;">Close</button>
            </div>
            <div id="debugLog"></div>
        </div>

        <!-- Post Tab Content -->
        <div class="tab-content-upload" id="postTab">
            <div class="upload-form">
                <button type="button" onclick="toggleDebug()"
                    style="background: #666; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 15px; width: 100%;">
                    Toggle Debug Panel</button>
                <div class="form-group">
                    <label class="form-label">Upload Video</label>
                    <input type="file" id="postVideo" accept="video/*" class="file-input"
                        onchange="autoUploadVideo(this, 'post')">
                    <div id="postUploadStatus" style="color: #aaa; font-size: 12px; margin-top: 8px;"></div>
                    <div id="postVideoPreview" class="media-preview"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" id="postTitle" class="text-input" placeholder="Enter video title">
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="postDescription" class="upload-textarea" placeholder="Describe your video..."
                        rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Tags</label>
                    <input type="text" id="postTags" class="text-input" placeholder="#fun #pose #viral">
                </div>

                <div class="form-group">
                    <label class="form-label">Video Price</label>
                    <div class="price-options-group">
                        <div class="price-options">
                            <button type="button" class="price-btn active" onclick="setPostPrice(0, 'free')"
                                id="priceFreBtn"> Free</button>
                            <button type="button" class="price-btn" onclick="setPostPrice(1, '1pc')" id="price1pcBtn">
                                1 PC</button>
                            <button type="button" class="price-btn" onclick="setPostPrice(2, '2pc')" id="price2pcBtn">
                                2 PC</button>
                        </div>
                        <button class="price-info-icon" type="button">
                            <div class="price-tooltip">1 PC = 25</div>
                        </button>
                    </div>
                </div>

                <input type="hidden" id="postPrice" value="0">
                <input type="hidden" id="postPriceType" value="free">

                <div class="form-group">
                    <label class="form-label">Thumbnail</label>
                    <input type="file" id="postThumbnail" accept="image/*" class="file-input">
                    <div id="postThumbnailPreview" class="media-preview"></div>
                </div>

                <button class="done-btn" onclick="window.uploadPost()">Post Video</button>
            </div>
        </div>

        <!-- Record Tab Content (TikTok-Style Video Creator) -->
        <div class="tab-content-upload" id="recordTab">
            <!-- Recording Interface -->
            <div id="recordingInterface" class="record-interface active">
                <!-- Camera Preview & Controls -->
                <div class="record-container">
                    <video id="cameraPreview" class="camera-preview" autoplay playsinline></video>
                    <canvas id="effectsCanvas" class="effects-canvas" style="display:none;"></canvas>

                    <!-- Grid Lines (Optional) -->
                    <div id="gridOverlay" class="grid-overlay" style="display:none;">
                        <div class="grid-line horizontal top"></div>
                        <div class="grid-line horizontal middle"></div>
                        <div class="grid-line horizontal bottom"></div>
                        <div class="grid-line vertical left"></div>
                        <div class="grid-line vertical middle"></div>
                        <div class="grid-line vertical right"></div>
                    </div>

                    <!-- Timer Display -->
                    <div id="timerDisplay" class="timer-display">00:00</div>

                    <!-- Recording Clips List -->
                    <div id="clipsPreview" class="clips-preview"></div>
                </div>

                <!-- Top Controls Bar -->
                <div class="record-top-controls">
                    <button class="control-btn" id="gridToggle" onclick="toggleGrid()" title="Toggle Grid">
                        Grid</button>
                    <button class="control-btn" id="flashToggle" onclick="toggleFlash()" title="Toggle Flash">
                        Flash</button>
                    <button class="control-btn" id="flipCamera" onclick="flipCamera()" title="Flip Camera">
                        Flip</button>
                    <button class="control-btn" id="beautyToggle" onclick="openBeautyMode()" title="Beauty Mode">
                        Beauty</button>
                </div>

                <!-- Beauty Mode Slider -->
                <div id="beautyPanel" class="beauty-panel" style="display:none;">
                    <label>Smooth Skin: <span id="beautyValue">0</span></label>
                    <input type="range" id="beautySlider" min="0" max="100" value="0" onchange="applyBeautyEffect()">
                    <label>Sharpen: <span id="sharpenValue">0</span></label>
                    <input type="range" id="sharpenSlider" min="0" max="100" value="0" onchange="applyBeautyEffect()">
                    <button class="done-btn" onclick="closeBeautyMode()">Done</button>
                </div>

                <!-- Middle Controls - Recording & Speed -->
                <div class="record-middle-controls">
                    <div class="speed-control">
                        <label>Speed</label>
                        <div class="speed-buttons">
                            <button class="speed-btn" onclick="setRecordingSpeed(0.3)">0.3x</button>
                            <button class="speed-btn" onclick="setRecordingSpeed(0.5)">0.5x</button>
                            <button class="speed-btn active" onclick="setRecordingSpeed(1)">1x</button>
                            <button class="speed-btn" onclick="setRecordingSpeed(2)">2x</button>
                            <button class="speed-btn" onclick="setRecordingSpeed(3)">3x</button>
                        </div>
                    </div>

                    <div class="mode-control">
                        <label>Mode</label>
                        <div class="mode-buttons">
                            <button class="mode-btn active" onclick="setRecordMode('normal')"> Normal</button>
                            <button class="mode-btn" onclick="setRecordMode('handsfree')"> Hands-Free</button>
                        </div>
                    </div>

                    <div class="duration-control">
                        <label>Duration</label>
                        <select id="maxDuration" class="duration-select">
                            <option value="15">15 seconds</option>
                            <option value="30">30 seconds</option>
                            <option value="60">1 minute</option>
                            <option value="180">3 minutes</option>
                            <option value="600">10 minutes</option>
                        </select>
                    </div>

                    <div class="aspect-control">
                        <label>Aspect Ratio</label>
                        <div class="aspect-buttons">
                            <button class="aspect-btn active" onclick="setAspectRatio('9:16')">9:16</button>
                            <button class="aspect-btn" onclick="setAspectRatio('1:1')">1:1</button>
                            <button class="aspect-btn" onclick="setAspectRatio('16:9')">16:9</button>
                        </div>
                    </div>
                </div>

                <!-- Bottom Recording Controls -->
                <div class="record-bottom-controls">
                    <button class="action-btn delete-btn" id="deleteLastClip" onclick="deleteLastClip()"
                        style="display:none;"> Delete</button>

                    <div class="main-controls">
                        <button class="action-btn record-btn" id="recordStartBtn" onclick="startRecording()">
                            Start</button>
                        <button class="action-btn record-btn stop-btn" id="recordStopBtn" onclick="stopRecording()"
                            style="display:none;"> Stop</button>
                    </div>

                    <button class="action-btn next-btn" id="proceedToEdit" onclick="proceedToEdit()"
                        style="display:none;"> Next</button>
                </div>

                <!-- Hands-Free Countdown -->
                <div id="countdownOverlay" class="countdown-overlay" style="display:none;">
                    <div class="countdown-number" id="countdownNumber">3</div>
                </div>
            </div>

            <!-- Editor Interface -->
            <div id="editorInterface" class="editor-interface" style="display:none;">
                <div class="editor-header">
                    <button class="back-btn" onclick="backToRecording()"> Back</button>
                    <h3>Edit Video</h3>
                </div>

                <!-- Video Preview -->
                <div class="editor-preview">
                    <video id="editorPreview" controls class="editor-video"></video>
                </div>

                <!-- Clips Timeline -->
                <div class="clips-timeline">
                    <h4>Your Clips</h4>
                    <div id="clipsTimeline" class="timeline-tracks"></div>
                </div>

                <!-- Editor Tabs -->
                <div class="editor-tabs">
                    <button class="editor-tab-btn active" onclick="switchEditorTab('trim')"> Trim</button>
                    <button class="editor-tab-btn" onclick="switchEditorTab('filters')"> Filters</button>
                    <button class="editor-tab-btn" onclick="switchEditorTab('effects')"> Effects</button>
                    <button class="editor-tab-btn" onclick="switchEditorTab('text')"> Text</button>
                    <button class="editor-tab-btn" onclick="switchEditorTab('audio')"> Audio</button>
                </div>

                <!-- Trim Tab -->
                <div id="trimTab" class="editor-tab-content active">
                    <h4>Trim Clips</h4>
                    <div id="trimControls" class="trim-controls"></div>
                </div>

                <!-- Filters Tab -->
                <div id="filtersTab" class="editor-tab-content" style="display:none;">
                    <h4>Color Filters</h4>
                    <div class="filters-grid">
                        <button class="filter-btn" onclick="applyFilter('none')">Original</button>
                        <button class="filter-btn" onclick="applyFilter('vintage')">Vintage</button>
                        <button class="filter-btn" onclick="applyFilter('cool')">Cool</button>
                        <button class="filter-btn" onclick="applyFilter('warm')">Warm</button>
                        <button class="filter-btn" onclick="applyFilter('bw')">B&W</button>
                        <button class="filter-btn" onclick="applyFilter('sepia')">Sepia</button>
                    </div>
                    <label>Brightness: <span id="brightnessValue">0</span></label>
                    <input type="range" id="brightnessSlider" min="-100" max="100" value="0"
                        onchange="applyFilterAdjustment()">
                    <label>Contrast: <span id="contrastValue">0</span></label>
                    <input type="range" id="contrastSlider" min="-100" max="100" value="0"
                        onchange="applyFilterAdjustment()">
                    <label>Saturation: <span id="saturationValue">0</span></label>
                    <input type="range" id="saturationSlider" min="-100" max="100" value="0"
                        onchange="applyFilterAdjustment()">
                </div>

                <!-- Effects Tab -->
                <div id="effectsTab" class="editor-tab-content" style="display:none;">
                    <h4>Effects & Transitions</h4>
                    <div class="effects-grid">
                        <div class="effect-category">
                            <h5>Transitions</h5>
                            <button class="effect-btn" onclick="applyTransition('swipe')">Swipe</button>
                            <button class="effect-btn" onclick="applyTransition('flash')">Flash</button>
                            <button class="effect-btn" onclick="applyTransition('glitch')">Glitch</button>
                            <button class="effect-btn" onclick="applyTransition('zoom')">Zoom</button>
                        </div>
                        <div class="effect-category">
                            <h5>On-Screen Effects</h5>
                            <button class="effect-btn" onclick="applyEffect('vibrance')">Vibrance</button>
                            <button class="effect-btn" onclick="applyEffect('motionblur')">Motion Blur</button>
                            <button class="effect-btn" onclick="applyEffect('zoom-slow')">Slow Zoom</button>
                            <button class="effect-btn" onclick="applyEffect('sparkles')">Sparkles</button>
                        </div>
                        <div class="effect-category">
                            <h5>Beauty Effects</h5>
                            <button class="effect-btn" onclick="applyEffect('smooth')">Smooth Skin</button>
                            <button class="effect-btn" onclick="applyEffect('sharpen')">Sharpen</button>
                            <button class="effect-btn" onclick="applyEffect('brighten')">Brighten</button>
                        </div>
                    </div>
                </div>

                <!-- Text Tab -->
                <div id="textTab" class="editor-tab-content" style="display:none;">
                    <h4>Add Text & Stickers</h4>
                    <div class="text-controls">
                        <input type="text" id="textInput" class="text-input" placeholder="Enter text">
                        <input type="color" id="textColor" value="#ffffff" title="Text Color">
                        <select id="textAnimation">
                            <option value="none">No Animation</option>
                            <option value="fade">Fade In</option>
                            <option value="typewriter">Typewriter</option>
                            <option value="popup">Pop In</option>
                        </select>
                        <button class="action-btn" onclick="addText()">Add Text</button>
                    </div>
                    <h5>Stickers & Emojis</h5>
                    <div class="stickers-grid" id="stickersGrid">
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                        <button class="sticker-btn" onclick="addSticker('')"></button>
                    </div>
                </div>

                <!-- Audio Tab -->
                <div id="audioTab" class="editor-tab-content" style="display:none;">
                    <h4>Audio Controls</h4>
                    <div class="audio-controls">
                        <button class="action-btn" onclick="openSoundLibrary()"> Add Sound</button>
                        <button class="action-btn" onclick="extractAudio()"> Extract Sound</button>
                    </div>
                    <label>Original Video Volume: <span id="originalVolValue">100</span>%</label>
                    <input type="range" id="originalVolume" min="0" max="100" value="100"
                        onchange="adjustVolume('original')">
                    <label id="bgMusicLabel" style="display:none;">Background Music Volume: <span
                            id="bgMusicVolValue">50</span>%</label>
                    <input type="range" id="bgMusicVolume" min="0" max="100" value="50" onchange="adjustVolume('music')"
                        style="display:none;">
                </div>

                <!-- Action Buttons -->
                <div class="editor-actions">
                    <button class="action-btn" id="saveAsDraft" onclick="saveToDraft()"> Save Draft</button>
                    <button class="action-btn next-btn" onclick="proceedToPreview()"> Next</button>
                </div>
            </div>

            <!-- Pre-Posting Interface (TikTok-Style) -->
            <div id="prePostingInterface" class="pre-posting-interface" style="display:none;">
                <div class="posting-header">
                    <button class="back-btn" onclick="backToEditor()"> Back</button>
                    <h3>Post Your Video</h3>
                </div>

                <!-- Full Screen Preview -->
                <div class="posting-preview">
                    <video id="postingPreview" controls class="posting-video"></video>
                </div>

                <!-- Caption & Hashtags -->
                <div class="posting-form">
                    <div class="form-group">
                        <label>Caption</label>
                        <textarea id="recordCaption" class="text-input" rows="3"
                            placeholder="Write a caption..."></textarea>
                        <div class="caption-suggestions" id="hashtagSuggestions"></div>
                    </div>

                    <div class="form-group">
                        <label>Add Sound</label>
                        <select id="recordSound" class="text-input">
                            <option value="">Original Audio</option>
                            <option value="trending">Trending Sounds</option>
                            <option value="library">Sound Library</option>
                        </select>
                    </div>

                    <!-- Post Options -->
                    <div class="post-options">
                        <label class="option-toggle">
                            <input type="checkbox" id="recordAllowComments" checked>
                            <span>Allow Comments</span>
                        </label>
                        <label class="option-toggle">
                            <input type="checkbox" id="recordAllowSoundReuse" checked>
                            <span>Allow Sound Reuse</span>
                        </label>
                        <label class="option-toggle">
                            <input type="checkbox" id="recordAllowSave" checked>
                            <span>Allow Download</span>
                        </label>
                        <label class="option-toggle">
                            <input type="checkbox" id="recordAllowAds" checked>
                            <span>Allow Ads</span>
                        </label>
                    </div>

                    <!-- Cover Selection -->
                    <div class="form-group">
                        <label>Video Cover</label>
                        <div class="cover-selector">
                            <canvas id="coverCanvas" class="cover-preview"></canvas>
                            <div class="cover-controls">
                                <button class="action-btn" onclick="selectCoverTime()"> Select Cover</button>
                                <input type="range" id="coverTime" min="0" max="100" value="0" style="width:100%;">
                            </div>
                        </div>
                    </div>

                    <!-- Collaborators -->
                    <div class="form-group">
                        <label>Collaborators (Optional)</label>
                        <input type="text" id="recordCollaborators" class="text-input"
                            placeholder="@username @username">
                    </div>

                    <!-- Action Buttons -->
                    <div class="posting-actions">
                        <button class="action-btn draft-btn" onclick="saveToDraft()"> Save Draft</button>
                        <button class="action-btn post-btn" onclick="postRecord()"> Post Video</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tweet Preview Popup -->
    <div class="preview-popup" id="tweetPreviewPopup">
        <div class="preview-modal">
            <button class="modal-close" onclick="closeTweetPreview()"></button>
            <h2>Preview & Details</h2>

            <div class="preview-content">
                <div id="tweetPreviewMedia" class="preview-media"></div>

                <div class="form-group">
                    <label class="form-label">Caption</label>
                    <textarea id="tweetCaption" class="text-input" rows="3" placeholder="Add a caption..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Hashtags</label>
                    <input type="text" id="tweetHashtags" class="text-input" placeholder="#fun #pose">
                </div>

                <div class="form-group">
                    <label class="toggle-label">
                        <span>Allow Ads</span>
                        <input type="checkbox" id="tweetAllowAds" checked>
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">Collaborators (Optional)</label>
                    <input type="text" id="tweetCollaborators" class="text-input" placeholder="@username">
                </div>

                <div class="form-group">
                    <label class="toggle-label">
                        <span>Allow Comments</span>
                        <input type="checkbox" id="tweetAllowComments" checked>
                    </label>
                </div>

                <div class="form-group">
                    <label class="toggle-label">
                        <span>Allow Save</span>
                        <input type="checkbox" id="tweetAllowSave" checked>
                    </label>
                </div>

                <button class="done-btn" onclick="postTweet()">Post</button>
            </div>
        </div>
    </div>

    <!-- Sound Library Modal -->
    <div class="sound-library-modal" id="soundLibraryModal">
        <!-- Header -->
        <div class="sound-library-header">
            <h2> Add Sound</h2>
            <button class="sound-library-close" onclick="closeSoundLibrary()"></button>
        </div>

        <!-- Banner Ads Section -->
        <div class="sound-banner-ads">
            <div class="banner-ads-slider" id="bannerAdsSlider">
                <!-- Banner ads will be populated here -->
            </div>
            <div class="banner-indicators" id="bannerIndicators"></div>
        </div>

        <!-- Sound Tabs -->
        <div class="sound-tabs">
            <button class="sound-tab active" onclick="switchSoundTab('favourite')"> Favourite</button>
            <button class="sound-tab" onclick="switchSoundTab('yourMusic')"> Your Music</button>
            <button class="sound-tab" onclick="switchSoundTab('poseMusic')"> Pose Music</button>
            <button class="sound-tab" onclick="switchSoundTab('voiceOver')"> Voice Over</button>
        </div>

        <!-- Tab Content -->
        <!-- Favourite Tab -->
        <div class="sound-tab-content active" id="favouriteTab">
            <div class="sound-search">
                <input type="text" class="sound-search-input" placeholder="Search favourite sounds..."
                    oninput="searchSounds('favourite', this.value)">
                <span class="search-icon"></span>
            </div>
            <div class="sound-list" id="favouriteSoundList">
                <!-- Sounds will be populated here -->
            </div>
        </div>

        <!-- Your Music Tab -->
        <div class="sound-tab-content" id="yourMusicTab">
            <div class="sound-search">
                <input type="text" class="sound-search-input" placeholder="Search your music..."
                    oninput="searchSounds('yourMusic', this.value)">
                <span class="search-icon"></span>
            </div>
            <div class="sound-list" id="yourMusicSoundList">
                <!-- User's uploaded music will be populated here -->
            </div>
        </div>

        <!-- Pose Music Tab -->
        <div class="sound-tab-content" id="poseMusicTab">
            <div class="sound-search">
                <input type="text" class="sound-search-input" placeholder="Search by artist or song title..."
                    oninput="searchSounds('poseMusic', this.value)">
                <span class="search-icon"></span>
            </div>

            <!-- Search Filters -->
            <div
                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 15px; background: #0a0a0a; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333;">
                <div>
                    <label
                        style="display: block; font-size: 12px; font-weight: 600; color: #888; margin-bottom: 6px;"><i
                            class="fas fa-music"></i> Genre</label>
                    <select id="genreFilter" onchange="applySearchFilters()"
                        style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #444; color: white; border-radius: 6px; font-size: 12px;">
                        <option value="">All Genres</option>
                        <option value="afrobeat">Afrobeat</option>
                        <option value="hip-hop">Hip-Hop</option>
                        <option value="pop">Pop</option>
                        <option value="r&b">R&B</option>
                        <option value="amapiano">Amapiano</option>
                        <option value="reggae">Reggae</option>
                        <option value="house">House</option>
                        <option value="gospel">Gospel</option>
                    </select>
                </div>

                <div>
                    <label
                        style="display: block; font-size: 12px; font-weight: 600; color: #888; margin-bottom: 6px;"><i
                            class="fas fa-globe"></i> Country/Region</label>
                    <select id="countryFilter" onchange="applySearchFilters()"
                        style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #444; color: white; border-radius: 6px; font-size: 12px;">
                        <option value="">All Regions</option>
                        <option value="NG">Nigeria</option>
                        <option value="GH">Ghana</option>
                        <option value="ZA">South Africa</option>
                        <option value="KE">Kenya</option>
                        <option value="UG">Uganda</option>
                        <option value="CM">Cameroon</option>
                        <option value="US">USA</option>
                        <option value="UK">UK</option>
                    </select>
                </div>

                <div>
                    <label
                        style="display: block; font-size: 12px; font-weight: 600; color: #888; margin-bottom: 6px;"><i
                            class="fas fa-calendar"></i> Year Released</label>
                    <input type="number" id="yearFilter" min="2000" max="2025" placeholder="e.g. 2024"
                        onchange="applySearchFilters()"
                        style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #444; color: white; border-radius: 6px; font-size: 12px;">
                </div>
            </div>

            <div class="sound-list" id="poseMusicSoundList">
                <!-- Pose music library will be populated here -->
            </div>
        </div>

        <!-- Voice Over Tab -->
        <div class="sound-tab-content" id="voiceOverTab">
            <div class="voice-recorder">
                <div class="voice-visualizer" id="voiceVisualizer">
                    <span class="voice-icon"></span>
                </div>
                <div class="voice-timer" id="voiceTimer">00:00</div>
                <div class="voice-controls">
                    <button class="voice-btn record" id="voiceRecordBtn" onclick="startVoiceRecording()">
                        
                    </button>
                    <button class="voice-btn stop" id="voiceStopBtn" onclick="stopVoiceRecording()"
                        style="display:none;">
                        
                    </button>
                    <button class="voice-btn save" id="voiceSaveBtn" onclick="saveVoiceRecording()"
                        style="display:none;">
                        
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        console.log('Script loaded!');

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDW8V2SjNITrA4LcdmeILh944mTbOKnM0c",
            authDomain: "rewarderhub.firebaseapp.com",
            projectId: "rewarderhub",
            storageBucket: "rewarderhub.appspot.com",
            messagingSenderId: "85965945106",
            appId: "1:85965945106:web:fa0a57d8968926e1041bcb",
            measurementId: "G-F2ERB5NGN0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        let currentUser = null;

        // ====== Cloudinary Config ======
        const CLOUDINARY_CLOUD_NAME = 'dzhdgxjhl';
        const CLOUDINARY_UPLOAD_PRESET = 'posepreset';
        const CLOUDINARY_API_URL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`;

        // ====== Upload Variables ======
        let postVideoUrl = null;
        let postVideoFileName = null;
        let postVideoQuality = 'hd';
        let exclusiveVideoUrl = null;
        let exclusiveVideoFileName = null;
        let tweetMediaUrl = null;
        let tweetMediaFileName = null;

        let isPostVideoUploading = false;
        let isExclusiveVideoUploading = false;
        let isTweetMediaUploading = false;

        // Auth State Listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                console.log(' User logged in:', user.uid);
                loadUserProfile(user.uid);
            } else {
                currentUser = null;
                console.log(' User logged out');
            }
        });

        // Debug: Log function availability
        console.log(' Functions loaded:', {
            postTweet: typeof window.postTweet,
            uploadPost: typeof window.uploadPost,
            postExclusive: typeof window.postExclusive
        });

        // ====== CLOUDINARY UPLOAD (REPLACED - use uploadToCloudinaryWithProgress instead) ======

        // ====== VIDEO COMPRESSION FUNCTION ======
        async function compressVideo(file, quality = 'hd') {
            const MAX_SIZE_GB = 4.5;
            const MAX_SIZE_BYTES = MAX_SIZE_GB * 1024 * 1024 * 1024;

            if (file.size <= MAX_SIZE_BYTES) {
                console.log(' Video within size limit, no compression needed');
                return { file: file, compressed: false, originalSize: file.size, compressedSize: file.size };
            }

            console.log(` Video size: ${(file.size / (1024 ** 3)).toFixed(2)}GB - Compressing...`);

            // Note: Actual video compression requires FFmpeg (server-side recommended)
            // For now, we'll use Cloudinary's transformations
            return {
                file: file,
                compressed: true,
                originalSize: file.size,
                compressedSize: MAX_SIZE_BYTES,
                quality: quality
            };
        }

        // ====== AUTO-UPLOAD FUNCTION (Handles Post & Tweet) ======
        function autoUploadVideo(fileInput, uploadType) {
            if (!currentUser) {
                alert('Please login first');
                return;
            }

            const file = fileInput.files[0];
            if (!file) return;

            // Show upload UI based on type
            if (uploadType === 'post') {
                showPostUploadUI();
            } else if (uploadType === 'tweet') {
                showTweetUploadUI();
            }

            // Start upload in background
            startUploadProcess(file, uploadType);
        }

        // ====== UPLOAD PROCESS (WITH PROGRESS TRACKING) ======
        async function startUploadProcess(file, uploadType) {
            try {
                // Show progress container
                showUploadProgress();

                let statusElement = null;
                if (uploadType === 'post') {
                    statusElement = document.getElementById('postUploadStatus');
                } else if (uploadType === 'tweet') {
                    statusElement = document.getElementById('tweetUploadStatus');
                }

                const sizeGB = (file.size / (1024 ** 3)).toFixed(2);
                const sizeMB = (file.size / (1024 ** 2)).toFixed(2);
                const needsCompression = sizeGB > 4.5;

                // ====== STEP 1: ANALYZE ======
                updateStepProgress(1, `Analyzing ${sizeMB}MB...`, 0, true);
                await new Promise(resolve => setTimeout(resolve, 800));
                updateStepProgress(1, ` Format: ${file.type.split('/')[1].toUpperCase()}`, 100);

                // ====== STEP 2: OPTIMIZE ======
                updateStepProgress(2, needsCompression ? 'Compressing...' : 'No compression needed', 0, true);

                if (needsCompression) {
                    // Simulate compression (actual compression would happen here)
                    const compressionSteps = [30, 60, 100];
                    for (let progress of compressionSteps) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                        const compressedSize = (file.size * (1 - (progress / 100) * 0.3)).toFixed(2);
                        updateStepProgress(2, `Optimizing: ${compressedSize}MB`, progress);
                    }
                    updateStepProgress(2, `Optimized from ${sizeGB}GB to 4.5GB`, 100);
                } else {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    updateStepProgress(2, `Video ready: ${sizeMB}MB`, 100);
                }

                // ====== STEP 3: UPLOAD ======
                updateStepProgress(3, `Uploading...`, 0, true);

                const result = await uploadToCloudinaryWithProgress(file, uploadType, postVideoQuality);

                if (uploadType === 'post') {
                    postVideoUrl = result.url;
                    postVideoFileName = result.fileName;
                } else if (uploadType === 'tweet') {
                    tweetMediaUrl = result.url;
                    tweetMediaFileName = result.fileName;
                }

                // Complete upload step
                updateStepProgress(3, ` Uploaded successfully`, 100);

                // Update overall progress
                document.getElementById('overallBarFill').style.width = '100%';
                document.getElementById('uploadProgressTitle').textContent = 'Complete!';

                if (statusElement) {
                    statusElement.innerHTML = ` Ready to post`;
                }

                console.log(` ${uploadType} ready:`, result.url);

                // Hide progress after 2 seconds
                setTimeout(() => {
                    hideUploadProgress();
                }, 2000);

            } catch (error) {
                console.error(`Error uploading ${uploadType}:`, error);
                updateStepProgress(3, ` Upload failed`, 0);
                alert(` Upload failed: ${error.message}`);
                setTimeout(() => {
                    hideUploadProgress();
                }, 2000);
            }
        }

        // ====== UPLOAD WITH PROGRESS TRACKING ======
        async function uploadToCloudinaryWithProgress(file, uploadType, quality = 'hd') {
            if (!currentUser || !file) return null;

            const fileName = `${Date.now()}_${file.name}`;
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('tags', `${uploadType},${currentUser.uid}`);
            formData.append('folder', uploadType);

            console.log(' Upload Config:', {
                cloudName: CLOUDINARY_CLOUD_NAME,
                uploadPreset: CLOUDINARY_UPLOAD_PRESET,
                uploadUrl: CLOUDINARY_API_URL,
                fileSize: (file.size / (1024 * 1024)).toFixed(2) + ' MB'
            });

            try {
                return new Promise((resolve, reject) => {
                    const xhr = new XMLHttpRequest();

                    // Timeout after 60 seconds
                    const timeoutId = setTimeout(() => {
                        xhr.abort();
                        reject(new Error('Upload timeout - took too long'));
                    }, 60000);

                    // Track progress
                    xhr.upload.addEventListener('progress', (e) => {
                        if (e.lengthComputable) {
                            const percentComplete = (e.loaded / e.total) * 100;
                            updateUploadStats(e.loaded, e.total);
                            updateStepProgress(3, `Uploading... ${Math.round(percentComplete)}%`, percentComplete);
                            console.log(` Upload progress: ${Math.round(percentComplete)}%`);
                        }
                    });

                    xhr.addEventListener('load', () => {
                        clearTimeout(timeoutId);
                        console.log(` XHR Load event, status: ${xhr.status}`);

                        if (xhr.status === 200) {
                            try {
                                const data = JSON.parse(xhr.responseText);
                                console.log(' Upload successful:', data.secure_url);
                                resolve({
                                    url: data.secure_url,
                                    fileName: fileName,
                                    publicId: data.public_id
                                });
                            } catch (parseError) {
                                console.error(' JSON parse error:', parseError);
                                reject(new Error('Invalid response from Cloudinary'));
                            }
                        } else {
                            console.error(` Upload failed with status ${xhr.status}:`, xhr.responseText);
                            reject(new Error(`Upload failed: ${xhr.status} - ${xhr.statusText}`));
                        }
                    });

                    xhr.addEventListener('error', () => {
                        clearTimeout(timeoutId);
                        console.error(' Network error during upload');
                        reject(new Error('Network error - check your connection'));
                    });

                    xhr.addEventListener('abort', () => {
                        clearTimeout(timeoutId);
                        console.error(' Upload aborted');
                        reject(new Error('Upload was cancelled'));
                    });

                    console.log(' Starting upload to:', CLOUDINARY_API_URL);
                    xhr.open('POST', CLOUDINARY_API_URL, true);
                    xhr.send(formData);
                });

            } catch (error) {
                console.error(` ${uploadType} upload error:`, error);
                throw error;
            }
        }

        // ====== UI HELPERS ======
        function showPostUploadUI() {
            const uploadSection = document.getElementById('postUploadSection');
            if (uploadSection) {
                uploadSection.style.display = 'block';
            }
        }

        function showTweetUploadUI() {
            const uploadSection = document.getElementById('tweetUploadSection');
            if (uploadSection) {
                uploadSection.style.display = 'block';
            }
        }

        function setPostQuality(quality) {
            postVideoQuality = quality;
            document.querySelectorAll('.post-quality-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.quality === quality);
            });
        }

        // ====== UPLOAD PROGRESS TRACKER ======
        const uploadProgress = {
            startTime: 0,
            totalSize: 0,
            uploadedSize: 0,
            lastUpdate: 0,
            uploadSpeed: 0
        };

        function showUploadProgress() {
            const container = document.getElementById('uploadProgressContainer');
            container.classList.add('active');
            container.classList.remove('collapsed');
            resetUploadProgress();
        }

        function hideUploadProgress() {
            const container = document.getElementById('uploadProgressContainer');
            container.classList.remove('active');
        }

        // ====== PRICE OPTIONS ======
        function setPostPrice(priceInPc, priceType) {
            document.getElementById('postPrice').value = priceInPc * 25; // Convert PC to Naira (1 PC = 25 Naira)
            document.getElementById('postPriceType').value = priceType;

            // Update button states
            document.querySelectorAll('.price-btn').forEach(btn => btn.classList.remove('active'));
            if (priceType === 'free') {
                document.getElementById('priceFreBtn').classList.add('active');
            } else if (priceType === '1pc') {
                document.getElementById('price1pcBtn').classList.add('active');
            } else if (priceType === '2pc') {
                document.getElementById('price2pcBtn').classList.add('active');
            }

            console.log(`Price set: ${priceType} (${priceInPc} PC = ${priceInPc * 25})`);
        }

        // ====== TIKTOK-STYLE COUNTDOWN ======
        let tiktokCountdownTimer = null;
        let onCountdownComplete = null;

        function showTiktokCountdown(duration = 5, callback = null) {
            const modal = document.getElementById('tiktokCountdownModal');
            const numberDisplay = document.getElementById('countdownNumberDisplay');

            modal.classList.add('active');
            onCountdownComplete = callback;

            let remaining = duration;
            numberDisplay.textContent = remaining;

            tiktokCountdownTimer = setInterval(() => {
                remaining--;

                if (remaining > 0) {
                    numberDisplay.textContent = remaining;
                } else {
                    clearInterval(tiktokCountdownTimer);
                    modal.classList.remove('active');
                    if (onCountdownComplete) {
                        onCountdownComplete();
                    }
                }
            }, 1000);
        }

        function hideTiktokCountdown() {
            const modal = document.getElementById('tiktokCountdownModal');
            modal.classList.remove('active');
            if (tiktokCountdownTimer) {
                clearInterval(tiktokCountdownTimer);
            }
        }

        // ====== UPLOAD RESULT MODAL ======
        let countdownTimer = null;

        function showUploadResultModal(isSuccess, title, message, thumbnailUrl = null) {
            const modal = document.getElementById('uploadResultModal');
            const resultTitle = document.getElementById('uploadResultTitle');
            const resultMessage = document.getElementById('uploadResultMessage');
            const resultThumbnail = document.getElementById('uploadResultThumbnail');
            const countdownSection = document.getElementById('uploadResultCountdown');

            resultTitle.textContent = title;
            resultMessage.textContent = message;
            resultMessage.className = `upload-result-message ${isSuccess ? 'success' : 'error'}`;

            if (thumbnailUrl) {
                resultThumbnail.innerHTML = `<img src="${thumbnailUrl}" alt="thumbnail">`;
            } else {
                resultThumbnail.innerHTML = isSuccess ? '' : '';
            }

            modal.classList.add('active');

            // TikTok countdown already happened, so just hide this countdown section
            countdownSection.style.display = 'none';
        }

        function startCountdown(seconds) {
            // Clear any existing timer
            if (countdownTimer) clearInterval(countdownTimer);

            let remaining = seconds;
            const countdownNumber = document.getElementById('countdownNumber');
            const countdownBarFill = document.getElementById('countdownBarFill');

            countdownNumber.textContent = remaining;
            countdownBarFill.style.width = '100%';

            countdownTimer = setInterval(() => {
                remaining--;
                countdownNumber.textContent = remaining;

                // Update progress bar (width decreases)
                const percentRemaining = (remaining / seconds) * 100;
                countdownBarFill.style.width = percentRemaining + '%';

                if (remaining <= 0) {
                    clearInterval(countdownTimer);
                    closeUploadResultModal();
                }
            }, 1000);
        }

        function closeUploadResultModal() {
            const modal = document.getElementById('uploadResultModal');
            modal.classList.remove('active');
            if (countdownTimer) clearInterval(countdownTimer);
        }

        function resetUploadProgress() {
            uploadProgress.startTime = Date.now();
            uploadProgress.uploadedSize = 0;
            uploadProgress.lastUpdate = Date.now();
            uploadProgress.uploadSpeed = 0;

            // Reset all steps
            ['step1', 'step2', 'step3'].forEach(step => {
                document.getElementById(`${step}Icon`).className = 'step-icon pending';
                document.getElementById(`${step}Bar`).classList.remove('active');
                document.getElementById(`${step}Bar`).querySelector('.step-bar-fill').style.width = '0%';
            });

            document.getElementById('overallBarFill').style.width = '0%';
            document.getElementById('uploadElapsedTime').textContent = '0s';
            document.getElementById('uploadStats').textContent = '0 MB / 0 MB';
            document.getElementById('uploadSpeed').textContent = '0 MB/s';
        }

        function updateStepProgress(stepNum, label, progress, isActive = false) {
            const stepIcon = document.getElementById(`step${stepNum}Icon`);
            const stepProgress = document.getElementById(`step${stepNum}Progress`);
            const stepBar = document.getElementById(`step${stepNum}Bar`);
            const stepBarFill = stepBar.querySelector('.step-bar-fill');

            if (isActive) {
                stepIcon.className = 'step-icon active';
                stepBar.classList.add('active');
            }

            stepProgress.textContent = label;
            stepBarFill.style.width = progress + '%';

            if (progress === 100) {
                stepIcon.className = 'step-icon completed';
                stepIcon.innerHTML = '';
            }
        }

        function updateUploadStats(uploadedBytes, totalBytes) {
            uploadProgress.uploadedSize = uploadedBytes;
            uploadProgress.totalSize = totalBytes;

            const now = Date.now();
            const timeDiff = (now - uploadProgress.lastUpdate) / 1000; // seconds
            const bytesDiff = uploadedBytes - (uploadProgress.uploadedSize - (uploadedBytes % 1000));

            if (timeDiff > 0) {
                uploadProgress.uploadSpeed = (bytesDiff / timeDiff) / (1024 * 1024); // MB/s
                uploadProgress.lastUpdate = now;
            }

            const elapsedSeconds = Math.floor((now - uploadProgress.startTime) / 1000);
            const uploadedMB = (uploadedBytes / (1024 * 1024)).toFixed(2);
            const totalMB = (totalBytes / (1024 * 1024)).toFixed(2);
            const percentComplete = Math.round((uploadedBytes / totalBytes) * 100);

            document.getElementById('uploadElapsedTime').textContent = elapsedSeconds + 's';
            document.getElementById('uploadStats').textContent = `${uploadedMB} MB / ${totalMB} MB`;
            document.getElementById('uploadSpeed').textContent = uploadProgress.uploadSpeed.toFixed(1) + ' MB/s';

            // Update overall progress
            const overallPercent = (percentComplete * 0.5) + 33; // Assume 33% for analyze + optimize
            document.getElementById('overallBarFill').style.width = overallPercent + '%';
        }

        // Handle Profile Icon Click
        function handleProfileClick() {
            if (currentUser) {
                openProfile();
            } else {
                openAuthModal();
            }
        }

        // Open Auth Modal
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }

        // Close Auth Modal
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authError').style.display = 'none';
            document.getElementById('loginError').style.display = 'none';
        }

        // Switch to Login
        function switchToLogin() {
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }

        // Switch to Signup
        function switchToSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
        }

        // Handle Signup
        async function handleSignup() {
            const name = document.getElementById('signupName').value.trim();
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!name || !username || !email || !password) {
                showError('authError', 'Please fill in all fields');
                return;
            }

            if (password.length < 6) {
                showError('authError', 'Password must be at least 6 characters');
                return;
            }

            try {
                // Create user
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Save user profile to Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    username: username,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    followers: 0,
                    following: 0,
                    likes: 0,
                    views: 0,
                    earnings: 0
                });

                closeAuthModal();
                openProfile();
            } catch (error) {
                showError('authError', error.message);
            }
        }

        // Handle Login
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showError('loginError', 'Please fill in all fields');
                return;
            }

            try {
                await auth.signInWithEmailAndPassword(email, password);
                closeAuthModal();
                openProfile();
            } catch (error) {
                showError('loginError', error.message);
            }
        }

        // Show Error
        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        // Load User Profile
        async function loadUserProfile(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    const userData = doc.data();
                    document.getElementById('profileDisplayName').textContent = userData.name;
                    document.getElementById('profileUsernameDisplay').textContent = '@' + userData.username;
                    document.getElementById('profilePicLarge').textContent = userData.name.charAt(0).toUpperCase();
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Open Profile
        function openProfile() {
            document.getElementById('profilePage').classList.add('active');
        }

        // Close Profile
        function closeProfile() {
            document.getElementById('profilePage').classList.remove('active');
        }

        // Logout
        async function logout() {
            if (confirm('Are you sure you want to logout?')) {
                await auth.signOut();
                closeProfile();
            }
        }

        // Switch Profile Tab
        // ====== PROFILE TAB MANAGEMENT ======
        function switchProfileTab(tabName) {
            // Update tab active state
            const tabs = document.querySelectorAll('.profile-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Hide all tab content
            document.querySelectorAll('.profile-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Show selected tab and load content
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.style.display = 'block';

                // Load content for each tab
                if (currentUser) {
                    switch (tabName) {
                        case 'feed':
                            loadProfileFeed();
                            break;
                        case 'exclusive':
                            loadExclusiveVideos();
                            break;
                        case 'shorts':
                            loadShortVideos();
                            break;
                        case 'tweets':
                            loadProfileTweets();
                            break;
                        case 'liked':
                            loadLikedContent();
                            break;
                        case 'stories':
                            loadStories();
                            break;
                    }
                }
            }
        }

        // Load all posted videos (Feed)
        async function loadProfileFeed() {
            if (!currentUser) return;

            try {
                const feedGrid = document.getElementById('feedGrid');
                feedGrid.innerHTML = '<div class="loading">Loading feed...</div>';

                const snapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('type', '==', 'video')
                    .orderBy('createdAt', 'desc')
                    .limit(12)
                    .get();

                feedGrid.innerHTML = '';

                if (snapshot.empty) {
                    feedGrid.innerHTML = '<div class="empty-state">No videos posted yet</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const videoItem = createVideoItem(doc.id, data);
                    feedGrid.appendChild(videoItem);
                });
            } catch (error) {
                console.error('Error loading feed:', error);
                document.getElementById('feedGrid').innerHTML = '<div class="error">Error loading feed</div>';
            }
        }

        // Load exclusive (paid) videos
        async function loadExclusiveVideos() {
            if (!currentUser) return;

            try {
                const exclusiveGrid = document.getElementById('exclusiveGrid');
                exclusiveGrid.innerHTML = '<div class="loading">Loading exclusive content...</div>';

                const snapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('type', '==', 'video')
                    .where('isExclusive', '==', true)
                    .where('price', '>', 0)
                    .orderBy('createdAt', 'desc')
                    .get();

                exclusiveGrid.innerHTML = '';

                if (snapshot.empty) {
                    exclusiveGrid.innerHTML = '<div class="empty-state">No exclusive content yet</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const videoItem = createExclusiveVideoItem(doc.id, data);
                    exclusiveGrid.appendChild(videoItem);
                });
            } catch (error) {
                console.error('Error loading exclusive videos:', error);
                document.getElementById('exclusiveGrid').innerHTML = '<div class="error">Error loading exclusive content</div>';
            }
        }

        // Load short videos (5-15 seconds)
        async function loadShortVideos() {
            if (!currentUser) return;

            try {
                const shortsGrid = document.getElementById('shortsGrid');
                shortsGrid.innerHTML = '<div class="loading">Loading shorts...</div>';

                const snapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('type', '==', 'video')
                    .where('duration', '>=', 5)
                    .where('duration', '<=', 15)
                    .orderBy('createdAt', 'desc')
                    .get();

                shortsGrid.innerHTML = '';

                if (snapshot.empty) {
                    shortsGrid.innerHTML = '<div class="empty-state">No shorts created yet</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const videoItem = createVideoItem(doc.id, data);
                    shortsGrid.appendChild(videoItem);
                });
            } catch (error) {
                console.error('Error loading shorts:', error);
                document.getElementById('shortsGrid').innerHTML = '<div class="error">Error loading shorts</div>';
            }
        }

        // Load profile tweets
        async function loadProfileTweets() {
            if (!currentUser) return;

            try {
                const tweetsContainer = document.getElementById('tweetsContainer');
                tweetsContainer.innerHTML = '<div class="loading">Loading tweets...</div>';

                const snapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('type', '==', 'tweet')
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .get();

                tweetsContainer.innerHTML = '';

                if (snapshot.empty) {
                    tweetsContainer.innerHTML = '<div class="empty-state">No tweets yet</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const tweetElement = createTweetElement(doc.id, data);
                    tweetsContainer.appendChild(tweetElement);
                });
            } catch (error) {
                console.error('Error loading tweets:', error);
                document.getElementById('tweetsContainer').innerHTML = '<div class="error">Error loading tweets</div>';
            }
        }

        // Load liked content
        async function loadLikedContent() {
            if (!currentUser) return;

            try {
                const likedGrid = document.getElementById('likedGrid');
                likedGrid.innerHTML = '<div class="loading">Loading liked content...</div>';

                const userLikesDoc = await db.collection('users').doc(currentUser.uid).get();
                const likedIds = userLikesDoc.data()?.likedPosts || [];

                if (likedIds.length === 0) {
                    likedGrid.innerHTML = '<div class="empty-state">No liked posts yet</div>';
                    return;
                }

                likedGrid.innerHTML = '';

                // Fetch liked posts in chunks
                for (let i = 0; i < likedIds.length; i += 10) {
                    const chunk = likedIds.slice(i, i + 10);
                    const snapshot = await db.collection('posts')
                        .where(firebase.firestore.FieldPath.documentId(), 'in', chunk)
                        .get();

                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const videoItem = createVideoItem(doc.id, data);
                        likedGrid.appendChild(videoItem);
                    });
                }
            } catch (error) {
                console.error('Error loading liked content:', error);
                document.getElementById('likedGrid').innerHTML = '<div class="error">Error loading liked content</div>';
            }
        }

        // Load stories
        async function loadStories() {
            if (!currentUser) return;

            try {
                const storiesContainer = document.getElementById('storiesContainer');
                storiesContainer.innerHTML = '<div class="loading">Loading stories...</div>';

                const snapshot = await db.collection('posts')
                    .where('userId', '==', currentUser.uid)
                    .where('type', '==', 'story')
                    .orderBy('createdAt', 'desc')
                    .get();

                storiesContainer.innerHTML = '';

                if (snapshot.empty) {
                    storiesContainer.innerHTML = '<div class="empty-state">No stories created yet</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const storyElement = createStoryElement(doc.id, data);
                    storiesContainer.appendChild(storyElement);
                });
            } catch (error) {
                console.error('Error loading stories:', error);
                document.getElementById('storiesContainer').innerHTML = '<div class="error">Error loading stories</div>';
            }
        }

        // Create video item with interactions
        function createVideoItem(postId, data) {
            const item = document.createElement('div');
            item.className = 'video-item';
            item.innerHTML = `
                <div class="video-thumbnail" style="position: relative; height: 100%; background: ${data.thumbnailGradient || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'} center/cover;">
                    ${data.thumbnail ? `<img src="${data.thumbnail}" style="width: 100%; height: 100%; object-fit: cover;">` : ''}
                    <div class="video-overlay">
                        <div class="play-btn"></div>
                    </div>
                </div>
                <div class="video-stats">
                    <span> ${data.comments || 0}</span>
                    <span> ${data.views || 0}</span>
                    <span> ${data.likes || 0}</span>
                </div>
                <div class="video-actions">
                    <button class="action-btn" onclick="likePost('${postId}')"> Like</button>
                    <button class="action-btn" onclick="commentOnPost('${postId}')"> Comment</button>
                    <button class="action-btn" onclick="sharePost('${postId}')"> Share</button>
                    <button class="action-btn" onclick="downloadPost('${postId}')"> Download</button>
                </div>
            `;
            return item;
        }

        // Create exclusive video item
        function createExclusiveVideoItem(postId, data) {
            const item = document.createElement('div');
            item.className = 'video-item';
            item.innerHTML = `
                <div class="video-thumbnail exclusive-lock" style="position: relative; height: 100%; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); display: flex; align-items: center; justify-content: center;">
                    <div style="text-align: center;">
                        <div style="font-size: 40px; margin-bottom: 10px;"></div>
                        <div style="color: white; font-weight: bold;">${data.price || 0}</div>
                    </div>
                </div>
                <div class="video-stats">
                    <span> ${data.comments || 0}</span>
                    <span> ${data.views || 0}</span>
                </div>
            `;
            return item;
        }

        // Create tweet element
        function createTweetElement(postId, data) {
            const createdAt = data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString() : 'Just now';
            const tweet = document.createElement('div');
            tweet.className = 'profile-tweet-item';
            tweet.innerHTML = `
                <div class="tweet-header">
                    <div class="tweet-avatar"></div>
                    <div>
                        <div class="tweet-author">${data.authorName || 'Anonymous'}</div>
                        <div class="tweet-time">${createdAt}</div>
                    </div>
                </div>
                <div class="tweet-text">${data.text || ''}</div>
                ${data.media ? `<div class="tweet-media"><img src="${data.media}" style="max-width: 100%; border-radius: 10px;"></div>` : ''}
                <div class="tweet-actions">
                    <button class="tweet-action-btn" onclick="likeTweet('${postId}')"> ${data.likes || 0}</button>
                    <button class="tweet-action-btn" onclick="commentTweet('${postId}')"> ${data.comments || 0}</button>
                    <button class="tweet-action-btn" onclick="retweet('${postId}')"> ${data.retweets || 0}</button>
                    <button class="tweet-action-btn" onclick="sharePost('${postId}')"> Share</button>
                </div>
            `;
            return tweet;
        }

        // Create story element
        function createStoryElement(postId, data) {
            const story = document.createElement('div');
            story.className = 'story-item';
            story.style.cssText = `
                background: ${data.thumbnail ? `url(${data.thumbnail}) center/cover` : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'};
                border-radius: 15px;
                aspect-ratio: 9/16;
                cursor: pointer;
                position: relative;
                overflow: hidden;
            `;
            story.innerHTML = `
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">
                    <div style="text-align: center; color: white;">
                        <div style="font-size: 30px;"></div>
                        <div style="margin-top: 10px; font-size: 12px;">View Story</div>
                    </div>
                </div>
            `;
            story.onclick = () => viewStory(postId);
            return story;
        }

        // Post new tweet
        async function postNewTweet() {
            if (!currentUser) {
                alert('Please login first');
                return;
            }

            const text = document.getElementById('profileTweetInput').value.trim();
            if (!text) {
                alert('Please type something');
                return;
            }

            try {
                await db.collection('posts').add({
                    userId: currentUser.uid,
                    type: 'tweet',
                    text: text,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    likes: 0,
                    comments: 0,
                    retweets: 0,
                    authorName: (await db.collection('users').doc(currentUser.uid).get()).data().name
                });

                document.getElementById('profileTweetInput').value = '';
                showToast(' Tweet posted!', 'success');
                loadProfileTweets();
            } catch (error) {
                console.error('Error posting tweet:', error);
                showToast('Error posting tweet', 'error');
            }
        }

        // Interaction functions
        async function likePost(postId) {
            if (!currentUser) return;
            try {
                const postRef = db.collection('posts').doc(postId);
                const userRef = db.collection('users').doc(currentUser.uid);

                const postData = (await postRef.get()).data();
                const userData = (await userRef.get()).data() || {};

                const likedPosts = userData.likedPosts || [];
                if (likedPosts.includes(postId)) {
                    likedPosts.splice(likedPosts.indexOf(postId), 1);
                    await postRef.update({ likes: Math.max(0, (postData.likes || 1) - 1) });
                } else {
                    likedPosts.push(postId);
                    await postRef.update({ likes: (postData.likes || 0) + 1 });
                }

                await userRef.update({ likedPosts: likedPosts });
                showToast(' Updated!', 'success');
                loadProfileFeed();
            } catch (error) {
                console.error('Error liking post:', error);
            }
        }

        async function sharePost(postId) {
            const shareText = `Check out this post on Pose!\n${window.location.href}#post/${postId}`;
            if (navigator.share) {
                navigator.share({ text: shareText });
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = shareText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast(' Copied to clipboard!', 'success');
            }
        }

        async function downloadPost(postId) {
            showToast(' Download started', 'info');
            // Implementation depends on video/media URL
        }

        function commentOnPost(postId) {
            const comment = prompt('Write your comment:');
            if (comment && currentUser) {
                db.collection('posts').doc(postId).update({
                    comments: firebase.firestore.FieldValue.increment(1)
                });
                showToast(' Comment added!', 'success');
            }
        }

        function likeTweet(postId) {
            likePost(postId);
        }

        function commentTweet(postId) {
            commentOnPost(postId);
        }

        function retweet(postId) {
            showToast(' Retweeted!', 'success');
        }

        function viewStory(storyId) {
            alert('Opening story: ' + storyId);
        }

        function attachMediaToTweet() {
            alert('Media attachment feature coming soon');
        }

        // Original Video Feed Scripts
        const allTabs = document.querySelectorAll('.tabs span');
        allTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                allTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

        function setupVideoControls() {
            const posts = document.querySelectorAll('.video-post');

            posts.forEach(post => {
                const video = post.querySelector('video');
                const playPauseOverlay = post.querySelector('.play-pause-overlay');
                const playIcon = post.querySelector('.play-icon');
                const pauseIcon = post.querySelector('.pause-icon');

                post.addEventListener('click', (e) => {
                    if (e.target.closest('.sidebar') || e.target.closest('.follow-btn') || e.target.closest('.close-btn')) {
                        return;
                    }

                    if (video.paused) {
                        video.play();
                        playIcon.style.display = 'none';
                        pauseIcon.style.display = 'block';
                    } else {
                        video.pause();
                        playIcon.style.display = 'block';
                        pauseIcon.style.display = 'none';
                    }

                    playPauseOverlay.classList.add('show');
                    setTimeout(() => {
                        playPauseOverlay.classList.remove('show');
                    }, 500);
                });

                video.addEventListener('play', () => {
                    playIcon.style.display = 'none';
                    pauseIcon.style.display = 'block';
                });

                video.addEventListener('pause', () => {
                    playIcon.style.display = 'block';
                    pauseIcon.style.display = 'none';
                });
            });
        }

        const posts = document.querySelectorAll('.video-post video');
        function handleVideoPlay() {
            posts.forEach(video => {
                const rect = video.getBoundingClientRect();
                if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
                    if (video.paused) {
                        video.play();
                    }
                } else {
                    if (!video.paused) {
                        video.pause();
                    }
                }
            });
        }

        document.querySelector('.video-feed').addEventListener('scroll', () => {
            clearTimeout(window.scrollTimeout);
            window.scrollTimeout = setTimeout(handleVideoPlay, 100);
        });
        handleVideoPlay();

        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const banner = btn.parentElement;
                const overlay = banner.closest('.overlay');
                const profileSection = overlay.querySelector('.profile-section');
                const adCaption = overlay.querySelector('.ad-caption');

                banner.classList.add('hidden');
                profileSection.classList.add('ad-closed');
                adCaption.classList.add('ad-closed');

                setTimeout(() => {
                    banner.style.display = 'none';
                }, 300);
            });
        });

        document.querySelectorAll('.follow-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (btn.textContent === 'FOLLOW') {
                    btn.textContent = 'FOLLOWING';
                    btn.style.background = 'rgba(255, 255, 255, 0.2)';
                    btn.style.border = '1px solid rgba(255, 255, 255, 0.5)';
                } else {
                    btn.textContent = 'FOLLOW';
                    btn.style.background = 'linear-gradient(45deg, #ff0050, #ff4081)';
                    btn.style.border = 'none';
                }
            });
        });

        setupVideoControls();

        document.querySelectorAll('.sidebar div').forEach(item => {
            item.addEventListener('click', (e) => {
                e.stopPropagation();
                item.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    item.style.transform = 'scale(1)';
                }, 150);
            });
        });


        // Global variable to store profile picture
        let uploadedProfilePic = null;

        // Toast notification function for better UX
        function showToast(message, type = 'info') {
            // Remove existing toast
            const existingToast = document.getElementById('toast-notification');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.id = 'toast-notification';

            let bgColor = '#333';
            let borderColor = '#666';

            if (type === 'success') {
                bgColor = '#10b981';
                borderColor = '#059669';
            } else if (type === 'error') {
                bgColor = '#ef4444';
                borderColor = '#dc2626';
            }

            toast.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: ${bgColor};
    color: white;
    padding: 15px 20px;
    border-radius: 8px;
    border-left: 4px solid ${borderColor};
    z-index: 9999;
    max-width: 300px;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    animation: slideInRight 0.3s ease;
  `;

            toast.textContent = message;
            document.body.appendChild(toast);

            // Add animation
            const style = document.createElement('style');
            if (!document.getElementById('toast-animation')) {
                style.id = 'toast-animation';
                style.textContent = `
      @keyframes slideInRight {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOutRight {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }
    `;
                document.head.appendChild(style);
            }

            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 4000);
        }

        // Update the profile icon when user logs in or profile picture changes
        function updateProfileIcon(profilePicUrl, userName) {
            const profileIcon = document.querySelector('.profile-icon');

            if (!profileIcon) return;

            if (profilePicUrl && profilePicUrl.trim()) {
                // If user has profile picture, show it
                const img = document.createElement('img');
                img.src = profilePicUrl;
                img.style.cssText = 'width: 100%; height: 100%; border-radius: 50%; object-fit: cover; display: block;';
                img.alt = 'profile';

                // Clear and add new image
                profileIcon.innerHTML = '';
                profileIcon.appendChild(img);

                console.log('Profile icon updated with image:', profilePicUrl);
            } else {
                // If no picture, show initial letter
                const initial = userName ? userName.charAt(0).toUpperCase() : 'U';
                profileIcon.innerHTML = `
      <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; color: white;">
        ${initial}
      </div>
    `;

                console.log('Profile icon updated with initial:', initial);
            }
        }

        // Handle profile picture file selection
        document.getElementById('profilePicInput').addEventListener('change', async function (e) {
            const file = e.target.files[0];
            if (!file) return;

            // Show preview
            const reader = new FileReader();
            reader.onload = function (event) {
                const previewPic = document.getElementById('previewPic');
                previewPic.style.backgroundImage = `url(${event.target.result})`;
                previewPic.style.backgroundSize = 'cover';
                previewPic.style.backgroundPosition = 'center';
                previewPic.textContent = '';
            };
            reader.readAsDataURL(file);
        });

        // Open Settings Modal
        function openSettings() {
            if (!currentUser) {
                showToast('Please login first', 'error');
                return;
            }

            // Load current user data into form
            db.collection('users').doc(currentUser.uid).get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    document.getElementById('editName').value = data.name || '';
                    document.getElementById('editUsername').value = data.username || '';
                    document.getElementById('editBio').value = data.bio || '';
                    document.getElementById('editLocation').value = data.location || '';

                    // Show profile picture if exists
                    const previewPic = document.getElementById('previewPic');
                    if (data.profilePicUrl && data.profilePicUrl.trim()) {
                        previewPic.style.backgroundImage = `url(${data.profilePicUrl})`;
                        previewPic.style.backgroundSize = 'cover';
                        previewPic.style.backgroundPosition = 'center';
                        previewPic.style.backgroundColor = 'transparent';
                        previewPic.textContent = '';
                    } else {
                        previewPic.style.backgroundImage = 'none';
                        previewPic.style.backgroundColor = '#333';
                        previewPic.textContent = (data.name || 'U').charAt(0).toUpperCase();
                    }
                } else {
                    showToast('Profile not found', 'error');
                }
            }).catch(error => {
                console.error('Error loading profile:', error);
                showToast('Error loading profile', 'error');
            });

            document.getElementById('settingsModal').classList.add('active');
        }

        // Close Settings Modal
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
            document.getElementById('settingsError').style.display = 'none';
        }

        // Save Profile Changes - Base64 Image Version
        async function saveProfile() {
            if (!currentUser) {
                showToast('Please login first', 'error');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Saving...';
            btn.disabled = true;

            try {
                const userData = {
                    name: document.getElementById('editName').value.trim(),
                    username: document.getElementById('editUsername').value.trim(),
                    bio: document.getElementById('editBio').value.trim(),
                    location: document.getElementById('editLocation').value.trim(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Handle profile picture if selected
                const picInput = document.getElementById('profilePicInput');
                if (picInput.files && picInput.files[0]) {
                    btn.textContent = 'Processing image...';
                    const file = picInput.files[0];

                    // Convert image to base64
                    const base64String = await new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve(reader.result);
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });

                    userData.profilePicUrl = base64String;

                    // Update profile picture in UI immediately
                    document.getElementById('profilePicLarge').style.backgroundImage = `url(${base64String})`;
                    document.getElementById('profilePicLarge').style.backgroundSize = 'cover';
                    document.getElementById('profilePicLarge').style.backgroundPosition = 'center';
                    document.getElementById('profilePicLarge').textContent = '';

                    // Update profile icon
                    updateProfileIcon(base64String, userData.name);
                }

                // Update display name and username in profile
                document.getElementById('profileDisplayName').textContent = userData.name;
                document.getElementById('profileUsernameDisplay').textContent = '@' + userData.username;

                // Update bio display
                const bioDiv = document.querySelector('.profile-bio');
                if (bioDiv) {
                    bioDiv.innerHTML = `${userData.bio}<br> ${userData.location}`;
                }

                btn.textContent = 'Saving...';

                // Save to Firestore (use set with merge to create if doesn't exist)
                await db.collection('users').doc(currentUser.uid).set(userData, { merge: true });

                showToast(' Profile updated successfully!', 'success');

                // Clear file input
                picInput.value = '';

                setTimeout(() => {
                    closeSettings();
                }, 1500);

            } catch (error) {
                console.error('Error saving profile:', error);
                showToast('Error: ' + error.message, 'error');
                showError('settingsError', 'Error saving profile: ' + error.message);
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // REPLACE your existing loadUserProfile function with this:
        async function loadUserProfile(uid) {
            try {
                const doc = await db.collection('users').doc(uid).get();
                if (doc.exists) {
                    const userData = doc.data();

                    // Update profile page
                    document.getElementById('profileDisplayName').textContent = userData.name;
                    document.getElementById('profileUsernameDisplay').textContent = '@' + userData.username;

                    // Update profile icon at top
                    updateProfileIcon(userData.profilePicUrl, userData.name);

                    // Load profile picture on profile page
                    const profilePicLarge = document.getElementById('profilePicLarge');
                    if (userData.profilePicUrl) {
                        profilePicLarge.style.backgroundImage = `url(${userData.profilePicUrl})`;
                        profilePicLarge.style.backgroundSize = 'cover';
                        profilePicLarge.style.backgroundPosition = 'center';
                        profilePicLarge.textContent = '';
                    } else {
                        profilePicLarge.style.backgroundImage = 'none';
                        profilePicLarge.textContent = userData.name.charAt(0).toUpperCase();
                    }

                    // Load bio and location
                    const bioDiv = document.querySelector('.profile-bio');
                    if (bioDiv) {
                        bioDiv.innerHTML = `${userData.bio || 'African Creator | Exclusive Content '}<br> ${userData.location || 'Lagos, Nigeria'}`;
                    }
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // REPLACE your existing auth.onAuthStateChanged with this:
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserProfile(user.uid);
            } else {
                currentUser = null;
                // Reset profile icon to default when logged out
                const profileIcon = document.querySelector('.profile-icon');
                profileIcon.innerHTML = `
      <svg width="22" height="22" viewBox="0 0 24 24" fill="white">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    `;
            }
        });
        // Tab Switching Function
        function switchMainTab(tabName) {
            // Remove active class from all tabs
            const allTabs = document.querySelectorAll('.tabs .tab');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                selectedTab.style.display = 'block';
            }

            // Pause all videos when switching tabs
            document.querySelectorAll('video').forEach(video => {
                video.pause();
            });

            // If switching to video feed, restart video playback logic
            if (tabName === 'busTab') {
                setTimeout(handleVideoPlay, 300);
            }
        }

        // Initialize Tab Click Listeners
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tabs .tab');
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function () {
                    if (index === 0) switchMainTab('busTab');      // Bus = Video Feed
                    if (index === 1) switchMainTab('friendTab');   // Friend = Tweet Feed
                    if (index === 2) switchMainTab('poseTab');     // Pose = Video Grid
                    if (index === 3) switchMainTab('busTab');      // fyp = Video Feed (for now)
                });
            });
        });

        // Updated Tab Switching Function with Scroll Reset
        function switchMainTab(tabName) {
            // Remove active class from all tabs
            const allTabs = document.querySelectorAll('.tabs .tab');
            allTabs.forEach(tab => tab.classList.remove('active'));

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                selectedTab.style.display = 'block';

                // Scroll to top of the new tab
                selectedTab.scrollTop = 0;
            }

            // Pause all videos when switching tabs
            document.querySelectorAll('video').forEach(video => {
                video.pause();
            });

            // If switching to video feed, restart video playback logic
            if (tabName === 'busTab') {
                setTimeout(handleVideoPlay, 300);
            }
        }

        // Add smooth scroll behavior to load more buttons
        document.addEventListener('DOMContentLoaded', function () {
            // Tab switching
            const tabs = document.querySelectorAll('.tabs .tab');
            tabs.forEach((tab, index) => {
                tab.addEventListener('click', function () {
                    if (index === 0) switchMainTab('busTab');      // Bus = Video Feed
                    if (index === 1) switchMainTab('friendTab');   // Friend = Tweet Feed
                    if (index === 2) switchMainTab('poseTab');     // Pose = Video Grid
                    if (index === 3) switchMainTab('busTab');      // fyp = Video Feed
                });
            });

            // Load more button scroll effect
            document.querySelectorAll('.load-more-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    // Add loading animation or fetch more content here
                    this.textContent = 'Loading... ';
                    setTimeout(() => {
                        this.textContent = this.closest('#poseTab') ? 'Load More Videos ' : 'Show More Posts ';
                    }, 1000);
                });
            });
        });


        // Check if user is new and show welcome popup
        function checkAndShowWelcomePopup() {
            // Check if user has visited before
            const hasVisited = localStorage.getItem('poseVisited');

            // Check if user is logged in
            if (!currentUser && !hasVisited) {
                document.getElementById('welcomePopup').classList.remove('hidden');
            }
        }

        // Close welcome popup
        function closeWelcomePopup() {
            document.getElementById('welcomePopup').classList.add('hidden');
            localStorage.setItem('poseVisited', 'true');
        }

        // Open signup from welcome popup
        function openSignupFromWelcome() {
            closeWelcomePopup();
            // Switch to signup form
            document.getElementById('signupForm').style.display = 'block';
            document.getElementById('loginForm').style.display = 'none';
            openAuthModal();
        }

        // Open login from welcome popup
        function openLoginFromWelcome() {
            closeWelcomePopup();
            // Switch to login form
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            openAuthModal();
        }

        // Update auth.onAuthStateChanged to check welcome popup
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserProfile(user.uid);
                // Close welcome popup if user logs in
                closeWelcomePopup();
            } else {
                currentUser = null;
                // Reset profile icon to default when logged out
                const profileIcon = document.querySelector('.profile-icon');
                profileIcon.innerHTML = `
      <svg width="22" height="22" viewBox="0 0 24 24" fill="white">
        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
      </svg>
    `;
            }
        });

        // Call this when page loads (add to your DOMContentLoaded)
        document.addEventListener('DOMContentLoaded', function () {
            // Existing code...

            // Show welcome popup after short delay
            setTimeout(checkAndShowWelcomePopup, 500);
        });


        // Open Upload Page
        function openUploadPage() {
            document.getElementById('uploadPage').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close Upload Page
        function closeUploadPage() {
            document.getElementById('uploadPage').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Switch Upload Tabs
        function switchUploadTab(tabName) {
            // Remove active from all tabs
            document.querySelectorAll('.upload-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Add active to clicked tab
            event.target.classList.add('active');

            // Hide all tab contents
            document.querySelectorAll('.tab-content-upload').forEach(content => {
                content.classList.remove('active');
            });

            // Show selected tab
            if (tabName === 'tweet') {
                document.getElementById('tweetTab').classList.add('active');
            } else if (tabName === 'post') {
                document.getElementById('postTab').classList.add('active');
            } else if (tabName === 'record') {
                document.getElementById('recordTab').classList.add('active');
                initializeRecordTab();
            }
        }

        // ====== RECORD TAB VARIABLES ====== 
        let recordingState = {
            isRecording: false,
            mediaRecorder: null,
            stream: null,
            clips: [],
            currentSpeed: 1,
            currentMode: 'normal',
            maxDuration: 15,
            aspectRatio: '9:16',
            recordingTime: 0,
            timerInterval: null,
            cameraFacingMode: 'user',
            audioContext: null,
            analyser: null,
            beautyLevel: 0,
            sharpenLevel: 0,
            currentFilter: 'none',
            filterAdjustments: { brightness: 0, contrast: 0, saturation: 0 },
            selectedEffects: [],
            textOverlays: [],
            audioTracks: [],
            mergedVideo: null
        };

        // ====== INITIALIZE RECORD TAB ======
        async function initializeRecordTab() {
            try {
                if (!recordingState.stream) {
                    const constraints = {
                        video: {
                            facingMode: recordingState.cameraFacingMode,
                            width: { ideal: 1280 },
                            height: { ideal: 2260 }
                        },
                        audio: true
                    };

                    recordingState.stream = await navigator.mediaDevices.getUserMedia(constraints);
                    const videoElement = document.getElementById('cameraPreview');
                    videoElement.srcObject = recordingState.stream;
                }
            } catch (error) {
                console.error('Camera error:', error);
                alert('Please allow camera and microphone access');
            }
        }

        // ====== RECORDING CONTROLS ======
        function startRecording() {
            if (!recordingState.stream) {
                alert('Camera not initialized. Please refresh.');
                return;
            }

            // If hands-free mode, show countdown
            if (recordingState.currentMode === 'handsfree') {
                showHandsfreeCountdown();
            } else {
                performRecording();
            }
        }

        function showHandsfreeCountdown() {
            let count = 3;
            const overlay = document.getElementById('countdownOverlay');
            const number = document.getElementById('countdownNumber');
            overlay.style.display = 'flex';

            const interval = setInterval(() => {
                count--;
                number.textContent = count;
                if (count <= 0) {
                    clearInterval(interval);
                    overlay.style.display = 'none';
                    performRecording();
                }
            }, 1000);
        }

        function performRecording() {
            recordingState.isRecording = true;
            recordingState.recordingTime = 0;

            const chunks = [];
            const options = { mimeType: 'video/webm;codecs=vp9' };

            try {
                recordingState.mediaRecorder = new MediaRecorder(recordingState.stream, options);
            } catch (e) {
                recordingState.mediaRecorder = new MediaRecorder(recordingState.stream);
            }

            recordingState.mediaRecorder.ondataavailable = (event) => {
                chunks.push(event.data);
            };

            recordingState.mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'video/webm' });
                const url = URL.createObjectURL(blob);

                recordingState.clips.push({
                    url: url,
                    blob: blob,
                    duration: recordingState.recordingTime,
                    speed: recordingState.currentSpeed
                });

                updateClipsPreview();
                showClipFeedback();
            };

            recordingState.mediaRecorder.start();

            // Update button states
            document.getElementById('recordStartBtn').style.display = 'none';
            document.getElementById('recordStopBtn').style.display = 'flex';
            document.getElementById('deleteLastClip').style.display = 'flex';
            document.getElementById('proceedToEdit').style.display = 'flex';

            // Start timer
            startTimer();
        }

        function stopRecording() {
            recordingState.isRecording = false;

            if (recordingState.mediaRecorder && recordingState.mediaRecorder.state !== 'inactive') {
                recordingState.mediaRecorder.stop();
            }

            // Update button states
            document.getElementById('recordStartBtn').style.display = 'flex';
            document.getElementById('recordStopBtn').style.display = 'none';

            // Stop timer
            if (recordingState.timerInterval) {
                clearInterval(recordingState.timerInterval);
            }
        }

        function startTimer() {
            const timerDisplay = document.getElementById('timerDisplay');
            const maxDuration = parseInt(document.getElementById('maxDuration').value);

            recordingState.timerInterval = setInterval(() => {
                recordingState.recordingTime++;

                const minutes = Math.floor(recordingState.recordingTime / 60);
                const seconds = recordingState.recordingTime % 60;
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // Auto-stop if max duration reached
                if (recordingState.recordingTime >= maxDuration) {
                    stopRecording();
                }
            }, 1000);
        }

        function updateClipsPreview() {
            const preview = document.getElementById('clipsPreview');
            preview.innerHTML = '';

            recordingState.clips.forEach((clip, index) => {
                const div = document.createElement('div');
                div.className = 'clip-thumbnail';

                const video = document.createElement('video');
                video.src = clip.url;
                video.style.width = '100%';
                video.style.height = '100%';

                div.appendChild(video);
                preview.appendChild(div);
            });
        }

        function deleteLastClip() {
            if (recordingState.clips.length > 0) {
                recordingState.clips.pop();
                updateClipsPreview();

                if (recordingState.clips.length === 0) {
                    document.getElementById('deleteLastClip').style.display = 'none';
                    document.getElementById('proceedToEdit').style.display = 'none';
                }
            }
        }

        function showClipFeedback() {
            console.log(`Clip ${recordingState.clips.length} recorded: ${recordingState.recordingTime}s`);
        }

        // ====== CAMERA CONTROLS ======
        function toggleGrid() {
            const grid = document.getElementById('gridOverlay');
            const btn = document.getElementById('gridToggle');

            if (grid.style.display === 'none') {
                grid.style.display = 'block';
                btn.style.background = '#6D28D9';
            } else {
                grid.style.display = 'none';
                btn.style.background = '#4C1D95';
            }
        }

        function toggleFlash() {
            const btn = document.getElementById('flashToggle');
            alert('Flash control coming soon - requires hardware access');
        }

        function flipCamera() {
            recordingState.cameraFacingMode = recordingState.cameraFacingMode === 'user' ? 'environment' : 'user';

            if (recordingState.stream) {
                recordingState.stream.getTracks().forEach(track => track.stop());
            }

            recordingState.stream = null;
            initializeRecordTab();
        }

        function openBeautyMode() {
            const panel = document.getElementById('beautyPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function closeBeautyMode() {
            document.getElementById('beautyPanel').style.display = 'none';
        }

        function applyBeautyEffect() {
            recordingState.beautyLevel = document.getElementById('beautySlider').value;
            recordingState.sharpenLevel = document.getElementById('sharpenSlider').value;

            document.getElementById('beautyValue').textContent = recordingState.beautyLevel;
            document.getElementById('sharpenValue').textContent = recordingState.sharpenLevel;
        }

        // ====== SPEED & MODE CONTROLS ======
        function setRecordingSpeed(speed) {
            recordingState.currentSpeed = speed;

            document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setRecordMode(mode) {
            recordingState.currentMode = mode;

            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setAspectRatio(ratio) {
            recordingState.aspectRatio = ratio;

            document.querySelectorAll('.aspect-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // ====== PROCEED TO EDITOR ======
        function proceedToEdit() {
            if (recordingState.clips.length === 0) {
                alert('Please record at least one clip');
                return;
            }

            // Hide recording interface, show editor
            document.getElementById('recordingInterface').classList.remove('active');
            document.getElementById('recordingInterface').style.display = 'none';
            document.getElementById('editorInterface').classList.add('active');
            document.getElementById('editorInterface').style.display = 'flex';

            // Load clips into editor
            loadClipsToEditor();
        }

        // ====== EDITOR INTERFACE ======
        function loadClipsToEditor() {
            // Merge all clips into single video for preview
            const timeline = document.getElementById('clipsTimeline');
            timeline.innerHTML = '';

            recordingState.clips.forEach((clip, index) => {
                const clipDiv = document.createElement('div');
                clipDiv.className = 'timeline-clip';
                clipDiv.style.backgroundImage = `url('${clip.url}')`;
                clipDiv.style.backgroundSize = 'cover';
                clipDiv.onclick = () => selectClip(index);
                timeline.appendChild(clipDiv);
            });
        }

        function selectClip(index) {
            document.querySelectorAll('.timeline-clip').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.timeline-clip')[index].classList.add('selected');
        }

        function switchEditorTab(tabName) {
            // Hide all editor tabs
            document.querySelectorAll('.editor-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.editor-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        function applyFilter(filterName) {
            recordingState.currentFilter = filterName;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function applyFilterAdjustment() {
            recordingState.filterAdjustments.brightness = document.getElementById('brightnessSlider').value;
            recordingState.filterAdjustments.contrast = document.getElementById('contrastSlider').value;
            recordingState.filterAdjustments.saturation = document.getElementById('saturationSlider').value;

            document.getElementById('brightnessValue').textContent = recordingState.filterAdjustments.brightness;
            document.getElementById('contrastValue').textContent = recordingState.filterAdjustments.contrast;
            document.getElementById('saturationValue').textContent = recordingState.filterAdjustments.saturation;
        }

        function applyTransition(transitionType) {
            recordingState.selectedEffects.push({ type: 'transition', name: transitionType });
            console.log('Transition applied:', transitionType);
        }

        function applyEffect(effectType) {
            recordingState.selectedEffects.push({ type: 'effect', name: effectType });
            console.log('Effect applied:', effectType);
        }

        function addText() {
            const text = document.getElementById('textInput').value;
            const color = document.getElementById('textColor').value;
            const animation = document.getElementById('textAnimation').value;

            if (!text) {
                alert('Please enter text');
                return;
            }

            recordingState.textOverlays.push({ text, color, animation });
            document.getElementById('textInput').value = '';
            console.log('Text added:', text);
        }

        function addSticker(emoji) {
            recordingState.textOverlays.push({ text: emoji, type: 'sticker' });
            console.log('Sticker added:', emoji);
        }

        function extractAudio() {
            alert('Extract audio feature coming soon');
        }

        function adjustVolume(type) {
            const value = type === 'original' ?
                document.getElementById('originalVolume').value :
                document.getElementById('bgMusicVolume').value;

            if (type === 'original') {
                document.getElementById('originalVolValue').textContent = value;
            } else {
                document.getElementById('bgMusicVolValue').textContent = value;
            }
        }

        function saveToDraft() {
            alert('Video saved to drafts');
        }

        function proceedToPreview() {
            // Move to pre-posting interface
            document.getElementById('editorInterface').style.display = 'none';
            document.getElementById('prePostingInterface').style.display = 'flex';

            // Load preview video
            if (recordingState.clips.length > 0) {
                const firstClip = recordingState.clips[0];
                document.getElementById('postingPreview').src = firstClip.url;
            }
        }

        function backToRecording() {
            document.getElementById('editorInterface').style.display = 'none';
            document.getElementById('recordingInterface').style.display = 'flex';
            document.getElementById('recordingInterface').classList.add('active');
        }

        function backToEditor() {
            document.getElementById('prePostingInterface').style.display = 'none';
            document.getElementById('editorInterface').style.display = 'flex';
        }

        function selectCoverTime() {
            const time = document.getElementById('coverTime').value;
            console.log('Cover selected at:', time + '%');
        }

        async function postRecord() {
            if (!currentUser) {
                alert(' Please login to post');
                return;
            }

            const caption = document.getElementById('recordCaption').value.trim();

            if (!caption) {
                alert(' Please add a caption');
                return;
            }

            try {
                // Show TikTok-style countdown
                showTiktokCountdown(5, async () => {
                    // Show success message 1 second after countdown
                    setTimeout(() => {
                        showUploadResultModal(true, ' Uploading...', 'Your video is being processed');
                    }, 1000);

                    // Merge and upload clips
                    await mergeAndUploadClips(caption);
                });
            } catch (error) {
                console.error('Error posting video:', error);
                hideTiktokCountdown();
                alert(' Failed to post video: ' + error.message);
            }
        }

        async function mergeAndUploadClips(caption) {
            try {
                // Get user data
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                if (!userData) {
                    alert('User profile not found');
                    return;
                }

                // Merge clips (simplified - in production use FFmpeg.js or backend)
                const mergedBlob = await mergeVideoClips(recordingState.clips);

                // Upload to Cloudinary
                const formData = new FormData();
                formData.append('file', mergedBlob);
                formData.append('upload_preset', 'pose_videos');

                const uploadResponse = await fetch('https://api.cloudinary.com/v1_1/drjptwqij/video/upload', {
                    method: 'POST',
                    body: formData
                });

                const videoData = await uploadResponse.json();
                const videoUrl = videoData.secure_url;

                // Save to Firestore
                const docRef = await db.collection('records').add({
                    userId: currentUser.uid,
                    userName: userData.name || '',
                    username: userData.username || '',
                    userProfilePic: userData.profilePicUrl || null,
                    caption: caption,
                    videoUrl: videoUrl,
                    allowComments: document.getElementById('recordAllowComments').checked,
                    allowSoundReuse: document.getElementById('recordAllowSoundReuse').checked,
                    allowSave: document.getElementById('recordAllowSave').checked,
                    allowAds: document.getElementById('recordAllowAds').checked,
                    status: 'posted',
                    views: 0,
                    likes: 0,
                    comments: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Update success modal
                document.getElementById('uploadResultTitle').textContent = ' Video Posted!';
                document.getElementById('uploadResultMessage').textContent = 'Your recording was posted successfully!';

                // Reset form after 5 seconds
                setTimeout(() => {
                    closeUploadResultModal();
                    resetRecordTab();
                    closeUploadPage();
                }, 5000);

            } catch (error) {
                console.error('Upload error:', error);
                showUploadResultModal(false, ' Upload Failed', error.message);
            }
        }

        async function mergeVideoClips(clips) {
            // Simplified merge - combines clips sequentially
            // In production, use FFmpeg.js or backend service
            if (clips.length === 1) {
                return clips[0].blob;
            }

            // For now, return first clip
            return clips[0].blob;
        }

        function resetRecordTab() {
            recordingState.clips = [];
            recordingState.recordingTime = 0;
            recordingState.selectedEffects = [];
            recordingState.textOverlays = [];

            document.getElementById('clipsPreview').innerHTML = '';
            document.getElementById('recordCaption').value = '';
            document.getElementById('timerDisplay').textContent = '00:00';

            document.getElementById('recordingInterface').style.display = 'flex';
            document.getElementById('editorInterface').style.display = 'none';
            document.getElementById('prePostingInterface').style.display = 'none';
        }

        // Preview Media Function
        function previewMedia(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);

            input.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (file.type.startsWith('image/')) {
                            preview.innerHTML = `<img src="${e.target.result}" alt="preview">`;
                        } else if (file.type.startsWith('video/')) {
                            preview.innerHTML = `<video src="${e.target.result}" controls></video>`;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Initialize media previews
        document.addEventListener('DOMContentLoaded', function () {
            previewMedia('tweetMedia', 'tweetMediaPreview');
            previewMedia('postVideo', 'postVideoPreview');
            previewMedia('postThumbnail', 'postThumbnailPreview');
            previewMedia('exclusiveVideo', 'exclusiveVideoPreview');
        });

        // Open Tweet Preview
        function openTweetPreview() {
            const text = document.getElementById('tweetText').value.trim();

            if (!text) {
                alert('Please enter some text for your tweet');
                return;
            }

            // Copy media preview to popup
            const mediaPreview = document.getElementById('tweetMediaPreview').innerHTML;
            document.getElementById('tweetPreviewMedia').innerHTML = mediaPreview;

            document.getElementById('tweetPreviewPopup').classList.add('active');
        }

        // Close Tweet Preview
        function closeTweetPreview() {
            document.getElementById('tweetPreviewPopup').classList.remove('active');
        }

        // Open Exclusive Preview
        function openExclusivePreview() {
            const videoInput = document.getElementById('exclusiveVideo');

            if (!videoInput.files || videoInput.files.length === 0) {
                alert('Please upload or record a video');
                return;
            }

            // Copy video preview to popup
            const videoPreview = document.getElementById('exclusiveVideoPreview').innerHTML;
            document.getElementById('exclusivePreviewVideo').innerHTML = videoPreview;

            document.getElementById('exclusivePreviewPopup').classList.add('active');
        }

        // Close Exclusive Preview
        function closeExclusivePreview() {
            document.getElementById('exclusivePreviewPopup').classList.remove('active');
        }

        // Post Tweet to Firebase - with Cloudinary
        window.postTweet = async function postTweet() {
            console.log(' postTweet called');
            if (!currentUser) {
                alert(' Please login to post');
                console.error('Not logged in');
                return;
            }

            const text = document.getElementById('tweetText').value.trim();
            console.log('Tweet text:', text);

            if (!text) {
                alert(' Please enter some text for your tweet');
                return;
            }

            try {
                console.log('Getting user profile...');
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                if (!userData) {
                    alert('User profile not found. Please complete your profile first.');
                    return;
                }

                // Use Cloudinary media URL (if any media was selected)
                let mediaUrl = tweetMediaUrl; // This will be null if no media was uploaded

                // Save to Firestore
                const docRef = await db.collection('tweets').add({
                    userId: currentUser.uid,
                    userName: userData.name || '',
                    username: userData.username || '',
                    userProfilePic: userData.profilePicUrl || null,
                    text: text,
                    caption: document.getElementById('tweetCaption').value.trim(),
                    hashtags: document.getElementById('tweetHashtags').value.trim(),
                    mediaUrl: mediaUrl,
                    allowAds: document.getElementById('tweetAllowAds').checked,
                    allowComments: document.getElementById('tweetAllowComments').checked,
                    allowSave: document.getElementById('tweetAllowSave').checked,
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                console.log('Tweet saved with ID:', docRef.id);
                alert(' Tweet posted successfully!');
                closeTweetPreview();
                closeUploadPage();

                // Clear form
                document.getElementById('tweetText').value = '';
                document.getElementById('tweetCaption').value = '';
                document.getElementById('tweetHashtags').value = '';
                document.getElementById('tweetMedia').value = '';
                document.getElementById('tweetMediaPreview').innerHTML = '';
                document.getElementById('tweetPreviewMedia').innerHTML = '';
                document.getElementById('tweetUploadStatus').innerHTML = '';

                // Reset media variables
                tweetMediaUrl = null;
                tweetMediaFileName = null;

            } catch (error) {
                console.error('Error posting tweet:', error);
                alert(' Failed to post tweet: ' + error.message);
            }
        }

        // Post Exclusive to Firebase - Optimized for Spark Mode
        window.postExclusive = async function postExclusive() {
            console.log(' postExclusive called');
            if (!currentUser) {
                alert(' Please login to post');
                console.error('Not logged in');
                return;
            }

            // Check if video URL exists (auto-uploaded)
            if (!exclusiveVideoUrl) {
                alert(' Please wait for video upload to complete');
                console.warn('Video not uploaded yet');
                return;
            }

            try {
                console.log(' Getting user profile...');
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                if (!userData) {
                    alert('User profile not found. Please complete your profile first.');
                    return;
                }

                // Use pre-uploaded video URL
                const videoUrl = exclusiveVideoUrl;

                // Save to Firestore - minimal fields for Spark mode
                const docRef = await db.collection('exclusive').add({
                    userId: currentUser.uid,
                    userName: userData.name || '',
                    username: userData.username || '',
                    userProfilePic: userData.profilePicUrl || null,
                    caption: document.getElementById('exclusiveCaption').value.trim(),
                    hashtags: document.getElementById('exclusiveHashtags').value.trim(),
                    videoUrl: videoUrl,
                    videoFileName: exclusiveVideoFileName,
                    allowAds: document.getElementById('exclusiveAllowAds').checked,
                    allowComments: document.getElementById('exclusiveAllowComments').checked,
                    allowSave: document.getElementById('exclusiveAllowSave').checked,
                    views: 0,
                    likes: 0,
                    comments: 0,
                    earnings: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                console.log('Exclusive saved with ID:', docRef.id);

                alert(' Exclusive video posted successfully!');
                closeExclusivePreview();
                closeUploadPage();

                // Clear form
                document.getElementById('exclusiveVideo').value = '';
                document.getElementById('exclusiveVideoPreview').innerHTML = '';
                document.getElementById('exclusiveUploadStatus').innerHTML = '';

                // Reset video variables
                exclusiveVideoUrl = null;
                exclusiveVideoFileName = null;

            } catch (error) {
                console.error('Error posting exclusive:', error);
                alert(' Failed to post exclusive: ' + error.message);
            }
        };

        // Debug logging function
        function addDebugLog(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        function toggleDebug() {
            const panel = document.getElementById('debugPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // Upload Post - Optimized with Cloudinary
        window.uploadPost = async function uploadPost() {
            clearDebugLog();
            addDebugLog(' uploadPost started');

            if (!currentUser) {
                addDebugLog(' User not logged in');
                alert(' Please login first');
                return;
            }

            // Show TikTok-style countdown (5 seconds)
            showTiktokCountdown(5, async () => {
                // This callback runs after countdown completes
                // Show success message 1 second after countdown
                setTimeout(() => {
                    showUploadResultModal(true, ' Uploading...', 'Your post is being processed');
                }, 1000);

                await performUpload();
            });

            async function performUpload() {
                try {
                    const titleInput = document.getElementById('postTitle');
                    const descInput = document.getElementById('postDescription');
                    const tagsInput = document.getElementById('postTags');
                    const priceInput = document.getElementById('postPrice');
                    const priceTypeInput = document.getElementById('postPriceType');
                    const thumbInput = document.getElementById('postThumbnail');

                    addDebugLog(' Form elements found');

                    // Check if video URL exists (from Cloudinary)
                    if (!postVideoUrl) {
                        addDebugLog(' Video not uploaded yet');
                        alert(' Please wait for video upload to complete');
                        return;
                    }

                    const title = titleInput.value.trim();
                    if (!title) {
                        addDebugLog(' Title is empty');
                        alert(' Please enter a title for your post');
                        return;
                    }

                    addDebugLog(` Using Cloudinary video URL`);

                    // Get user data
                    addDebugLog(' Reading user data...');
                    const userDoc = await db.collection('users').doc(currentUser.uid).get();
                    const userData = userDoc.data();

                    if (!userData) {
                        addDebugLog(' User profile not found');
                        alert('User profile not found. Please complete your profile first.');
                        return;
                    }
                    addDebugLog(' User data loaded');

                    // Upload thumbnail to Cloudinary if provided
                    let thumbnailUrl = null;
                    if (thumbInput.files && thumbInput.files[0]) {
                        addDebugLog(' Uploading thumbnail to Cloudinary...');
                        try {
                            const thumbResult = await uploadToCloudinaryWithProgress(thumbInput.files[0], 'post_thumbnail');
                            thumbnailUrl = thumbResult.url;
                            addDebugLog(' Thumbnail uploaded: ' + thumbnailUrl);
                        } catch (thumbError) {
                            addDebugLog(` Thumbnail upload failed: ${thumbError.message}`);
                        }
                    }

                    // Prepare post data with Cloudinary URLs
                    const postData = {
                        userId: currentUser.uid,
                        userName: userData.name || '',
                        username: userData.username || '',
                        userProfilePic: userData.profilePicUrl || null,
                        title: title,
                        description: descInput.value.trim(),
                        tags: tagsInput.value.trim(),
                        videoUrl: postVideoUrl,
                        thumbnailUrl: thumbnailUrl,
                        price: parseFloat(priceInput.value) || 0,
                        priceType: priceTypeInput.value || 'free',
                        views: 0,
                        likes: 0,
                        comments: 0,
                        earnings: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    // Save to Firestore
                    addDebugLog(' Saving to Firestore...');

                    try {
                        const docRef = await db.collection('posts').add(postData);
                        const postId = docRef.id;
                        addDebugLog(` Post saved! ID: ${postId}`);
                    } catch (firestoreError) {
                        addDebugLog(` Firestore error: ${firestoreError.message}`);
                        showUploadResultModal(false, ' Upload Failed', 'Failed to save post: ' + firestoreError.message);
                        return;
                    }

                    // Update success modal with final message
                    const modal = document.getElementById('uploadResultModal');
                    document.getElementById('uploadResultTitle').textContent = ' Video Posted!';
                    document.getElementById('uploadResultMessage').textContent = `"${title}" has been posted successfully!`;
                    if (thumbnailUrl) {
                        document.getElementById('uploadResultThumbnail').innerHTML = `<img src="${thumbnailUrl}" alt="thumbnail">`;
                    }
                    addDebugLog(' Upload complete!');

                    // Clear form after 5-second countdown
                    setTimeout(() => {
                        document.getElementById('postVideo').value = '';
                        titleInput.value = '';
                        descInput.value = '';
                        tagsInput.value = '';
                        priceInput.value = '0';
                        priceTypeInput.value = 'free';
                        thumbInput.value = '';
                        document.getElementById('postVideoPreview').innerHTML = '';
                        document.getElementById('postThumbnailPreview').innerHTML = '';
                        document.getElementById('postUploadStatus').innerHTML = '';

                        // Reset price buttons
                        setPostPrice(0, 'free');

                        // Reset variables
                        postVideoUrl = null;
                        postVideoFileName = null;

                        closeUploadPage();
                        closeUploadResultModal();
                    }, 5000);

                } catch (error) {
                    addDebugLog(` Error: ${error.message}`);
                    hideTiktokCountdown();
                    showUploadResultModal(false, ' Error', error.message);
                }
            } // End performUpload function
        };





        // ============================================================================
        // RECORDING UI FUNCTIONALITY
        // ============================================================================

        // State Management
        const recordingUIState = {
            isRecording: false,
            recordedBlob: null,
            recordingStartTime: 0,
            timerInterval: null,
            selectedMode: 'video',
            activeEffects: [],
            mediaStream: null,
            mediaRecorder: null,
            textBgGradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            textAlign: 'center',
            isBold: false,
            textColor: '#fff'
        };

        // ============================================================================
        // SCREEN NAVIGATION
        // ============================================================================

        function showScreen(screenId) {
            // Get current active screen before hiding
            const currentScreen = document.querySelector('.recording-screen.active');
            const currentScreenId = currentScreen?.id;

            // Stop camera when leaving screen 5
            if (currentScreenId === 'screen5' && screenId !== 'screen5') {
                console.log('Leaving screen 5 - stopping camera');
                stopPhotoMode();
            }

            // Hide all screens
            document.querySelectorAll('.recording-screen').forEach(screen => {
                screen.classList.remove('active');
            });

            // Show target screen
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');

                // Initialize photo mode when showing screen 5 (only if not already initialized)
                if (screenId === 'screen5') {
                    // Check if camera is already active/streaming
                    if (!photoState.photoStream || !photoState.photoStream.active) {
                        console.log('Entering screen 5 - camera not ready, initializing...');
                        initializePhotoMode();
                    } else {
                        console.log('Entering screen 5 - camera already active');
                        ensureVideoElement();
                    }
                }
            }
        }

        function closeRecordingUI() {
            const overlay = document.getElementById('recordingUIOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        function backToScreen1() {
            // Stop camera if navigating away from photo mode
            stopPhotoMode();
            showScreen('screen1');
        }

        function backToScreen2() {
            // Stop camera if navigating away from photo mode
            stopPhotoMode();
            showScreen('screen2');
        }

        function backToScreen3() {
            showScreen('screen3');
        }

        function backToScreen5() {
            showScreen('screen5');
        }

        function backToScreen6() {
            showScreen('screen6');
        }

        function backToScreen8() {
            showScreen('screen8');
        }

        // ============================================================================
        // MENU TOGGLES
        // ============================================================================

        function toggleRecLeftMenu() {
            // Determine which menu to toggle based on active screen
            const activeScreen = document.querySelector('.recording-screen.active');
            let menuId = 'recLeftMenu'; // Default for other screens

            if (activeScreen?.id === 'screen5') {
                menuId = 'recPhotoLeftMenu'; // Photo mode menu
            } else if (activeScreen?.id === 'screen6') {
                menuId = 'recPhotoEditMenu'; // Photo edit menu
            }

            const menu = document.getElementById(menuId);
            if (menu) {
                // Toggle the 'show' class for smooth animation
                if (menu.classList.contains('show')) {
                    menu.classList.remove('show');
                    console.log('Menu closed:', menuId);
                } else {
                    menu.classList.add('show');
                    console.log('Menu opened:', menuId);
                }
            } else {
                console.warn('Menu not found:', menuId);
            }
        }

        function toggleRecEditMenu() {
            const menu = document.getElementById('recEditMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'none' ? 'flex' : 'none';
            }
        }

        function toggleRecPhotoEditMenu() {
            const menu = document.getElementById('recPhotoEditMenu');
            if (menu) {
                menu.style.display = menu.style.display === 'none' ? 'flex' : 'none';
            }
        }

        // ============================================================================
        // TOAST NOTIFICATIONS
        // ============================================================================

        function showToastRecording(message, type = 'success', icon = '') {
            const toast = document.getElementById('recordingToast');
            const toastIcon = document.getElementById('recordingToastIcon');
            const toastMessage = document.getElementById('recordingToastMessage');

            if (toast && toastMessage && toastIcon) {
                toastIcon.textContent = icon;
                toastMessage.textContent = message;
                toast.className = `recording-toast ${type}`;
                toast.style.display = 'flex';

                setTimeout(() => {
                    toast.style.display = 'none';
                }, 3000);
            }
        }

        // ============================================================================
        // VIDEO RECORDING FUNCTIONALITY
        // ============================================================================

        function startRecording() {
            // Request camera access
            navigator.mediaDevices.getUserMedia({ video: true, audio: true })
                .then(stream => {
                    recordingState.mediaStream = stream;
                    recordingState.mediaRecorder = new MediaRecorder(stream);
                    const chunks = [];

                    recordingState.mediaRecorder.ondataavailable = (e) => {
                        chunks.push(e.data);
                    };

                    recordingState.mediaRecorder.onstop = () => {
                        recordingState.recordedBlob = new Blob(chunks, { type: 'video/webm' });
                    };

                    recordingState.mediaRecorder.start();
                    recordingState.isRecording = true;
                    recordingState.recordingStartTime = Date.now();

                    showScreen('screen2');
                    startRecordingTimer();
                    showToastRecording('Recording started', 'success', '');
                })
                .catch(err => {
                    showToastRecording('Camera access denied', 'error', '');
                    console.error('Error accessing camera:', err);
                });
        }

        function stopRecording() {
            if (recordingState.mediaRecorder) {
                recordingState.mediaRecorder.stop();
                recordingState.isRecording = false;
                clearInterval(recordingState.timerInterval);

                // Stop all tracks
                if (recordingState.mediaStream) {
                    recordingState.mediaStream.getTracks().forEach(track => track.stop());
                }

                showToastRecording('Recording stopped', 'info', '');
            }
        }

        function cancelRecording() {
            stopRecording();
            recordingState.recordedBlob = null;
            showScreen('screen1');
            showToastRecording('Recording cancelled', 'error', '');
        }

        function acceptRecording() {
            showScreen('screen3');
            showToastRecording('Ready to edit', 'success', '');
        }

        function startRecordingTimer() {
            let seconds = 0;
            recordingState.timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                const timerEl = document.getElementById('recTimer');
                if (timerEl) {
                    timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        // ============================================================================
        // MODE SWITCHING
        // ============================================================================

        function switchRecMode(mode) {
            recordingState.selectedMode = mode;

            // Update active tab
            document.querySelectorAll('.rec-mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            if (mode === 'photo') {
                // Show filters panel and initialize camera
                const filtersPanel = document.querySelector('.photo-filters-panel');
                if (filtersPanel) {
                    filtersPanel.classList.add('show');
                }

                // Pre-initialize camera BEFORE showing screen for instant availability
                console.log('Initializing camera before showing Screen 5...');
                initializePhotoMode().then(() => {
                    console.log('Camera ready - showing Screen 5');
                    showScreen('screen5');
                    showToastRecording('Photo mode', 'info', '');
                }).catch(err => {
                    console.error('Camera init error:', err);
                    showScreen('screen5');
                    showToastRecording('Photo mode - camera may not be ready', 'warning', '');
                });
            } else if (mode === 'text') {
                // Hide filters panel
                const filtersPanel = document.querySelector('.photo-filters-panel');
                if (filtersPanel) {
                    filtersPanel.classList.remove('show');
                }
                showScreen('screen8');
                showToastRecording('Text mode', 'info', '');
            } else if (mode === 'video') {
                // Hide filters panel
                const filtersPanel = document.querySelector('.photo-filters-panel');
                if (filtersPanel) {
                    filtersPanel.classList.remove('show');
                }
                showScreen('screen1');
                showToastRecording('Video mode', 'info', '');
            }
        }

        // ============================================================================
        // EFFECTS
        // ============================================================================

        // ============================================================================
        // PHOTO MODE - SCREEN 5, 6, 7
        // ============================================================================

        let photoState = {
            photoStream: null,
            capturedPhotos: [],
            currentPhotoIndex: 0,
            cameraFacingMode: 'environment',  // 'environment' for back camera, 'user' for front camera
            photoSettings: {
                flash: false,
                timer: 0,
                filter: 'none',
                grid: false,
                ratio: '9:16',
                effects: []
            },
            canvas: null,
            ctx: null
        };

        // Initialize photo camera - request permissions once
        async function initializePhotoMode() {
            try {
                // Check if camera is already initialized
                if (photoState.photoStream && photoState.photoStream.active) {
                    console.log(' Camera already active');
                    ensureVideoElement();
                    return;
                }

                console.log(' Requesting camera access...');

                // Simple, no constraints - just ask for video and audio
                photoState.photoStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });

                console.log(' Camera access granted');

                // Log actual camera capabilities for debugging
                const videoTrack = photoState.photoStream.getVideoTracks()[0];
                if (videoTrack) {
                    const settings = videoTrack.getSettings();
                    console.log(' Camera specs:', {
                        resolution: `${settings.width}x${settings.height}`,
                        frameRate: settings.frameRate + 'fps',
                        facingMode: settings.facingMode
                    });
                }

                // Ensure video element exists and is properly set up
                ensureVideoElement();

                // Verify camera quality settings
                verifyPhotoQualitySettings();

                showToastRecording(' Camera Ready', 'success', '');
            } catch (error) {
                console.error(' Camera error:', error.name, error.message);

                if (error.name === 'NotAllowedError') {
                    alert(' Camera permission denied.\n\nFix:\n1. Click lock  in address bar\n2. Reset permissions\n3. Reload & allow camera');
                } else if (error.name === 'NotFoundError') {
                    alert(' No camera found.\n\nOn laptop: Connect USB webcam\nOn phone: Check camera permissions in system settings');
                } else if (error.name === 'NotReadableError') {
                    alert(' Camera in use.\n\nClose: Zoom, Teams, other video apps, or other browser tabs');
                } else {
                    alert(' Camera error: ' + error.message);
                }

                if (photoState.photoStream) {
                    photoState.photoStream.getTracks().forEach(track => track.stop());
                    photoState.photoStream = null;
                }
            }
        }

        // Helper: Ensure video element is created and streaming
        function ensureVideoElement() {
            console.log(' ensureVideoElement called');

            if (!photoState.photoStream || !photoState.photoStream.active) {
                console.error(' Stream not active');
                return false;
            }

            console.log(' Stream is active');

            const container = document.querySelector('#screen5 .camera-preview');
            if (!container) {
                console.error(' Screen 5 container not found');
                return false;
            }

            console.log(' Container found');

            // Check if video element already exists
            let video = document.getElementById('photoPreviewVideo');

            if (!video) {
                console.log('Creating new video element...');
                // Create new video element with PROFESSIONAL QUALITY settings
                video = document.createElement('video');
                video.id = 'photoPreviewVideo';
                video.autoplay = true;
                video.muted = true;  // IMPORTANT: Mute to allow autoplay in most browsers
                video.playsinline = true;

                // Professional quality CSS
                video.style.cssText = `
                    width: 100vw;
                    height: 100vh;
                    object-fit: cover;
                    background-color: #000;
                    display: block;
                    
                    /* Prevent quality loss from browser scaling */
                    image-rendering: -webkit-optimize-contrast;
                    image-rendering: crisp-edges;
                    
                    /* Hardware acceleration for smooth rendering */
                    transform: translate3d(0, 0, 0);
                    backface-visibility: hidden;
                    will-change: transform;
                    
                    /* Prevent flickering */
                    perspective: 1000px;
                `;

                // Clear any text content from container before adding video
                container.innerHTML = '';
                container.style.background = '#000';  // Black background
                container.appendChild(video);

                console.log(' Professional video element created');
            }

            // Assign stream to video
            console.log(' Video element srcObject before:', video.srcObject ? 'has stream' : 'no stream');
            if (video.srcObject !== photoState.photoStream) {
                video.srcObject = photoState.photoStream;
                console.log(' Stream assigned to video element');
            } else {
                console.log('Stream already assigned');
            }

            console.log(' Video element display:', window.getComputedStyle(video).display);
            console.log(' Video element dimensions:', video.offsetWidth, 'x', video.offsetHeight);

            // Ensure it's playing
            console.log(' Attempting to play video...');
            video.play().then(() => {
                console.log(' Video playing');
            }).catch(err => {
                console.error(' Video play error:', err.message);
            });

            return true;
        }

        // ============================================================================
        // VERIFY PHOTO QUALITY SETTINGS - Check console for debug info
        // ============================================================================
        function verifyPhotoQualitySettings() {
            const video = document.getElementById('photoPreviewVideo');
            if (!video) return;

            console.group(' PHOTO QUALITY VERIFICATION');
            console.log(' Camera Resolution:', `${video.videoWidth}x${video.videoHeight}`);
            console.log(' Canvas Smoothing:', 'DISABLED (crisp capture)');
            console.log(' JPEG Quality:', '100% (1.0 - maximum quality)');
            console.log(' Capture Method:', 'toBlob (optimized)');
            console.log(' Filter Mode:', photoState.photoSettings.filter || 'none');
            console.log(' Aspect Ratio:', photoState.photoSettings.ratio);
            console.log(' Camera Mode:', photoState.cameraFacingMode === 'environment' ? ' Back (Higher Quality)' : ' Front');
            console.log(' Expected Photo Size:', video.videoWidth * video.videoHeight > 2073600 ? '4K or High Resolution' : 'HD Resolution');
            console.groupEnd();
        }

        // Close photo left menu after action
        function closePhotoLeftMenu() {
            const menu = document.getElementById('recPhotoLeftMenu');
            if (menu && menu.classList.contains('show')) {
                menu.classList.remove('show');
                console.log('Photo menu closed');
            }
        }

        // Toggle photo mode menus
        function togglePhotoFlash() {
            // Cycle through flash modes: off  on  auto
            const flashModes = [false, 'on', 'auto'];
            const current = photoState.photoSettings.flash;
            const currentIdx = flashModes.indexOf(current);
            photoState.photoSettings.flash = flashModes[(currentIdx + 1) % flashModes.length];

            const menu = document.getElementById('recPhotoLeftMenu');
            const flashItem = menu.querySelector('.rec-menu-item:nth-child(1)');

            let flashText = ' Flash';
            let message = 'Flash off';

            if (photoState.photoSettings.flash === 'on') {
                flashItem.style.color = '#FFD700';
                flashText = ' Flash (ON)';
                message = ' Flash ON - brightens captured photo';
            } else if (photoState.photoSettings.flash === 'auto') {
                flashItem.style.color = '#FFA500';
                flashText = ' Flash (AUTO)';
                message = ' Flash AUTO - applies if needed';
            } else {
                flashItem.style.color = 'white';
                flashText = ' Flash';
                message = 'Flash OFF';
            }

            flashItem.textContent = flashText;
            showToastRecording(message, 'info', '');
            closePhotoLeftMenu();
        }

        // ============================================================================
        // SWITCH PHOTO CAMERA - Toggle between front and back camera
        // ============================================================================
        async function switchPhotoCamera() {
            try {
                // Toggle camera facing mode
                photoState.cameraFacingMode = photoState.cameraFacingMode === 'environment' ? 'user' : 'environment';

                // Stop current stream
                if (photoState.photoStream) {
                    photoState.photoStream.getTracks().forEach(track => track.stop());
                    photoState.photoStream = null;
                }

                // Reinitialize with new camera
                showToastRecording(' Switching camera...', 'info', '');
                await initializePhotoMode();

                const cameraType = photoState.cameraFacingMode === 'environment' ? ' Back Camera' : ' Front Camera';
                showToastRecording(`${cameraType} activated`, 'success', '');
            } catch (error) {
                console.error('Camera switch error:', error);
                showToastRecording(' Failed to switch camera', 'error', '');
            }
        }

        // ============================================================================
        // UPDATE RATIO GUIDE - Shows real-time frame preview
        // ============================================================================
        function updateRatioGuide() {
            const video = document.getElementById('photoPreviewVideo');
            const guide = document.getElementById('ratioGuide');

            if (!video || !video.videoWidth) {
                console.log('Video not ready yet');
                return;
            }

            // Aspect ratio mappings
            const ratios = {
                '1:1': 1,
                '3:4': 0.75,
                '9:16': 0.5625,
                '16:9': 1.777
            };

            const targetRatio = ratios[photoState.photoSettings.ratio] || 1.777;
            const videoRatio = video.videoWidth / video.videoHeight;

            let frameWidth = 100;  // percentage
            let frameHeight = 100; // percentage

            // Calculate which dimension to constrain
            if (videoRatio > targetRatio) {
                // Video is wider than target ratio - constrain width
                frameWidth = (targetRatio * 100) / videoRatio;
                frameHeight = 100;
            } else {
                // Video is taller than target ratio - constrain height
                frameWidth = 100;
                frameHeight = (100 * videoRatio) / targetRatio;
            }

            // Apply to guide element
            guide.style.width = frameWidth + '%';
            guide.style.height = frameHeight + '%';
            guide.style.display = 'block';

            // Log for debugging
            console.log(` Ratio Guide Updated:`, {
                ratio: photoState.photoSettings.ratio,
                frameSize: `${frameWidth.toFixed(1)}%  ${frameHeight.toFixed(1)}%`,
                videoRes: `${video.videoWidth}${video.videoHeight}`,
                videoRatio: videoRatio.toFixed(3),
                targetRatio: targetRatio.toFixed(3)
            });
        }

        function togglePhotoTimer() {
            const currentTimer = photoState.photoSettings.timer;
            const timers = [0, 3, 5, 10];
            const nextIndex = (timers.indexOf(currentTimer) + 1) % timers.length;
            photoState.photoSettings.timer = timers[nextIndex];

            const menu = document.getElementById('recPhotoLeftMenu');
            const timerItem = menu.querySelector('.rec-menu-item:nth-child(2)');
            if (photoState.photoSettings.timer === 0) {
                timerItem.textContent = ' Timer';
            } else {
                timerItem.textContent = ` ${photoState.photoSettings.timer}s`;
            }

            showToastRecording(`Timer: ${photoState.photoSettings.timer}s`, 'info', '');
            closePhotoLeftMenu();
        }

        function togglePhotoFilters() {
            const filtersPanel = document.querySelector('.photo-filters-panel');
            if (filtersPanel) {
                filtersPanel.classList.toggle('show');
                if (filtersPanel.classList.contains('show')) {
                    showToastRecording(' Filters Opened', 'info', '');
                } else {
                    showToastRecording(' Filters Closed', 'info', '');
                }
            }
            closePhotoLeftMenu();
        }

        function togglePhotoGrid() {
            photoState.photoSettings.grid = !photoState.photoSettings.grid;
            const menu = document.getElementById('recPhotoLeftMenu');
            const gridItem = menu.querySelector('.rec-menu-item:nth-child(4)');

            if (photoState.photoSettings.grid) {
                gridItem.style.color = '#FFD700';
                showGridOverlay('grid-overlay-photo');
            } else {
                gridItem.style.color = 'white';
                hideGridOverlay();
            }

            showToastRecording(photoState.photoSettings.grid ? 'Grid on' : 'Grid off', 'info', '');
            closePhotoLeftMenu();
        }

        function togglePhotoRatio() {
            const ratios = ['1:1', '3:4', '9:16', '16:9'];
            const currentIdx = ratios.indexOf(photoState.photoSettings.ratio);
            photoState.photoSettings.ratio = ratios[(currentIdx + 1) % ratios.length];

            const menu = document.getElementById('recPhotoLeftMenu');
            const ratioItem = menu.querySelector('.rec-menu-item:nth-child(5)');
            ratioItem.textContent = ` ${photoState.photoSettings.ratio}`;

            // Update live ratio guide frame in preview
            updateRatioGuide();

            showToastRecording(` ${photoState.photoSettings.ratio} -  100% Quality JPEG`, 'info', '');
            closePhotoLeftMenu();
        }

        // Toggle effects
        function toggleEffect(effect) {
            const idx = photoState.photoSettings.effects.indexOf(effect);
            if (idx > -1) {
                photoState.photoSettings.effects.splice(idx, 1);
            } else {
                photoState.photoSettings.effects.push(effect);
            }

            const effectIcons = {
                'sparkle': '',
                'mask': '',
                'ghost': '',
                'star': ''
            };

            showToastRecording(`${effectIcons[effect]} effect ${idx > -1 ? 'removed' : 'added'}`, 'info', effectIcons[effect]);
        }

        function applyPhotoFilter(filterName) {
            const video = document.getElementById('photoPreviewVideo');
            if (!video) return;

            // Update photoState with selected filter
            photoState.photoSettings.filter = filterName;

            let filter = '';
            let filterString = filterName;

            switch (filterName) {
                case 'none':
                    filter = 'none';
                    filterString = 'Original';
                    break;
                case 'bw':
                    filter = 'grayscale(100%)';
                    filterString = 'Black & White';
                    break;
                case 'sepia':
                    filter = 'sepia(100%)';
                    filterString = 'Sepia';
                    break;
                case 'vintage':
                    filter = 'sepia(50%) contrast(0.9) brightness(0.9)';
                    filterString = 'Vintage';
                    break;
                case 'vivid':
                    filter = 'saturate(1.5) contrast(1.1)';
                    filterString = 'Vivid';
                    break;
                case 'warm':
                    filter = 'brightness(1.1) saturate(1.3) hue-rotate(10deg)';
                    filterString = 'Warm';
                    break;
                case 'cool':
                    filter = 'hue-rotate(-20deg) saturate(1.2) brightness(0.95)';
                    filterString = 'Cool';
                    break;
                default:
                    filter = 'none';
                    filterString = 'Original';
            }

            // Apply filter to video
            video.style.filter = filter;

            // Update active button state in filters panel
            document.querySelectorAll('.photo-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Find and mark the clicked button as active
            const activeBtn = document.querySelector(`[onclick="applyPhotoFilter('${filterName}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // Show toast feedback
            showToastRecording(` ${filterString}`, 'info', '');

            console.log(' Filter applied:', filterName);
        }

        // ============================================================================
        // PHOTO CAPTURE HELPER FUNCTIONS
        // ============================================================================

        // Show countdown timer with visual feedback
        async function showPhotoCountdown(seconds) {
            return new Promise((resolve) => {
                let remaining = seconds;

                // Create countdown overlay
                const overlay = document.createElement('div');
                overlay.id = 'photoCountdownOverlay';
                overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    `;

                const number = document.createElement('div');
                number.style.cssText = `
      font-size: 120px;
      font-weight: bold;
      color: #FFD700;
      text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
      animation: photoCountdownPulse 1s ease-in-out;
    `;
                number.textContent = remaining;

                overlay.appendChild(number);
                document.body.appendChild(overlay);

                // Add CSS animation if not exists
                if (!document.getElementById('photoCountdownStyle')) {
                    const style = document.createElement('style');
                    style.id = 'photoCountdownStyle';
                    style.textContent = `
        @keyframes photoCountdownPulse {
          0% { transform: scale(1); opacity: 1; }
          50% { transform: scale(1.2); opacity: 0.8; }
          100% { transform: scale(1); opacity: 1; }
        }
      `;
                    document.head.appendChild(style);
                }

                const interval = setInterval(() => {
                    remaining--;
                    if (remaining > 0) {
                        number.textContent = remaining;
                        number.style.animation = 'none';
                        setTimeout(() => {
                            number.style.animation = 'photoCountdownPulse 1s ease-in-out';
                        }, 10);
                    } else {
                        clearInterval(interval);
                        overlay.remove();
                        resolve();
                    }
                }, 1000);
            });
        }

        // Calculate canvas size based on selected aspect ratio
        function calculateCanvasSize(videoWidth, videoHeight) {
            const ratio = photoState.photoSettings.ratio;
            let canvasWidth, canvasHeight, offsetX = 0, offsetY = 0;

            const ratioMap = {
                '1:1': 1,
                '3:4': 3 / 4,
                '9:16': 9 / 16,
                '16:9': 16 / 9
            };

            const targetRatio = ratioMap[ratio] || 1;
            const currentRatio = videoWidth / videoHeight;

            if (currentRatio > targetRatio) {
                // Video is wider, crop sides
                canvasHeight = videoHeight;
                canvasWidth = Math.floor(videoHeight * targetRatio);
                offsetX = Math.floor((videoWidth - canvasWidth) / 2);
                offsetY = 0;
            } else {
                // Video is taller, crop top/bottom
                canvasWidth = videoWidth;
                canvasHeight = Math.floor(videoWidth / targetRatio);
                offsetX = 0;
                offsetY = Math.floor((videoHeight - canvasHeight) / 2);
            }

            return { canvasWidth, canvasHeight, offsetX, offsetY };
        }

        // Apply flash effect to captured image
        function applyFlashEffectToCanvas(ctx, width, height) {
            const flashMode = photoState.photoSettings.flash;

            // Skip if flash is off
            if (!flashMode) return;

            // For auto mode, we could check image brightness, but for now just apply normal flash
            const isAutoMode = flashMode === 'auto';
            const opacity = isAutoMode ? 0.08 : 0.15; // Lighter effect for auto mode

            // Create bright white overlay for flash effect
            ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
            ctx.fillRect(0, 0, width, height);

            // Add subtle glow at edges
            const gradient = ctx.createRadialGradient(width / 2, height / 2, 0, width / 2, height / 2, Math.max(width, height));
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.05)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
        }

        // ============================================================================

        function showGridOverlay(gridId) {
            let grid = document.getElementById(gridId);
            if (!grid) {
                grid = document.createElement('div');
                grid.id = gridId;
                grid.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 0;
      pointer-events: none;
      z-index: 10;
    `;

                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.style.cssText = 'border: 1px solid rgba(255,255,255,0.3);';
                    grid.appendChild(cell);
                }

                const preview = document.querySelector('#screen5 .camera-preview');
                if (preview) {
                    preview.style.position = 'relative';
                    preview.appendChild(grid);
                }
            }
            grid.style.display = 'grid';
        }

        function hideGridOverlay() {
            const grid = document.getElementById('grid-overlay-photo');
            if (grid) {
                grid.style.display = 'none';
            }
        }


        // ============================================================================
        // PHOTO CAPTURE WITH ADVANCED FEATURES (Timer, Grid, Flash, Gallery)
        // ============================================================================

        // Capture photo with timer support
        async function capturePhoto() {
            // Check if stream is available
            if (!photoState.photoStream || !photoState.photoStream.active) {
                alert(' Camera not initialized. Please wait a moment and try again.');
                await initializePhotoMode();
                return;
            }

            const video = document.getElementById('photoPreviewVideo');
            if (!video || !video.videoWidth || !video.videoHeight) {
                alert(' Camera not ready. Please wait for video stream to load.');
                return;
            }

            try {
                // STEP 1: Hide grid overlay before capturing (it should not appear in final photo)
                if (photoState.photoSettings.grid) {
                    hideGridOverlay();
                }

                // STEP 2: Handle timer with visual countdown
                if (photoState.photoSettings.timer > 0) {
                    await showPhotoCountdown(photoState.photoSettings.timer);
                }

                // STEP 3: Create canvas with NATIVE resolution for maximum quality
                if (!photoState.canvas) {
                    photoState.canvas = document.createElement('canvas');
                    // Professional quality context settings
                    photoState.ctx = photoState.canvas.getContext('2d', {
                        alpha: false,              // No transparency = better performance
                        desynchronized: true       // Faster rendering
                    });
                }

                // Set canvas dimensions to NATIVE video resolution (not CSS dimensions!)
                // This is critical: use video.videoWidth/Height, NOT offsetWidth/offsetHeight
                const { canvasWidth, canvasHeight, offsetX, offsetY } = calculateCanvasSize(video.videoWidth, video.videoHeight);
                photoState.canvas.width = canvasWidth;
                photoState.canvas.height = canvasHeight;

                // Disable image smoothing for crisp, sharp capture
                photoState.ctx.imageSmoothingEnabled = false;

                // STEP 4: Apply filter to canvas context
                if (photoState.photoSettings.filter !== 'none') {
                    photoState.ctx.filter = photoState.getPhotoFilterString(photoState.photoSettings.filter);
                } else {
                    photoState.ctx.filter = 'none';
                }

                // STEP 5: Draw video frame at NATIVE resolution with proper cropping for aspect ratio
                // Draw directly from video stream (no interpolation)
                photoState.ctx.drawImage(video, offsetX, offsetY, canvasWidth, canvasHeight, 0, 0, canvasWidth, canvasHeight);

                // STEP 6: Apply flash effect if enabled (brightness boost to capture)
                if (photoState.photoSettings.flash) {
                    applyFlashEffectToCanvas(photoState.ctx, canvasWidth, canvasHeight);
                }

                // STEP 7: Save photo with MAXIMUM quality and all settings
                // Convert canvas to JPEG at 100% quality (no compression artifacts)
                // Using toBlob for better performance than toDataURL
                const blob = await new Promise(resolve => {
                    photoState.canvas.toBlob(resolve, 'image/jpeg', 1.0);
                });

                // Convert to data URL for display
                const photoUrl = URL.createObjectURL(blob);

                // Log actual dimensions for verification
                console.log(' Photo captured at native resolution:', {
                    width: photoState.canvas.width,
                    height: photoState.canvas.height,
                    size: Math.round(blob.size / 1024) + 'KB',
                    blobSize: blob.size,
                    compression: '100% (lossless quality)'
                });

                const photoData = {
                    url: photoUrl,
                    blob: blob,  // Store blob for Firebase upload
                    timestamp: Date.now(),
                    resolution: `${photoState.canvas.width}x${photoState.canvas.height}`,
                    settings: { ...photoState.photoSettings }
                };

                photoState.capturedPhotos.push(photoData);
                photoState.currentPhotoIndex = photoState.capturedPhotos.length - 1;

                showToastRecording(' Photo captured!', 'success', '');
                console.log('Photo captured with settings:', photoState.photoSettings);

                // Stop camera after capturing (user won't need it in edit screen)
                stopPhotoMode();

                // Show photo in screen 6
                setTimeout(() => {
                    showScreen('screen6');
                    displayCapturedPhoto();
                }, 500);
            } catch (error) {
                console.error('Capture error:', error);
                alert(' Failed to capture photo: ' + error.message);
            }
        }

        // Display captured photo in preview
        function displayCapturedPhoto() {
            if (photoState.capturedPhotos.length === 0) return;

            const photo = photoState.capturedPhotos[photoState.currentPhotoIndex];
            const preview = document.querySelector('#screen6 .camera-preview');

            if (preview) {
                preview.innerHTML = `<img src="${photo.url}" style="width:100%; height:100%; object-fit:cover;">`;
            }
        }

        // Gallery function - select photo from device
        function openPhotoGallery() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const photoData = {
                            url: event.target.result,
                            timestamp: Date.now(),
                            settings: { ...photoState.photoSettings }
                        };
                        photoState.capturedPhotos.push(photoData);
                        photoState.currentPhotoIndex = photoState.capturedPhotos.length - 1;

                        // Stop camera when moving to edit screen
                        stopPhotoMode();

                        showToastRecording('Photo added from gallery', 'success', '');
                        setTimeout(() => {
                            showScreen('screen6');
                            displayCapturedPhoto();
                        }, 300);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // Show discard confirmation modal
        function showDiscardPhotoModal() {
            const modal = document.getElementById('discardPhotoModal');
            if (modal) {
                modal.classList.add('active');
            }
        }

        // Close discard modal (stay on screen 6)
        function closeDiscardModal() {
            const modal = document.getElementById('discardPhotoModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Confirm discard and go back to screen 5
        function confirmDiscardPhoto() {
            closeDiscardModal();

            // Clear current photo from state
            if (photoState.currentPhotoIndex >= 0) {
                photoState.capturedPhotos.splice(photoState.currentPhotoIndex, 1);
                photoState.currentPhotoIndex = Math.max(0, photoState.currentPhotoIndex - 1);
            }

            // Go back to camera screen
            showScreen('screen5');

            // Reinitialize camera
            initializePhotoMode().then(() => {
                showToastRecording(' Photo discarded, camera ready', 'info', '');
            });
        }

        // Download photo to device
        function downloadCapturedPhoto() {
            try {
                if (photoState.capturedPhotos.length === 0 || photoState.currentPhotoIndex < 0) {
                    showToastRecording(' No photo to download', 'error', '');
                    return;
                }

                const photo = photoState.capturedPhotos[photoState.currentPhotoIndex];

                // Create download link
                const link = document.createElement('a');
                link.href = photo.url;

                // Generate filename with timestamp
                const timestamp = new Date(photo.timestamp).toISOString().slice(0, 19).replace(/:/g, '-');
                const filterName = photo.settings.filter || 'original';
                link.download = `pose_photo_${timestamp}_${filterName}.jpg`;

                // Trigger download
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                showToastRecording(' Photo downloading...', 'success', '');
                console.log(' Photo download started:', link.download);

            } catch (error) {
                console.error('Download error:', error);
                showToastRecording(' Download failed: ' + error.message, 'error', '');
            }
        }

        // Update back button for screen 6 to show discard modal
        function backToScreen5() {
            showDiscardPhotoModal();
        }



        // Switch to video mode
        function switchToVideoMode() {
            // Stop camera before switching modes
            stopPhotoMode();

            showToastRecording('Switching to video mode...', 'info', '');
            setTimeout(() => {
                showScreen('screen3');
            }, 300);
        }

        // Photo edit functions
        function photoAddText() {
            showToastRecording(' Text editor coming soon', 'info', '');
        }

        function photoCrop() {
            showToastRecording(' Crop tool coming soon', 'info', '');
        }

        function photoAddEffects() {
            showToastRecording(' Effects editor coming soon', 'info', '');
        }

        function photoAddFilters() {
            showToastRecording(' Filter editor coming soon', 'info', '');
        }

        function photoDraw() {
            showToastRecording(' Drawing tool coming soon', 'info', '');
        }

        // Post photo
        async function saveDraftPhoto() {
            if (!currentUser || photoState.capturedPhotos.length === 0) {
                alert('Please login and capture a photo first');
                return;
            }

            const photo = photoState.capturedPhotos[photoState.currentPhotoIndex];

            try {
                showTiktokCountdown(5, async () => {
                    setTimeout(() => {
                        showUploadResultModal(true, ' Saving Draft...', 'Your photo draft is being saved');
                    }, 1000);

                    await savePhotoToFirebase(photo, 'draft');
                });
            } catch (error) {
                console.error('Error saving photo draft:', error);
                alert('Failed to save photo draft');
            }
        }

        async function publishPhotoPost() {
            if (!currentUser || photoState.capturedPhotos.length === 0) {
                alert('Please login and capture a photo first');
                return;
            }

            const caption = document.querySelector('#screen7 textarea')?.value || '';
            const photo = photoState.capturedPhotos[photoState.currentPhotoIndex];

            try {
                showTiktokCountdown(5, async () => {
                    setTimeout(() => {
                        showUploadResultModal(true, ' Publishing Photo...', 'Your photo is being published');
                    }, 1000);

                    await savePhotoToFirebase(photo, 'post', caption);
                });
            } catch (error) {
                console.error('Error publishing photo:', error);
                alert('Failed to publish photo');
            }
        }

        async function postPhotoStory() {
            if (!currentUser || photoState.capturedPhotos.length === 0) {
                alert('Please login and capture a photo first');
                return;
            }

            const photo = photoState.capturedPhotos[photoState.currentPhotoIndex];

            try {
                showTiktokCountdown(5, async () => {
                    setTimeout(() => {
                        showUploadResultModal(true, ' Posting Story...', 'Your photo story is being posted');
                    }, 1000);

                    await savePhotoToFirebase(photo, 'story');
                });
            } catch (error) {
                console.error('Error posting photo story:', error);
                alert('Failed to post photo story');
            }
        }

        async function savePhotoToFirebase(photo, type, caption = '') {
            try {
                const today = getTodayDate();
                const docId = generateDocId();

                const photoRef = ref(database, `photos/${today}/${type}/${docId}`);

                // Convert image to blob and upload to storage
                const photoBlob = await (await fetch(photo.url)).blob();
                const storageRef = ref(storage, `photos/${currentUser.uid}/${today}/${docId}.jpg`);
                const uploadResult = await uploadBytes(storageRef, photoBlob);
                const downloadUrl = await getDownloadURL(uploadResult.ref);

                // Save metadata to database
                await set(photoRef, {
                    uid: currentUser.uid,
                    imageUrl: downloadUrl,
                    caption: caption,
                    timestamp: Date.now(),
                    type: type,
                    settings: photo.settings
                });

                console.log('Photo saved:', docId);
                setTimeout(() => {
                    closeUploadResultModal();
                    resetPhotoMode();
                    showScreen('screen1');
                }, 3000);
            } catch (error) {
                console.error('Firebase error:', error);
                throw error;
            }
        }

        // Stop photo mode and release camera
        function stopPhotoMode() {
            console.log('Stopping photo mode - releasing camera');

            // Stop all media tracks
            if (photoState.photoStream) {
                photoState.photoStream.getTracks().forEach(track => {
                    console.log('Stopping track:', track.kind);
                    track.stop();
                });
                photoState.photoStream = null;
            }

            // Remove video element
            const video = document.getElementById('photoPreviewVideo');
            if (video) {
                video.srcObject = null;
                video.remove();
            }

            showToastRecording(' Camera released', 'info', '');
        }

        // Full reset - clears all photo data and stops camera
        function resetPhotoMode() {
            console.log('Resetting photo mode completely');

            photoState.capturedPhotos = [];
            photoState.currentPhotoIndex = 0;
            photoState.photoSettings = {
                flash: false,
                timer: 0,
                filter: 'none',
                grid: false,
                ratio: '1:1',
                effects: []
            };

            // Stop camera
            stopPhotoMode();
        }

        // Helper method
        // Complete filter mapping - ALL FILTERS
        photoState.getPhotoFilterString = function (filterName) {
            const filters = {
                'none': 'none',
                'bw': 'grayscale(100%)',
                'sepia': 'sepia(100%)',
                'vintage': 'sepia(50%) contrast(0.9) brightness(0.9)',
                'vivid': 'saturate(1.5) contrast(1.1)',
                'warm': 'brightness(1.1) saturate(1.3) hue-rotate(10deg)',
                'cool': 'hue-rotate(-20deg) saturate(1.2) brightness(0.95)'
            };
            const result = filters[filterName] || 'none';
            console.log(' Filter mapping:', filterName, '', result);
            return result;
        };

        function goToPhotoPostSettings() {
            showScreen('screen7');
        }

        // ============================================================================
        // TEXT MODE
        // ============================================================================

        function changeTextBg(element) {
            const bg = window.getComputedStyle(element).background;
            recordingState.textBgGradient = bg;

            // Update active color
            document.querySelectorAll('.rec-color-option').forEach(el => {
                el.classList.remove('active');
            });
            element.classList.add('active');

            const textCanvas = document.getElementById('textEditorBg');
            if (textCanvas) {
                textCanvas.style.background = bg;
            }
        }

        function changeTextAlign(align) {
            recordingState.textAlign = align;

            // Update active button
            document.querySelectorAll('.rec-text-tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.rec-text-tool-btn').classList.add('active');

            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.style.textAlign = align;
            }
        }

        function toggleBold() {
            recordingState.isBold = !recordingState.isBold;
            event.target.closest('.rec-text-tool-btn').classList.toggle('active');

            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.style.fontWeight = recordingState.isBold ? 'bold' : 'normal';
            }
        }

        function changeTextColor() {
            const color = prompt('Enter text color (hex or name):', recordingState.textColor);
            if (color) {
                recordingState.textColor = color;
                const textInput = document.getElementById('textInput');
                if (textInput) {
                    textInput.style.color = color;
                }
                showToastRecording('Text color changed', 'success', '');
            }
        }

        function goToTextPostSettings() {
            const textInput = document.getElementById('textInput');
            const textPreview = document.getElementById('textPreview');

            if (textPreview && textInput) {
                textPreview.innerHTML = `<span>${textInput.value || 'Your Text'}</span>`;
            }

            showScreen('screen9');
        }

        // ============================================================================
        // CAPTION COUNTERS
        // ============================================================================

        function updateCaptionCounter() {
            const captionInput = document.getElementById('recCaption');
            const counter = document.getElementById('captionCounter');

            if (captionInput && counter) {
                const length = captionInput.value.length;
                counter.textContent = `${length}/300`;
            }
        }

        function updatePhotoCaptionCounter() {
            const captionInput = document.getElementById('photoCaption');
            const counter = document.getElementById('photoCaptionCounter');

            if (captionInput && counter) {
                const length = captionInput.value.length;
                counter.textContent = `${length}/300`;
            }
        }

        function updateTextPostCaptionCounter() {
            const captionInput = document.getElementById('textPostCaption');
            const counter = document.getElementById('textPostCaptionCounter');

            if (captionInput && counter) {
                const length = captionInput.value.length;
                counter.textContent = `${length}/300`;
            }
        }

        // ============================================================================
        // POST SETTINGS NAVIGATION
        // ============================================================================

        function goToPostSettings() {
            showScreen('screen4');
        }

        // ============================================================================
        // FIREBASE HELPER FUNCTIONS
        // ============================================================================

        function getTodayDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function generateDocId() {
            return `post_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        // ============================================================================
        // PUBLISHING & SAVING
        // ============================================================================

        function saveDraftRecording() {
            const caption = document.getElementById('recCaption')?.value || '';
            const draft = {
                type: 'video',
                caption: caption,
                blob: recordingState.recordedBlob,
                timestamp: new Date().toISOString()
            };

            // Save to localStorage
            let drafts = JSON.parse(localStorage.getItem('recordingDrafts') || '[]');
            drafts.push(draft);
            localStorage.setItem('recordingDrafts', JSON.stringify(drafts));

            showToastRecording('Draft saved', 'success', '');
            closeRecordingUI();
        }

        function publishRecordingPost() {
            const caption = document.getElementById('recCaption')?.value || '';
            const post = {
                type: 'video',
                caption: caption,
                timestamp: new Date().toISOString(),
                privacy: document.querySelector('select').value
            };

            console.log('Publishing video post:', post);
            showToastRecording('Video posted successfully', 'success', '');
            closeRecordingUI();
        }

        function postStory() {
            showToastRecording('Added to your story', 'success', '');
            closeRecordingUI();
        }

        // Note: saveDraftPhoto, publishPhotoPost, and postPhotoStory are now located
        // in the PHOTO MODE section above with Firebase integration

        async function saveDraftText() {
            if (!currentUser) {
                alert(' Please login to save drafts');
                return;
            }

            const textInput = document.getElementById('textInput')?.value || '';
            const caption = document.getElementById('textPostCaption')?.value || '';

            if (!textInput.trim()) {
                alert(' Please enter some text');
                return;
            }

            try {
                // Show TikTok-style countdown
                showTiktokCountdown(5, async () => {
                    // Show success message 1 second after countdown
                    setTimeout(() => {
                        showUploadResultModal(true, ' Saving Draft...', 'Your text draft is being saved');
                    }, 1000);

                    // Save to Firebase
                    await saveDraftToFirebase(textInput, caption);
                });
            } catch (error) {
                console.error('Error saving draft:', error);
                hideTiktokCountdown();
                alert(' Failed to save draft: ' + error.message);
            }
        }

        async function saveDraftToFirebase(textInput, caption) {
            try {
                const todayDate = getTodayDate();
                const docId = generateDocId();
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                const draftData = {
                    id: docId,
                    userId: currentUser.uid,
                    userName: userData?.name || 'Anonymous',
                    username: userData?.username || 'user',
                    userProfilePic: userData?.profilePicUrl || null,
                    textContent: textInput,
                    caption: caption,
                    backgroundGradient: recordingState.textBgGradient || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    textAlign: recordingState.textAlign || 'center',
                    isBold: recordingState.isBold || false,
                    textColor: recordingState.textColor || '#fff',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    timestamp: Date.now(),
                    isDraft: true,
                    type: 'text'
                };

                await db.collection('textposts').doc(todayDate).collection('drafts').doc(docId).set(draftData);

                console.log(`Draft saved: /textposts/${todayDate}/drafts/${docId}`);

                // Update success modal
                document.getElementById('uploadResultTitle').textContent = ' Draft Saved!';
                document.getElementById('uploadResultMessage').textContent = 'Your draft was saved successfully!';

                // Reset form after 5 seconds
                setTimeout(() => {
                    closeUploadResultModal();
                    resetTextTab();
                    closeUploadPage();
                }, 5000);

            } catch (error) {
                console.error('Upload error:', error);
                showUploadResultModal(false, ' Save Failed', error.message);
            }
        }

        async function publishTextPost() {
            if (!currentUser) {
                alert(' Please login to post');
                return;
            }

            const textInput = document.getElementById('textInput')?.value || '';
            const caption = document.getElementById('textPostCaption')?.value || '';
            const privacySelect = document.querySelector('select');
            const privacy = privacySelect ? privacySelect.value : 'Everyone';

            if (!textInput.trim()) {
                alert(' Please enter some text');
                return;
            }

            try {
                // Show TikTok-style countdown
                showTiktokCountdown(5, async () => {
                    // Show success message 1 second after countdown
                    setTimeout(() => {
                        showUploadResultModal(true, ' Posting...', 'Your text is being processed');
                    }, 1000);

                    // Save to Firebase
                    await saveTextPostToFirebase(textInput, caption, privacy);
                });
            } catch (error) {
                console.error('Error posting text:', error);
                hideTiktokCountdown();
                alert(' Failed to post: ' + error.message);
            }
        }

        async function saveTextPostToFirebase(textInput, caption, privacy) {
            try {
                const todayDate = getTodayDate();
                const docId = generateDocId();
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                const postData = {
                    id: docId,
                    userId: currentUser.uid,
                    userName: userData?.name || 'Anonymous',
                    username: userData?.username || 'user',
                    userProfilePic: userData?.profilePicUrl || null,
                    textContent: textInput,
                    caption: caption,
                    privacy: privacy,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    timestamp: Date.now(),
                    type: 'text',
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    backgroundGradient: recordingState.textBgGradient || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    textAlign: recordingState.textAlign || 'center',
                    isBold: recordingState.isBold || false,
                    textColor: recordingState.textColor || '#fff'
                };

                await db.collection('textposts').doc(todayDate).collection('posts').doc(docId).set(postData);

                console.log(`Text post saved: /textposts/${todayDate}/posts/${docId}`);

                // Update success modal
                document.getElementById('uploadResultTitle').textContent = ' Text Posted!';
                document.getElementById('uploadResultMessage').textContent = 'Your text was posted successfully!';

                // Reset form after 5 seconds
                setTimeout(() => {
                    closeUploadResultModal();
                    resetTextTab();
                    closeUploadPage();
                }, 5000);

            } catch (error) {
                console.error('Upload error:', error);
                showUploadResultModal(false, ' Upload Failed', error.message);
            }
        }

        function resetTextTab() {
            document.getElementById('textInput').value = '';
            document.getElementById('textPostCaption').value = '';
        }

        async function postTextStory() {
            if (!currentUser) {
                alert(' Please login to post story');
                return;
            }

            const textInput = document.getElementById('textInput')?.value || '';

            if (!textInput.trim()) {
                alert(' Please enter some text');
                return;
            }

            try {
                // Show TikTok-style countdown
                showTiktokCountdown(5, async () => {
                    // Show success message 1 second after countdown
                    setTimeout(() => {
                        showUploadResultModal(true, ' Adding to Story...', 'Your story is being posted');
                    }, 1000);

                    // Save to Firebase
                    await saveTextStoryToFirebase(textInput);
                });
            } catch (error) {
                console.error('Error posting to story:', error);
                hideTiktokCountdown();
                alert(' Failed to post story: ' + error.message);
            }
        }

        async function saveTextStoryToFirebase(textInput) {
            try {
                const todayDate = getTodayDate();
                const docId = generateDocId();
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();

                const storyData = {
                    id: docId,
                    userId: currentUser.uid,
                    userName: userData?.name || 'Anonymous',
                    username: userData?.username || 'user',
                    userProfilePic: userData?.profilePicUrl || null,
                    textContent: textInput,
                    backgroundGradient: recordingState.textBgGradient || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    textAlign: recordingState.textAlign || 'center',
                    isBold: recordingState.isBold || false,
                    textColor: recordingState.textColor || '#fff',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    timestamp: Date.now(),
                    expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 24 hours
                    type: 'text',
                    views: 0
                };

                await db.collection('stories').doc(todayDate).collection('posts').doc(docId).set(storyData);

                console.log(`Story posted: /stories/${todayDate}/posts/${docId}`);

                // Update success modal
                document.getElementById('uploadResultTitle').textContent = ' Story Posted!';
                document.getElementById('uploadResultMessage').textContent = 'Your story will expire in 24 hours!';

                // Reset form after 5 seconds
                setTimeout(() => {
                    closeUploadResultModal();
                    resetTextTab();
                    closeUploadPage();
                }, 5000);

            } catch (error) {
                console.error('Story error:', error);
                showUploadResultModal(false, ' Story Failed', error.message);
            }
        }

        // ============================================================================
        // POPUP MANAGEMENT
        // ============================================================================

        function closeRecPopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.style.display = 'none';
            }
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        document.addEventListener('DOMContentLoaded', () => {
            // Set initial styles
            const textCanvas = document.getElementById('textEditorBg');
            if (textCanvas) {
                textCanvas.style.background = recordingState.textBgGradient;
            }

            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.style.textAlign = 'center';
            }

            // Add event listeners to menu items for demo
            document.querySelectorAll('.rec-menu-item').forEach(item => {
                item.addEventListener('click', function () {
                    showToastRecording(`${this.textContent} selected`, 'info', '');
                });
            });
        });

        function openRecordingUI() {
            const overlay = document.getElementById('recordingUIOverlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Show screen 1
            showRecordingScreen(1);
        }

        function closeRecordingUI() {
            const overlay = document.getElementById('recordingUIOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            // Reset state
            recordingUIState = {
                currentScreen: 1,
                isRecording: false,
                recordingTime: 0,
                caption: '',
                videoBlob: null
            };
        }
        // ============================================================================
        // SOUND LIBRARY FUNCTIONALITY
        // ============================================================================

        const soundLibraryState = {
            currentTab: 'favourite',
            selectedSound: null,
            isPlaying: false,
            currentAudio: null,
            bannerInterval: null,
            currentBannerIndex: 0,
            voiceRecorder: null,
            voiceRecordingBlob: null,
            voiceRecordingTime: 0,
            voiceTimerInterval: null,
            searchResults: {},
            currentSearchQuery: '',
            filters: {
                genre: '',
                country: '',
                year: ''
            },
            allSounds: {
                favourite: [],
                yourMusic: [],
                poseMusic: []
            }
        };

        // Banner Ads Data
        const bannerAds = [
            {
                type: 'image',
                url: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800',
                title: ' Trending Music',
                subtitle: 'Discover the hottest tracks'
            },
            {
                type: 'video',
                url: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                title: ' New Releases',
                subtitle: 'Fresh sounds daily'
            },
            {
                type: 'image',
                url: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800',
                title: ' Premium Collection',
                subtitle: 'Exclusive tracks for creators'
            },
            {
                type: 'image',
                url: 'https://images.unsplash.com/photo-1514320291840-2e0a9bf2a9ae?w=800',
                title: ' Editor\'s Pick',
                subtitle: 'Hand-picked sounds'
            }
        ];

        // ============================================================================
        // AFROBEAT MUSIC LIBRARY - Real Artists & Dynamic Loading
        // ============================================================================

        // Afrobeat Artists to fetch from iTunes API
        const afrobeatArtists = [
            'Zinoleisky',
            'Bhad Boi OML',
            'Balloranking',
            'Wizkid',
            'King Von',
            'Davido',
            'Burna Boy',
            'Rema',
            'Asake',
            'Tiwa Savage',
            'CKay',
            'Olamide'
        ];

        // Trending songs (manually marked for badge)
        const trendingSongs = new Set();

        // Main Afrobeat Music Library (will be populated dynamically)
        let poseMusicLibrary = [];

        // Music library state for rotation
        let musicLibraryState = {
            lastRefresh: 0,
            refreshInterval: 300000, // 5 minutes in milliseconds
            initialDelay: 10000, // 10 seconds before first rotation
            currentIndex: 0,
            allLoadedSongs: [],
            isLoading: false
        };

        // Hardcoded Afrobeat Fallback Songs (if API fails)
        const afrobeatFallbackSongs = [
            {
                id: 'afro1',
                title: 'Essence',
                artist: 'Wizkid ft. Tems',
                duration: '2:55',
                uses: '45M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/d6/2f/69/d62f69eb-fce9-72ac-e7c7-e1f47d14b1ed/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro2',
                title: 'Ye',
                artist: 'Burna Boy',
                duration: '3:30',
                uses: '38M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music113/v4/8f/c3/e7/8fc3e7e9-c2ed-6cc9-b15b-fae7e2e2a77f/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro3',
                title: 'Blinding Lights (Afrobeat Remix)',
                artist: 'The Weeknd ft. Wizkid',
                duration: '3:20',
                uses: '52M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music126/v4/cb/d8/5c/cbd85c4b-ba16-6b1b-c4f1-21ab5d8c86be/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro4',
                title: 'Calm Down',
                artist: 'Rema & Selena Gomez',
                duration: '3:08',
                uses: '40M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music126/v4/d1/5e/0f/d15e0fc1-65b8-3f4a-83db-29b67db04f98/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro5',
                title: 'Sunroof',
                artist: 'Nicky Youre ft. Afrobeat',
                duration: '2:50',
                uses: '35M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/a2/e4/e0/a2e4e0e7-79ba-e52e-2c72-1f8c53f01f37/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro6',
                title: 'Flowers',
                artist: 'Miley Cyrus (Afrobeat Version)',
                duration: '3:18',
                uses: '48M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/a6/21/3a/a6213a94-f825-fa06-b97e-5b4e3289c4d9/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro7',
                title: 'Terminator',
                artist: 'Zinoleisky',
                duration: '3:25',
                uses: '28M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/c9/f1/96/c9f196d2-6da1-c89e-80d4-8e3e7b5e0d2a/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro8',
                title: 'Unavailable',
                artist: 'Davido ft. Musa Keys',
                duration: '3:42',
                uses: '42M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music126/v4/4d/f8/f4/4df8f4c9-f1e0-6c2a-83db-1f5e8c9d3e2f/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro9',
                title: 'Aseju',
                artist: 'Asake',
                duration: '3:15',
                uses: '32M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music126/v4/9f/2d/c3/9f2dc3e5-6d9e-8f4a-92b8-3c4f5e6d7a8b/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3',
                category: 'Trending',
                trending: true
            },
            {
                id: 'afro10',
                title: 'Ye Her',
                artist: 'Olamide',
                duration: '2:58',
                uses: '26M',
                thumbnail: 'https://is1-ssl.mzstatic.com/image/thumb/Music116/v4/7b/8c/9d/7b8c9d4e-5f6a-7b8c-9d0e-1f2a3b4c5d6e/source/400x400bb.jpg',
                audioUrl: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3',
                category: 'Trending',
                trending: true
            }
        ];

        // Fetch Afrobeat songs from iTunes API
        async function fetchAfrobeatSongsFromItunes() {
            try {
                console.log(' Fetching Afrobeat songs from iTunes API...');
                musicLibraryState.isLoading = true;

                let allSongs = [];
                let successCount = 0;

                // Fetch top 2-3 songs from each artist
                for (const artist of afrobeatArtists) {
                    try {
                        const url = `https://itunes.apple.com/search?term=${encodeURIComponent(artist)}&entity=song&limit=5`;
                        console.log(`Fetching from: ${url}`);

                        const response = await fetch(url, {
                            method: 'GET',
                            mode: 'cors',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });

                        if (!response.ok) {
                            console.warn(` API returned status ${response.status} for artist: ${artist}`);
                            continue;
                        }

                        const data = await response.json();
                        console.log(` Response for ${artist}:`, data.resultCount, 'results');

                        if (data.results && data.results.length > 0) {
                            // Filter and map iTunes results
                            data.results.forEach((song, index) => {
                                if (song.previewUrl && index < 2) { // Only songs with preview URLs, max 2 per artist
                                    allSongs.push({
                                        id: `song_${allSongs.length}`,
                                        title: song.trackName || 'Unknown',
                                        artist: song.artistName || artist,
                                        duration: formatDuration(song.trackTimeMillis),
                                        uses: `${Math.floor(Math.random() * 50) + 10}M`,
                                        thumbnail: song.artworkUrl100 || song.artworkUrl60 || 'https://via.placeholder.com/200',
                                        audioUrl: song.previewUrl,
                                        category: 'Afrobeat',
                                        trending: index === 0 // First song from each artist is trending
                                    });
                                    successCount++;
                                }
                            });
                        }
                    } catch (error) {
                        console.warn(` Error fetching from artist: ${artist}`, error.message);
                    }
                }

                if (allSongs.length === 0) {
                    console.warn(' No songs fetched from iTunes, using fallback');
                    musicLibraryState.allLoadedSongs = afrobeatFallbackSongs;
                } else {
                    console.log(` Fetched ${allSongs.length} songs (${successCount} with preview URLs) from iTunes`);
                    musicLibraryState.allLoadedSongs = allSongs;
                }

                // Load initial batch
                rotatePoseMusicLibrary();
                musicLibraryState.lastRefresh = Date.now();
                musicLibraryState.isLoading = false;

                console.log(' Music library state:', {
                    totalSongs: musicLibraryState.allLoadedSongs.length,
                    currentBatch: poseMusicLibrary.length
                });

            } catch (error) {
                console.error(' Error fetching iTunes data:', error);
                // Fallback to hardcoded songs
                console.log(' Using fallback songs');
                musicLibraryState.allLoadedSongs = afrobeatFallbackSongs;
                rotatePoseMusicLibrary();
                musicLibraryState.isLoading = false;
            }
        }

        // Format duration from milliseconds
        function formatDuration(ms) {
            if (!ms) return '0:00';
            const seconds = Math.floor(ms / 1000);
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Rotate Pose Music Library every 20 minutes
        function rotatePoseMusicLibrary() {
            const songsPerBatch = 10;
            const startIndex = musicLibraryState.currentIndex % (musicLibraryState.allLoadedSongs.length - songsPerBatch + 1);

            poseMusicLibrary = musicLibraryState.allLoadedSongs.slice(startIndex, startIndex + songsPerBatch);

            // Mark some songs as trending
            poseMusicLibrary.forEach((song, index) => {
                song.trending = index < 3 || (Math.random() > 0.7);
            });

            musicLibraryState.currentIndex += 3; // Rotate offset
            console.log(` Music library rotated - showing songs ${startIndex} to ${startIndex + songsPerBatch}`);
        }

        // Schedule music rotation: 10 sec initial delay, then every 5 minutes
        function scheduleMusicsLibraryRotation() {
            console.log(` Music library rotation: ${musicLibraryState.initialDelay}ms initial delay, then every ${musicLibraryState.refreshInterval}ms (5 minutes)`);

            // First rotation after 10 seconds
            setTimeout(() => {
                console.log(' First music rotation after initial delay...');
                if (musicLibraryState.allLoadedSongs.length > 0) {
                    rotatePoseMusicLibrary();

                    // Reload if sound library is open
                    const container = document.getElementById('poseMusicSoundList');
                    if (container && container.innerHTML !== '') {
                        loadPoseMusicLibrary();
                        showToastRecording(' Music library refreshed!', 'success', '');
                        console.log(' Library reloaded with rotated songs');
                    }
                }

                // Then repeat every 5 minutes
                setInterval(() => {
                    console.log(' Rotating music library...');
                    if (musicLibraryState.allLoadedSongs.length > 0) {
                        rotatePoseMusicLibrary();

                        // Reload if sound library is open
                        const container = document.getElementById('poseMusicSoundList');
                        if (container && container.innerHTML !== '') {
                            loadPoseMusicLibrary();
                            showToastRecording(' Music library refreshed!', 'success', '');
                            console.log(' Library reloaded with rotated songs');
                        }
                    }
                }, musicLibraryState.refreshInterval);

            }, musicLibraryState.initialDelay);
        }

        // Open Sound Library
        async function openSoundLibrary() {
            try {
                const modal = document.getElementById('soundLibraryModal');
                if (!modal) {
                    console.error(' Sound library modal not found');
                    return;
                }

                modal.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Initialize
                initializeBannerAds();

                // Fetch Afrobeat songs if not already loaded
                if (musicLibraryState.allLoadedSongs.length === 0) {
                    console.log(' Loading music library for first time...');
                    await fetchAfrobeatSongsFromItunes();
                    scheduleMusicsLibraryRotation(); // Start 20-min rotation
                } else {
                    console.log(' Using cached music library:', musicLibraryState.allLoadedSongs.length, 'songs');
                }

                loadPoseMusicLibrary();
                loadFavouriteSounds();
                loadYourMusic();

                // Setup filter event listeners
                setupFilterListeners();

                console.log(' Sound library opened');
            } catch (error) {
                console.error(' Error opening sound library:', error);
                showToastRecording('Error opening sound library', 'error', '');
            }
        }

        // Close Sound Library
        function closeSoundLibrary() {
            const modal = document.getElementById('soundLibraryModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';

            // Stop any playing audio
            stopCurrentAudio();

            // Clear banner interval
            if (soundLibraryState.bannerInterval) {
                clearInterval(soundLibraryState.bannerInterval);
            }

            console.log(' Sound library closed');
        }

        // Initialize Banner Ads with Auto-Scroll
        function initializeBannerAds() {
            const slider = document.getElementById('bannerAdsSlider');
            const indicators = document.getElementById('bannerIndicators');

            // Clear existing
            slider.innerHTML = '';
            indicators.innerHTML = '';

            // Create banner items
            bannerAds.forEach((ad, index) => {
                const item = document.createElement('div');
                item.className = 'banner-ad-item';

                if (ad.type === 'image') {
                    item.innerHTML = `
                <img src="${ad.url}" alt="${ad.title}">
                <div class="banner-ad-overlay">
                    <div class="banner-ad-title">${ad.title}</div>
                    <div class="banner-ad-subtitle">${ad.subtitle}</div>
                </div>
            `;
                } else if (ad.type === 'video') {
                    item.innerHTML = `
                <video src="${ad.url}" autoplay muted loop></video>
                <div class="banner-ad-overlay">
                    <div class="banner-ad-title">${ad.title}</div>
                    <div class="banner-ad-subtitle">${ad.subtitle}</div>
                </div>
            `;
                }

                slider.appendChild(item);

                // Create indicator
                const indicator = document.createElement('div');
                indicator.className = `banner-indicator ${index === 0 ? 'active' : ''}`;
                indicator.onclick = () => goToBannerSlide(index);
                indicators.appendChild(indicator);
            });

            // Start auto-scroll
            startBannerAutoScroll();
        }

        // Auto-scroll banner ads
        function startBannerAutoScroll() {
            soundLibraryState.bannerInterval = setInterval(() => {
                const nextIndex = (soundLibraryState.currentBannerIndex + 1) % bannerAds.length;
                goToBannerSlide(nextIndex);
            }, 4000); // Change every 4 seconds
        }

        // Go to specific banner slide
        function goToBannerSlide(index) {
            const slider = document.getElementById('bannerAdsSlider');
            const indicators = document.querySelectorAll('.banner-indicator');

            soundLibraryState.currentBannerIndex = index;
            slider.style.transform = `translateX(-${index * 100}%)`;

            // Update indicators
            indicators.forEach((ind, i) => {
                ind.classList.toggle('active', i === index);
            });
        }

        // Switch Sound Tab
        function switchSoundTab(tabName) {
            soundLibraryState.currentTab = tabName;

            // Update tab buttons
            document.querySelectorAll('.sound-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.sound-tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const tabMap = {
                'favourite': 'favouriteTab',
                'yourMusic': 'yourMusicTab',
                'poseMusic': 'poseMusicTab',
                'voiceOver': 'voiceOverTab'
            };

            document.getElementById(tabMap[tabName]).classList.add('active');

            console.log(' Switched to tab:', tabName);
        }

        // Load Pose Music Library
        function loadPoseMusicLibrary() {
            const container = document.getElementById('poseMusicSoundList');
            container.innerHTML = '';

            if (poseMusicLibrary.length === 0) {
                container.innerHTML = `
            <div class="sound-empty">
                <div class="sound-empty-icon"></div>
                <div class="sound-empty-title">No sounds available</div>
                <div class="sound-empty-text">Check back soon for new music!</div>
            </div>
        `;
                return;
            }

            soundLibraryState.allSounds.poseMusic = poseMusicLibrary;

            poseMusicLibrary.forEach(sound => {
                const item = createSoundItem(sound, 'poseMusic');
                container.appendChild(item);
            });
        }

        // Load Favourite Sounds
        async function loadFavouriteSounds() {
            const container = document.getElementById('favouriteSoundList');
            container.innerHTML = '<div class="sound-loading"><div class="sound-loading-spinner"></div><p>Loading favourites...</p></div>';

            try {
                if (!currentUser) {
                    container.innerHTML = `
                <div class="sound-empty">
                    <div class="sound-empty-icon"></div>
                    <div class="sound-empty-title">Login to save favourites</div>
                    <div class="sound-empty-text">Your favourite sounds will appear here</div>
                </div>
            `;
                    return;
                }

                // Load from Firestore
                const snapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('favouriteSounds')
                    .orderBy('addedAt', 'desc')
                    .limit(50)
                    .get();

                container.innerHTML = '';

                if (snapshot.empty) {
                    container.innerHTML = `
                <div class="sound-empty">
                    <div class="sound-empty-icon"></div>
                    <div class="sound-empty-title">No favourites yet</div>
                    <div class="sound-empty-text">Add sounds to your favourites from Pose Music</div>
                </div>
            `;
                    return;
                }

                const sounds = [];
                snapshot.forEach(doc => {
                    sounds.push({ id: doc.id, ...doc.data() });
                });

                soundLibraryState.allSounds.favourite = sounds;

                sounds.forEach(sound => {
                    const item = createSoundItem(sound, 'favourite');
                    container.appendChild(item);
                });

            } catch (error) {
                console.error('Error loading favourites:', error);
                container.innerHTML = `
            <div class="sound-empty">
                <div class="sound-empty-icon"></div>
                <div class="sound-empty-title">Error loading favourites</div>
                <div class="sound-empty-text">${error.message}</div>
            </div>
        `;
            }
        }

        // Load Your Music
        async function loadYourMusic() {
            const container = document.getElementById('yourMusicSoundList');
            container.innerHTML = '<div class="sound-loading"><div class="sound-loading-spinner"></div><p>Loading your music...</p></div>';
            try {
                if (!currentUser) {
                    container.innerHTML = `
                <div class="sound-empty">
                    <div class="sound-empty-icon"></div>
                    <div class="sound-empty-title">Login to upload music</div>
                    <div class="sound-empty-text">Upload your own music tracks here</div>
                </div>
            `;
                    return;
                }

                // Load from Firestore
                const snapshot = await db.collection('users')
                    .doc(currentUser.uid)
                    .collection('uploadedMusic')
                    .orderBy('uploadedAt', 'desc')
                    .limit(50)
                    .get();

                container.innerHTML = '';

                if (snapshot.empty) {
                    container.innerHTML = `
                <div class="sound-empty">
                    <div class="sound-empty-icon"></div>
                    <div class="sound-empty-title">No music uploaded</div>
                    <div class="sound-empty-text">
                        <button class="modal-btn" onclick="uploadYourMusic()" style="margin-top: 20px;">
                             Upload Music
                        </button>
                    </div>
                </div>
            `;
                    return;
                }

                const sounds = [];
                snapshot.forEach(doc => {
                    sounds.push({ id: doc.id, ...doc.data() });
                });

                soundLibraryState.allSounds.yourMusic = sounds;

                sounds.forEach(sound => {
                    const item = createSoundItem(sound, 'yourMusic');
                    container.appendChild(item);
                });

            } catch (error) {
                console.error('Error loading your music:', error);
                container.innerHTML = `
            <div class="sound-empty">
                <div class="sound-empty-icon"></div>
                <div class="sound-empty-title">Error loading music</div>
                <div class="sound-empty-text">${error.message}</div>
            </div>
        `;
            }
        }

        // Create Sound Item with Trending Badge & Favorite
        function createSoundItem(sound, sourceTab) {
            const item = document.createElement('div');
            item.className = 'sound-item';
            item.dataset.soundId = sound.id;
            item.dataset.sourceTab = sourceTab;

            // Add trending badge if applicable
            const trendingBadge = sound.trending ? `
        <div class="trending-badge">
            <span class="trending-text"><i class="fas fa-fire"></i> Trending</span>
        </div>
    ` : '';

            // Favorite button
            const isFavorited = sound.isFavorited ? 'active' : '';
            const favoriteIcon = sound.isFavorited ? 'fas fa-heart' : 'far fa-heart';

            item.innerHTML = `
        <div class="sound-thumbnail">
            ${sound.thumbnail ? `<img src="${sound.thumbnail}" alt="${sound.title}">` : '<i class="fas fa-music"></i>'}
            <div class="sound-play-icon"><i class="fas fa-play"></i></div>
            ${trendingBadge}
            ${sound.previewNote ? `<div style="position: absolute; bottom: 4px; left: 4px; right: 4px; background: rgba(0,0,0,0.7); color: #fff; font-size: 10px; padding: 2px 4px; border-radius: 3px; text-align: center;">${sound.previewNote}</div>` : ''}
        </div>
        <div class="sound-info">
            <div class="sound-title">${sound.title}</div>
            <div class="sound-artist">${sound.artist || 'Unknown Artist'}</div>
            <div class="sound-meta">
                <span class="sound-duration" title="Full duration: ${sound.fullDuration || sound.duration}"><i class="fas fa-clock"></i> ${sound.duration || '0:00'}</span>
                ${sound.uses ? `<span class="sound-uses"><i class="fas fa-users"></i> ${sound.uses}</span>` : ''}
            </div>
        </div>
        <div class="sound-actions">
            <button class="sound-favorite-btn ${isFavorited}" onclick="toggleFavoriteSound('${sound.id}', '${sourceTab}', event)" title="Add to favorites">
                <i class="${favoriteIcon}"></i>
            </button>
            <button class="sound-action" onclick="selectSound('${sound.id}', '${sourceTab}', event)">
                <i class="fas fa-check"></i> Use
            </button>
        </div>
    `;

            // Add play on click
            item.querySelector('.sound-thumbnail').onclick = (e) => {
                e.stopPropagation();
                toggleSoundPlay(sound);
            };

            return item;
        }

        // Toggle Sound Play
        function toggleSoundPlay(sound) {
            if (soundLibraryState.isPlaying && soundLibraryState.currentAudio?.src === sound.audioUrl) {
                // Pause current
                soundLibraryState.currentAudio.pause();
                soundLibraryState.isPlaying = false;
                document.querySelectorAll('.sound-item').forEach(item => {
                    item.classList.remove('playing');
                });
            } else {
                // Stop any current audio
                stopCurrentAudio();
                // Play new
                soundLibraryState.currentAudio = new Audio(sound.audioUrl);
                soundLibraryState.currentAudio.play();
                soundLibraryState.isPlaying = true;

                // Mark as playing
                const item = document.querySelector(`[data-sound-id="${sound.id}"]`);
                if (item) item.classList.add('playing');

                // Auto-remove playing state when ended
                soundLibraryState.currentAudio.onended = () => {
                    soundLibraryState.isPlaying = false;
                    item.classList.remove('playing');
                };
            }
        }

        // Stop Current Audio
        function stopCurrentAudio() {
            if (soundLibraryState.currentAudio) {
                soundLibraryState.currentAudio.pause();
                soundLibraryState.currentAudio.currentTime = 0;
                soundLibraryState.isPlaying = false;
            }
            document.querySelectorAll('.sound-item').forEach(item => {
                item.classList.remove('playing');
            });
        }

        // Toggle Favorite Sound
        async function toggleFavoriteSound(soundId, sourceTab, event) {
            event.stopPropagation();

            if (!currentUser) {
                showToastRecording('Please login to save favorites', 'error', '');
                return;
            }

            try {
                // Get sound from library
                const sound = soundLibraryState.allSounds[sourceTab]?.find(s => s.id === soundId);
                if (!sound) {
                    console.error('Sound not found:', soundId);
                    return;
                }

                const isFavorited = sound.isFavorited;
                const btn = event.target.closest('.sound-favorite-btn');

                if (isFavorited) {
                    // Remove from favorites
                    await db.collection('users').doc(currentUser.uid).collection('favouriteSounds').doc(soundId).delete();
                    sound.isFavorited = false;
                    btn.classList.remove('active');
                    btn.innerHTML = '<i class="far fa-heart"></i>';
                    showToastRecording('Removed from favorites', 'info', '');
                } else {
                    // Add to favorites
                    await db.collection('users').doc(currentUser.uid).collection('favouriteSounds').doc(soundId).set({
                        ...sound,
                        addedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    sound.isFavorited = true;
                    btn.classList.add('active');
                    btn.innerHTML = '<i class="fas fa-heart"></i>';
                    showToastRecording('Added to favorites ', 'success', '');

                    // Get recommendations based on this favorite
                    getRecommendedSongs(sound);
                }

                console.log(` Favorite toggled for: ${sound.title}`);

            } catch (error) {
                console.error('Error toggling favorite:', error);
                showToastRecording('Error saving favorite', 'error', '');
            }
        }

        // Get Recommended Songs Based on Favorite
        async function getRecommendedSongs(favoriteSound) {
            try {
                // Recommend based on same artist or category
                const artist = favoriteSound.artist;
                const category = favoriteSound.category || 'Afrobeat';

                // Search for more songs by same artist
                const response = await fetch(
                    `https://itunes.apple.com/search?term=${encodeURIComponent(artist)}&entity=song&limit=10`,
                    { mode: 'cors' }
                );

                const data = await response.json();

                if (data.results && data.results.length > 1) {
                    const recommended = data.results.slice(0, 5).map((song, index) => ({
                        id: `rec_${Date.now()}_${index}`,
                        title: song.trackName,
                        artist: song.artistName || artist,
                        duration: formatDuration(song.trackTimeMillis),
                        thumbnail: song.artworkUrl100,
                        audioUrl: song.previewUrl,
                        category: category,
                        isRecommended: true,
                        trending: false,
                        uses: '0M'
                    })).filter(s => s.audioUrl); // Only include songs with previews

                    if (recommended.length > 0) {
                        showToastRecording(` ${recommended.length} recommended songs added!`, 'success', '');
                        console.log(` Recommendations for ${artist}:`, recommended);
                    }
                }
            } catch (error) {
                console.warn('Could not fetch recommendations:', error.message);
            }
        }

        // Select Sound
        function selectSound(soundId, sourceTab, event) {
            event.stopPropagation();
            const sound = soundLibraryState.allSounds[sourceTab].find(s => s.id === soundId);
            if (!sound) return;

            soundLibraryState.selectedSound = sound;

            // Mark as selected in modal
            document.querySelectorAll('.sound-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.sound-item').classList.add('active');

            // Show success feedback
            showToastRecording(` "${sound.title}" selected`, 'success', '');

            console.log('Selected sound:', sound);

            // Close modal and display sound on Screen 6
            setTimeout(() => {
                closeSoundLibrary();
                displaySelectedSoundOnScreen6(sound);
            }, 800);
        }


        // Display Selected Sound on Screen 6
        function displaySelectedSoundOnScreen6(sound) {
            const container = document.getElementById('selectedSoundContainer');
            const thumbnail = document.getElementById('soundDisplayThumbnail');
            const title = document.getElementById('soundDisplayTitle');
            const artist = document.getElementById('soundDisplayArtist');
            const playBtn = document.getElementById('soundPlayBtn');

            // Update display info
            title.textContent = sound.title;
            artist.textContent = sound.artist || 'Unknown Artist';

            // Update thumbnail
            if (sound.thumbnail) {
                thumbnail.innerHTML = `<img src="${sound.thumbnail}" alt="${sound.title}">`;
            } else {
                thumbnail.innerHTML = '<i class="fas fa-music"></i>';
            }

            // Reset play button
            playBtn.innerHTML = '<i class="fas fa-play"></i>';
            playBtn.classList.remove('playing');

            // Show container
            container.classList.add('show');

            console.log(' Sound displayed on Screen 6:', sound);
        }

        // Toggle Selected Sound Playback
        function toggleSelectedSoundPlayback() {
            if (!soundLibraryState.selectedSound) return;

            const sound = soundLibraryState.selectedSound;
            const btn = document.getElementById('soundPlayBtn');

            if (soundLibraryState.isPlaying && soundLibraryState.currentAudio?.src === sound.audioUrl) {
                // Pause current
                soundLibraryState.currentAudio.pause();
                soundLibraryState.isPlaying = false;
                btn.innerHTML = '<i class="fas fa-play"></i>';
                btn.classList.remove('playing');
            } else {
                // Stop any current audio
                stopCurrentAudio();

                // Play selected sound
                soundLibraryState.currentAudio = new Audio(sound.audioUrl);
                soundLibraryState.currentAudio.volume = 1;

                // Get trim boundaries (if trimmed)
                const startTime = sound.trimStart || 0;
                const endTime = sound.trimEnd || soundLibraryState.currentAudio.duration;

                // Start from trim point
                soundLibraryState.currentAudio.currentTime = startTime;
                soundLibraryState.currentAudio.play();
                soundLibraryState.isPlaying = true;
                btn.innerHTML = '<i class="fas fa-pause"></i>';
                btn.classList.add('playing');

                // Monitor playback and stop at trim end
                soundLibraryState.currentAudio.ontimeupdate = () => {
                    if (soundLibraryState.currentAudio.currentTime >= endTime) {
                        soundLibraryState.currentAudio.pause();
                        soundLibraryState.isPlaying = false;
                        btn.innerHTML = '<i class="fas fa-play"></i>';
                        btn.classList.remove('playing');
                    }
                };

                // Auto stop when finished
                soundLibraryState.currentAudio.onended = () => {
                    soundLibraryState.isPlaying = false;
                    btn.innerHTML = '<i class="fas fa-play"></i>';
                    btn.classList.remove('playing');
                };

                const trimInfo = sound.trimStart ? ` (${sound.trimDuration}s trimmed)` : '';
                showToastRecording(` Playing "${sound.title}"${trimInfo}`, 'info', '');
            }
        }

        // Remove Selected Sound
        function removeSelectedSound() {
            if (soundLibraryState.currentAudio) {
                soundLibraryState.currentAudio.pause();
                soundLibraryState.currentAudio = null;
                soundLibraryState.isPlaying = false;
            }

            soundLibraryState.selectedSound = null;
            document.getElementById('selectedSoundContainer').classList.remove('show');
            document.getElementById('soundPlayBtn').innerHTML = '<i class="fas fa-play"></i>';
            document.getElementById('soundPlayBtn').classList.remove('playing');

            showToastRecording(' Sound removed', 'info', '');
            console.log(' Selected sound removed');
        }

        // Open Sound Trimmer
        function openSoundTrimmer() {
            if (!soundLibraryState.selectedSound) {
                showToastRecording('No sound selected', 'error', '');
                return;
            }

            const sound = soundLibraryState.selectedSound;
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'soundTrimmerModal';

            // Use existing trim values or default to 0 and will detect actual duration
            const startVal = sound.trimStart !== undefined ? sound.trimStart : 0;
            // Will be updated once audio loads
            const endVal = sound.trimEnd !== undefined ? sound.trimEnd : null;

            modal.innerHTML = `
        <div class="modal" style="max-width: 95vw; width: 100%; max-height: 95vh; overflow-y: auto;">
            <button class="modal-close" onclick="closeSoundTrimmer()"><i class="fas fa-times"></i></button>
            <h2><i class="fas fa-cut"></i> Trim Sound - ${sound.title}</h2>
            <p style="color: #aaa; font-size: 13px; margin-bottom: 20px;">Select where the audio should start and stop</p>
            <div style="margin: 20px 0;">
                <audio id="trimPreviewAudio" style="width: 100%; margin-bottom: 20px;" controls>
                    <source src="${sound.audioUrl}" type="audio/mpeg">
                </audio>
                <div id="durationLoading" style="text-align: center; color: #888; font-size: 12px; padding: 10px;">
                    <i class="fas fa-spinner fa-spin"></i> Loading audio duration...
                </div>
                
                <!-- VISUAL TIMELINE SLIDER -->
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600;"><i class="fas fa-sliders-h"></i> Visual Trim Timeline</label>
                    <div style="background: linear-gradient(90deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%); border-radius: 8px; padding: 20px; border: 1px solid #444;">
                        <!-- Timeline Bar -->
                        <div style="position: relative; height: 40px; background: #0a0a0a; border-radius: 6px; border: 1px solid #555; cursor: pointer;" id="timelineBar">
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; align-items: center;">
                                <!-- Untrimmed region (gray) -->
                                <div id="beforeTrim" style="position: absolute; top: 0; height: 100%; background: rgba(255,255,255,0.1); border-radius: 6px 0 0 6px;"></div>
                                <!-- Trimmed region (blue) -->
                                <div id="trimmedRegion" style="position: absolute; top: 0; height: 100%; background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%); border-radius: 4px;"></div>
                                <!-- After trim (gray) -->
                                <div id="afterTrim" style="position: absolute; top: 0; right: 0; height: 100%; background: rgba(255,255,255,0.1); border-radius: 0 6px 6px 0;"></div>
                                <!-- Start handle -->
                                <div id="startHandle" style="position: absolute; top: 50%; transform: translateY(-50%); width: 12px; height: 40px; background: #ff0050; border-radius: 4px; cursor: col-resize; z-index: 10; box-shadow: 0 0 10px rgba(255,0,80,0.6);"></div>
                                <!-- End handle -->
                                <div id="endHandle" style="position: absolute; top: 50%; transform: translateY(-50%); width: 12px; height: 40px; background: #ff0050; border-radius: 4px; cursor: col-resize; z-index: 10; box-shadow: 0 0 10px rgba(255,0,80,0.6);"></div>
                            </div>
                        </div>
                        <!-- Time labels -->
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: #888;">
                            <span><i class="fas fa-play"></i> <strong id="startLabel">0.0s</strong></span>
                            <span id="durationLabel" style="color: #6366f1;"><strong>60.0s</strong></span>
                            <span><i class="fas fa-stop"></i> <strong id="endLabel">60.0s</strong></span>
                        </div>
                    </div>
                </div>
                
                <!-- NUMBER INPUT METHOD -->
                <div style="background: #0a0a0a; border-radius: 8px; padding: 15px; border: 1px solid #333; margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #ccc;"><i class="fas fa-keyboard"></i> Manual Input</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;"><i class="fas fa-play"></i> Start (s)</label>
                            <input type="number" id="trimStart" min="0" max="600" value="${startVal}" step="0.1" style="width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: white; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;"><i class="fas fa-stop"></i> End (s)</label>
                            <input type="number" id="trimEnd" min="0" max="600" value="${endVal}" step="0.1" style="width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 6px; color: white; font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <!-- RANGE SLIDER METHOD -->
                <div style="background: #0a0a0a; border-radius: 8px; padding: 15px; border: 1px solid #333; margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #ccc;"><i class="fas fa-sliders-h"></i> Range Slider</label>
                    <div style="margin-bottom: 15px;">
                        <label style="font-size: 12px; color: #888; display: block; margin-bottom: 8px;">Start Time</label>
                        <input type="range" id="startSlider" min="0" max="600" value="${startVal}" step="0.1" style="width: 100%; cursor: pointer;">
                        <span id="startSliderLabel" style="font-size: 12px; color: #6366f1; display: block; margin-top: 4px;">${startVal}s</span>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: #888; display: block; margin-bottom: 8px;">End Time</label>
                        <input type="range" id="endSlider" min="0" max="600" value="${endVal}" step="0.1" style="width: 100%; cursor: pointer;">
                        <span id="endSliderLabel" style="font-size: 12px; color: #6366f1; display: block; margin-top: 4px;">${endVal}s</span>
                    </div>
                </div>
                
                <div id="trimDurationDisplay" style="background: rgba(99, 102, 241, 0.2); border: 1px solid #6366f1; border-radius: 8px; padding: 12px; margin-bottom: 20px; color: #c7d2fe;">
                    <i class="fas fa-info-circle"></i> Duration: <strong id="trimDurationValue">30.0s</strong>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="applyAudioTrim()" class="modal-btn" style="flex: 1;">
                        <i class="fas fa-check"></i> Apply Trim
                    </button>
                    <button onclick="closeSoundTrimmer()" class="modal-btn" style="flex: 1; background: #666;">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
        `;

            document.body.appendChild(modal);

            // Setup event listeners
            const trimStart = document.getElementById('trimStart');
            const trimEnd = document.getElementById('trimEnd');
            const startSlider = document.getElementById('startSlider');
            const endSlider = document.getElementById('endSlider');
            const audioElement = document.getElementById('trimPreviewAudio');
            const durationLoading = document.getElementById('durationLoading');

            // Detect actual audio duration
            audioElement.addEventListener('loadedmetadata', () => {
                const actualDuration = Math.ceil(audioElement.duration);

                // Update max values to actual duration
                const newEndVal = endVal !== null ? endVal : actualDuration;

                // Update all range limits
                trimStart.max = actualDuration;
                trimEnd.max = actualDuration;
                startSlider.max = actualDuration;
                endSlider.max = actualDuration;

                // Set end value if not already set
                if (endVal === null) {
                    trimEnd.value = actualDuration;
                    endSlider.value = actualDuration;
                    document.getElementById('endSliderLabel').textContent = actualDuration + 's';
                    document.getElementById('endLabel').textContent = actualDuration.toFixed(1) + 's';
                }

                // Hide loading message
                durationLoading.style.display = 'none';

                // Update timeline
                updateTrimTimeline();

                console.log(` Audio duration detected: ${actualDuration}s`);
                showToastRecording(` Audio duration: ${actualDuration}s`, 'info', '');
            });

            // Handle audio load errors
            audioElement.addEventListener('error', () => {
                console.error(' Error loading audio');
                durationLoading.innerHTML = '<span style="color: #ff6b6b;">Error loading audio duration</span>';
            });

            // Sync all inputs
            trimStart.addEventListener('input', () => {
                startSlider.value = trimStart.value;
                updateTrimTimeline();
            });

            trimEnd.addEventListener('input', () => {
                endSlider.value = trimEnd.value;
                updateTrimTimeline();
            });

            startSlider.addEventListener('input', () => {
                trimStart.value = startSlider.value;
                document.getElementById('startSliderLabel').textContent = startSlider.value + 's';
                updateTrimTimeline();
            });

            endSlider.addEventListener('input', () => {
                trimEnd.value = endSlider.value;
                document.getElementById('endSliderLabel').textContent = endSlider.value + 's';
                updateTrimTimeline();
            });

            // Setup timeline handle dragging
            setupTimelineHandles();

            updateTrimTimeline();

            console.log(' Sound trimmer opened for:', sound.title);
        }

        // Setup draggable timeline handles
        function setupTimelineHandles() {
            const timeline = document.getElementById('timelineBar');
            const startHandle = document.getElementById('startHandle');
            const endHandle = document.getElementById('endHandle');
            const trimStart = document.getElementById('trimStart');
            const trimEnd = document.getElementById('trimEnd');

            if (!timeline || !startHandle || !endHandle) return;

            let isDragging = false;
            let dragType = null;

            startHandle.addEventListener('mousedown', (e) => {
                isDragging = true;
                dragType = 'start';
                e.preventDefault();
            });

            endHandle.addEventListener('mousedown', (e) => {
                isDragging = true;
                dragType = 'end';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const rect = timeline.getBoundingClientRect();
                const percent = Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100));
                const maxTime = parseFloat(trimEnd.max) || 600;
                const time = (percent / 100) * maxTime;

                if (dragType === 'start' && time < parseFloat(trimEnd.value)) {
                    trimStart.value = time.toFixed(1);
                    document.getElementById('startSlider').value = time.toFixed(1);
                    document.getElementById('startSliderLabel').textContent = time.toFixed(1) + 's';
                    updateTrimTimeline();
                } else if (dragType === 'end' && time > parseFloat(trimStart.value)) {
                    trimEnd.value = time.toFixed(1);
                    document.getElementById('endSlider').value = time.toFixed(1);
                    document.getElementById('endSliderLabel').textContent = time.toFixed(1) + 's';
                    updateTrimTimeline();
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                dragType = null;
            });
        }

        // Update timeline visual
        function updateTrimTimeline() {
            const trimStartInput = document.getElementById('trimStart');
            const trimEndInput = document.getElementById('trimEnd');
            const start = parseFloat(trimStartInput.value) || 0;
            const end = parseFloat(trimEndInput.value) || 60;
            // Use actual max from input or 600 as fallback
            const maxTime = parseFloat(trimEndInput.max) || 600;

            const startPercent = (start / maxTime) * 100;
            const endPercent = (end / maxTime) * 100;
            const duration = Math.max(0, end - start).toFixed(1);

            // Update timeline regions
            const beforeTrim = document.getElementById('beforeTrim');
            const trimmedRegion = document.getElementById('trimmedRegion');
            const afterTrim = document.getElementById('afterTrim');
            const startHandle = document.getElementById('startHandle');
            const endHandle = document.getElementById('endHandle');

            if (beforeTrim) beforeTrim.style.width = startPercent + '%';
            if (trimmedRegion) {
                trimmedRegion.style.left = startPercent + '%';
                trimmedRegion.style.width = (endPercent - startPercent) + '%';
            }
            if (afterTrim) {
                afterTrim.style.left = endPercent + '%';
                afterTrim.style.width = (100 - endPercent) + '%';
            }
            if (startHandle) startHandle.style.left = startPercent + '%';
            if (endHandle) endHandle.style.left = endPercent + '%';

            // Update labels
            document.getElementById('startLabel').textContent = start.toFixed(1) + 's';
            document.getElementById('endLabel').textContent = end.toFixed(1) + 's';
            document.getElementById('durationLabel').textContent = '<strong>' + duration + 's</strong>';
            document.getElementById('trimDurationValue').textContent = duration + 's';
        }

        // Update trim duration display
        function updateTrimDuration() {
            const start = parseFloat(document.getElementById('trimStart').value) || 0;
            const end = parseFloat(document.getElementById('trimEnd').value) || 0;
            const duration = Math.max(0, end - start).toFixed(1);
            document.getElementById('trimDurationValue').textContent = duration + 's';
        }

        // Apply Search Filters to Pose Music
        async function applySearchFilters() {
            const genre = document.getElementById('genreFilter').value;
            const country = document.getElementById('countryFilter').value;
            const year = document.getElementById('yearFilter').value;

            const container = document.getElementById('poseMusicSoundList');
            container.innerHTML = '<div class="sound-loading"><div class="sound-loading-spinner"></div><p>Searching...</p></div>';

            try {
                let filteredSongs = [];

                // Build search query based on selected filters
                let searchQuery = '';
                if (genre) {
                    searchQuery += genre + ' ';
                }
                if (country) {
                    searchQuery += country + ' ';
                }

                // If no filters, use default
                if (!searchQuery) {
                    searchQuery = 'afrobeat';
                }

                console.log(` Fetching songs with filters - Genre: ${genre}, Country: ${country}, Year: ${year}`);

                // Fetch from iTunes API with search query
                const response = await fetch(
                    `https://itunes.apple.com/search?term=${encodeURIComponent(searchQuery)}&entity=song&limit=20`,
                    { method: 'GET', mode: 'cors' }
                );

                const data = await response.json();

                if (data.results && data.results.length > 0) {
                    // Map and filter results
                    data.results.forEach((song, index) => {
                        if (song.previewUrl) {
                            // Try to extract year from releaseDate
                            const releaseYear = song.releaseDate ? song.releaseDate.substring(0, 4) : '';

                            // Filter by year if specified
                            if (year && releaseYear !== year) {
                                return;
                            }

                            filteredSongs.push({
                                id: `song_${filteredSongs.length}`,
                                title: song.trackName || 'Unknown',
                                artist: song.artistName || 'Unknown',
                                duration: formatDuration(song.trackTimeMillis),
                                uses: `${Math.floor(Math.random() * 50) + 10}M`,
                                thumbnail: song.artworkUrl100 || 'https://via.placeholder.com/200',
                                audioUrl: song.previewUrl,
                                category: genre || 'Music',
                                country: country || 'Global',
                                releaseDate: song.releaseDate || '',
                                trending: index < 3
                            });
                        }
                    });
                }

                // Update state
                soundLibraryState.allSounds.poseMusic = filteredSongs;
                musicLibraryState.allLoadedSongs = filteredSongs;
                poseMusicLibrary = filteredSongs.slice(0, 10);

                container.innerHTML = '';

                if (filteredSongs.length === 0) {
                    container.innerHTML = `
                        <div class="sound-empty">
                            <div class="sound-empty-icon"></div>
                            <div class="sound-empty-title">No results found</div>
                            <div class="sound-empty-text">Try different filters</div>
                        </div>
                    `;
                    console.log(' No songs found with selected filters');
                    return;
                }

                filteredSongs.forEach(sound => {
                    const item = createSoundItem(sound, 'poseMusic');
                    container.appendChild(item);
                });

                console.log(` Found ${filteredSongs.length} songs with filters`);
                showToastRecording(` Found ${filteredSongs.length} songs!`, 'success', '');

            } catch (error) {
                console.error('Error applying filters:', error);
                container.innerHTML = `
                    <div class="sound-empty">
                        <div class="sound-empty-icon"></div>
                        <div class="sound-empty-title">Search failed</div>
                        <div class="sound-empty-text">${error.message}</div>
                    </div>
                `;
                showToastRecording('Search failed: ' + error.message, 'error', '');
            }
        }

        // Close Sound Trimmer
        function closeSoundTrimmer() {
            const modal = document.getElementById('soundTrimmerModal');
            if (modal) modal.remove();
        }

        // Apply Audio Trim
        function applyAudioTrim() {
            const startTime = parseFloat(document.getElementById('trimStart').value) || 0;
            const endTime = parseFloat(document.getElementById('trimEnd').value) || 30;

            if (startTime >= endTime) {
                showToastRecording('Start time must be less than end time', 'error', '');
                return;
            }

            // Update selected sound with trim info
            soundLibraryState.selectedSound.trimStart = startTime;
            soundLibraryState.selectedSound.trimEnd = endTime;
            soundLibraryState.selectedSound.trimDuration = (endTime - startTime).toFixed(2);

            closeSoundTrimmer();
            showToastRecording(` Trimmed to ${soundLibraryState.selectedSound.trimDuration}s`, 'success', '');
            console.log(' Sound trimmed:', soundLibraryState.selectedSound.trimStart, '-', soundLibraryState.selectedSound.trimEnd);
        }

        // Genre mapping for iTunes API
        const genreToiTunesGenre = {
            'afrobeat': 'afrobeat',
            'hip-hop': 'hip hop',
            'pop': 'pop',
            'r&b': 'r&b',
            'amapiano': 'amapiano',
            'reggae': 'reggae',
            'house': 'house',
            'gospel': 'gospel'
        };

        // Country to artist mapping
        const countryArtists = {
            'NG': ['Wizkid', 'Burna Boy', 'Davido', 'Olamide', 'Asake', 'CKay', 'Tiwa Savage', 'Rema'],
            'GH': ['Sarkodie', 'Shatta Wale', 'King Promise', 'Ace Hood'],
            'ZA': ['Amapiano Artists', 'DJ Maphorisa', 'Kabza De Small'],
            'KE': ['Sauti Sol', 'Nyashinski'],
            'UG': ['Eddy Kenzo', 'Bobi Wine'],
            'CM': ['Stanley Enow', 'Magasco'],
            'US': ['The Weeknd', 'Drake', 'Kendrick Lamar'],
            'UK': ['Skepta', 'Ed Sheeran']
        };

        // Apply search filters
        function applySearchFilters() {
            const query = soundLibraryState.currentSearchQuery;
            if (!query || query.trim() === '') {
                loadPoseMusicLibrary();
                return;
            }
            searchSounds('poseMusic', query);
        }

        // Filter state for search
        let soundFilterState = {
            genre: '',
            country: '',
            year: '',
            currentQuery: '',
            currentTab: 'poseMusic'
        };

        // Debounce timers for search
        let searchDebounceTimer = {};

        // Search Sounds - Production-level Local + API Search with Advanced Filtering
        async function searchSounds(tab, query) {
            // Debounce to prevent excessive searches (wait 300ms)
            clearTimeout(searchDebounceTimer[tab]);

            soundFilterState.currentQuery = query;
            soundFilterState.currentTab = tab;

            searchDebounceTimer[tab] = setTimeout(() => {
                applySearchFilters();
            }, 300);
        }

        // Apply Search Filters with Relevance Scoring
        async function applySearchFilters() {
            const tab = soundFilterState.currentTab;
            const query = soundFilterState.currentQuery || '';

            // Get filter values only for poseMusic tab
            if (tab === 'poseMusic') {
                soundFilterState.genre = document.getElementById('genreFilter')?.value || '';
                soundFilterState.country = document.getElementById('countryFilter')?.value || '';
                soundFilterState.year = document.getElementById('yearFilter')?.value || '';
            }

            const containerMap = {
                'favourite': 'favouriteSoundList',
                'yourMusic': 'yourMusicSoundList',
                'poseMusic': 'poseMusicSoundList'
            };

            const container = document.getElementById(containerMap[tab]);

            // Ensure allSounds[tab] exists
            if (!soundLibraryState.allSounds[tab]) {
                soundLibraryState.allSounds[tab] = [];
            }

            const allSounds = soundLibraryState.allSounds[tab];

            // If query is empty, show trending/library songs
            if (!query || query.trim() === '') {
                container.innerHTML = '';

                // For poseMusic tab, show loaded library songs
                if (tab === 'poseMusic' && musicLibraryState.allLoadedSongs.length > 0) {
                    const filtered = applyFilters(musicLibraryState.allLoadedSongs, tab);

                    if (filtered.length === 0) {
                        container.innerHTML = `
                        <div class="sound-empty">
                            <div class="sound-empty-icon"></div>
                            <div class="sound-empty-title">No sounds found</div>
                            <div class="sound-empty-text">Try adjusting filters or search for songs</div>
                        </div>
                        `;
                        return;
                    }

                    filtered.forEach(sound => {
                        const item = createSoundItem(sound, tab);
                        container.appendChild(item);
                    });
                    console.log(` Showing ${filtered.length} songs from library with filters applied`);
                    return;
                }

                // For other tabs, show saved sounds
                const filtered = applyFilters(allSounds, tab);

                if (filtered.length === 0) {
                    container.innerHTML = `
                    <div class="sound-empty">
                        <div class="sound-empty-icon"></div>
                        <div class="sound-empty-title">No sounds found</div>
                        <div class="sound-empty-text">Try adjusting filters or adding more sounds</div>
                    </div>
                    `;
                    return;
                }

                filtered.forEach(sound => {
                    const item = createSoundItem(sound, tab);
                    container.appendChild(item);
                });
                console.log(` Showing ${filtered.length} sounds with filters applied`);
                return;
            }

            // Show loading
            container.innerHTML = '<div class="sound-loading"><div class="sound-loading-spinner"></div><p> Searching...</p></div>';

            // Normalize query
            const normalizedQuery = query.trim().toLowerCase();
            const queryTerms = normalizedQuery.split(/\s+/).filter(t => t.length > 0);

            // Local search with relevance scoring
            const localResultsWithScore = allSounds
                .map(sound => ({
                    sound,
                    score: calculateSearchRelevance(sound, normalizedQuery, queryTerms),
                    type: 'local'
                }))
                .filter(result => result.score > 0)
                .sort((a, b) => b.score - a.score);

            // For poseMusic tab, also search iTunes API with advanced filters
            let apiResultsWithScore = [];
            if (tab === 'poseMusic' && queryTerms.length > 0) {
                try {
                    // Build iTunes API URL with filters
                    let itunesUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=30`;

                    // Add genre filter if selected (search by genre term)
                    if (soundFilterState.genre) {
                        itunesUrl += `&genreIndex=${encodeURIComponent(soundFilterState.genre)}`;
                    }

                    console.log(` iTunes API search: ${itunesUrl}`);

                    const response = await fetch(itunesUrl, { mode: 'cors' });

                    if (response.ok) {
                        const data = await response.json();

                        if (data.results && data.results.length > 0) {
                            const apiResults = data.results
                                .filter(song => song.previewUrl && song.trackName && song.artistName)
                                .map((song, index) => {
                                    // Extract year from releaseDate
                                    const releaseYear = song.releaseDate ?
                                        new Date(song.releaseDate).getFullYear() :
                                        new Date().getFullYear();

                                    // Extract genre from primaryGenreName
                                    const genre = song.primaryGenreName || 'Music';

                                    return {
                                        id: `api_${Date.now()}_${index}`,
                                        title: song.trackName || 'Unknown',
                                        artist: song.artistName || 'Unknown Artist',
                                        duration: formatDuration(song.trackTimeMillis),
                                        fullDuration: formatDuration(song.trackTimeMillis),
                                        previewNote: '(30s preview)',
                                        thumbnail: song.artworkUrl100 || song.artworkUrl60,
                                        audioUrl: song.previewUrl,
                                        category: genre,
                                        releaseYear: releaseYear,
                                        releaseDate: song.releaseDate,
                                        uses: `${Math.floor(Math.random() * 100)}K`,
                                        isTrimable: true,
                                        isAPIResult: true
                                    };
                                });

                            // Apply year and country filters to API results
                            let filteredAPIResults = apiResults;

                            // Year filter
                            if (soundFilterState.year) {
                                filteredAPIResults = filteredAPIResults.filter(song =>
                                    song.releaseYear === parseInt(soundFilterState.year)
                                );
                                console.log(` Year filter (${soundFilterState.year}): ${filteredAPIResults.length} results`);
                            }

                            // Genre filter
                            if (soundFilterState.genre) {
                                filteredAPIResults = filteredAPIResults.filter(song =>
                                    song.category?.toLowerCase().includes(soundFilterState.genre.toLowerCase())
                                );
                                console.log(` Genre filter (${soundFilterState.genre}): ${filteredAPIResults.length} results`);
                            }

                            apiResultsWithScore = filteredAPIResults
                                .map(sound => ({
                                    sound,
                                    score: calculateSearchRelevance(sound, normalizedQuery, queryTerms) + 50,
                                    type: 'api'
                                }))
                                .filter(result => result.score > 0);

                            console.log(` iTunes API returned ${filteredAPIResults.length} filtered results`);
                        }
                    }
                } catch (error) {
                    console.warn(' API search failed:', error.message);
                }
            }

            // Combine results and sort by relevance
            let allResults = [...localResultsWithScore, ...apiResultsWithScore]
                .sort((a, b) => b.score - a.score)
                .slice(0, 20) // Limit to 20 results
                .map(r => r.sound);

            // Apply filters to results
            allResults = applyFilters(allResults, tab);

            container.innerHTML = '';

            if (allResults.length === 0) {
                container.innerHTML = `
                <div class="sound-empty">
                    <div class="sound-empty-icon"></div>
                    <div class="sound-empty-title">No results for "${query}"</div>
                    <div class="sound-empty-text">Try different keywords or adjust filters</div>
                </div>
            `;
                console.log(` No results for "${query}" in ${tab}`);
                return;
            }

            allResults.forEach(sound => {
                const item = createSoundItem(sound, tab);
                container.appendChild(item);
            });

            const localCount = localResultsWithScore.length;
            const apiCount = apiResultsWithScore.length;
            console.log(` Found ${allResults.length} results (${localCount} local + ${apiCount} API) for "${query}"`);
        }

        // Calculate search relevance score
        function calculateSearchRelevance(sound, normalizedQuery, queryTerms) {
            let score = 0;

            const title = (sound.title || '').toLowerCase();
            const artist = (sound.artist || '').toLowerCase();
            const category = (sound.category || '').toLowerCase();

            // Title matching (highest priority - 40% weight)
            if (title === normalizedQuery) {
                score += 1000;
            } else if (title.startsWith(normalizedQuery)) {
                score += 500;
            } else if (title.includes(normalizedQuery)) {
                score += 300;
            } else {
                // Multi-word partial matching
                queryTerms.forEach(term => {
                    if (title.includes(term)) {
                        score += 100;
                    }
                });
            }

            // Artist matching (medium priority - 30% weight)
            if (artist === normalizedQuery) {
                score += 800;
            } else if (artist.startsWith(normalizedQuery)) {
                score += 400;
            } else if (artist.includes(normalizedQuery)) {
                score += 200;
            } else {
                queryTerms.forEach(term => {
                    if (artist.includes(term)) {
                        score += 60;
                    }
                });
            }

            // Category matching (low priority - 15% weight)
            if (category === normalizedQuery) {
                score += 150;
            } else if (category.includes(normalizedQuery)) {
                score += 50;
            }

            // Popularity bonuses
            if (sound.uses) {
                const uses = parseInt(sound.uses);
                if (uses > 100000) score += 100; // Very popular
                else if (uses > 50000) score += 50;
                else if (uses > 10000) score += 20;
            }

            // Trending bonus
            if (sound.trending) {
                score += 150;
            }

            // Recent upload bonus
            if (sound.uploadedAt) {
                const daysSince = (Date.now() - sound.uploadedAt) / (1000 * 60 * 60 * 24);
                if (daysSince < 7) score += 100;
                else if (daysSince < 30) score += 50;
            }

            return score;
        }

        // Apply Filters to Results
        function applyFilters(sounds, tab) {
            if (tab !== 'poseMusic') {
                return sounds; // Only filter on poseMusic tab
            }

            const { genre, country, year } = soundFilterState;

            return sounds.filter(sound => {
                // Genre filter
                if (genre && sound.category) {
                    const soundGenre = sound.category.toLowerCase();
                    if (!soundGenre.includes(genre.toLowerCase())) {
                        return false;
                    }
                }

                // Year filter
                if (year) {
                    const soundYear = sound.releaseYear || new Date().getFullYear();
                    if (soundYear !== parseInt(year)) {
                        return false;
                    }
                }

                // Country filter (check artist origin based on category or use random match for demo)
                if (country) {
                    // In production, you'd have artist country metadata
                    const artistCountries = {
                        'NG': ['Wizkid', 'Burna Boy', 'Davido', 'Olamide', 'Asake'],
                        'GH': ['Sarkodie', 'Shatta Wale'],
                        'ZA': ['Amapiano', 'Kabza'],
                        'KE': ['Sauti Sol'],
                        'UG': ['Eddy Kenzo'],
                        'US': ['Beyonc', 'Drake'],
                        'UK': ['Stormzy', 'Skepta']
                    };

                    const countrySongs = artistCountries[country] || [];
                    const artistMatch = countrySongs.some(a =>
                        sound.artist?.toLowerCase().includes(a.toLowerCase())
                    );

                    if (!artistMatch && country !== '') {
                        return false;
                    }
                }

                return true;
            });
        }

        // Reset All Filters
        function resetSoundFilters() {
            soundFilterState.genre = '';
            soundFilterState.country = '';
            soundFilterState.year = '';
            soundFilterState.currentQuery = '';

            const genreFilter = document.getElementById('genreFilter');
            const countryFilter = document.getElementById('countryFilter');
            const yearFilter = document.getElementById('yearFilter');
            const searchInput = document.querySelector('.sound-search-input');

            if (genreFilter) genreFilter.value = '';
            if (countryFilter) countryFilter.value = '';
            if (yearFilter) yearFilter.value = '';
            if (searchInput) searchInput.value = '';

            applySearchFilters();
            showToastRecording('Filters reset', 'info', '');
            console.log(' Filters reset');
        }

        // Setup filter event listeners on modal load
        function setupFilterListeners() {
            const genreFilter = document.getElementById('genreFilter');
            const countryFilter = document.getElementById('countryFilter');
            const yearFilter = document.getElementById('yearFilter');

            if (genreFilter) {
                genreFilter.addEventListener('change', applySearchFilters);
            }
            if (countryFilter) {
                countryFilter.addEventListener('change', applySearchFilters);
            }
            if (yearFilter) {
                yearFilter.addEventListener('change', applySearchFilters);
            }

            console.log(' Filter listeners initialized');
        }

        // Upload Your Music
        function uploadYourMusic() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'audio/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (!currentUser) {
                    showToastRecording('Please login to upload music', 'error', '');
                    return;
                }

                try {
                    showToastRecording(' Uploading music to your library...', 'info', '');

                    // Upload to Cloudinary
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                    formData.append('folder', 'user_music');

                    const response = await fetch(CLOUDINARY_API_URL, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    // Save to Firestore
                    await db.collection('users').doc(currentUser.uid).collection('uploadedMusic').add({
                        title: file.name.replace(/\.[^/.]+$/, ''),
                        artist: 'You',
                        audioUrl: data.secure_url,
                        duration: '0:00',
                        category: 'Uploaded',
                        isTrimable: true,
                        trimStart: 0,
                        trimEnd: null,
                        uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    showToastRecording(' Uploaded to your music!', 'success', '');
                    console.log(' Music uploaded:', file.name);
                    loadYourMusic();

                } catch (error) {
                    console.error('Upload error:', error);
                    showToastRecording(' Upload failed: ' + error.message, 'error', '');
                }
            };
            input.click();
        }

        // Voice Recording Functions
        let voiceRecordingState = {
            recorder: null,
            chunks: [],
            startTime: 0,
            timerInterval: null
        };

        async function startVoiceRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                voiceRecordingState.recorder = new MediaRecorder(stream);
                voiceRecordingState.chunks = [];

                voiceRecordingState.recorder.ondataavailable = (e) => {
                    voiceRecordingState.chunks.push(e.data);
                };

                voiceRecordingState.recorder.onstop = () => {
                    const blob = new Blob(voiceRecordingState.chunks, { type: 'audio/webm' });
                    soundLibraryState.voiceRecordingBlob = blob;
                };

                voiceRecordingState.recorder.start();
                voiceRecordingState.startTime = Date.now();

                // Update UI
                document.getElementById('voiceRecordBtn').style.display = 'none';
                document.getElementById('voiceStopBtn').style.display = 'flex';
                document.getElementById('voiceVisualizer').classList.add('recording');

                // Start timer
                voiceRecordingState.timerInterval = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - voiceRecordingState.startTime) / 1000);
                    const mins = Math.floor(elapsed / 60);
                    const secs = elapsed % 60;
                    document.getElementById('voiceTimer').textContent =
                        `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
                }, 1000);

                showToastRecording(' Recording...', 'info', '');

            } catch (error) {
                console.error('Microphone error:', error);
                alert(' Microphone access denied');
            }
        }

        function stopVoiceRecording() {
            if (voiceRecordingState.recorder) {
                voiceRecordingState.recorder.stop();
                voiceRecordingState.recorder.stream.getTracks().forEach(track => track.stop());
                clearInterval(voiceRecordingState.timerInterval);

                // Update UI
                document.getElementById('voiceStopBtn').style.display = 'none';
                document.getElementById('voiceSaveBtn').style.display = 'flex';
                document.getElementById('voiceVisualizer').classList.remove('recording');

                showToastRecording(' Recording stopped', 'success', '');
            }
        }

        async function saveVoiceRecording() {
            if (!soundLibraryState.voiceRecordingBlob) {
                showToastRecording('No recording to save', 'error', '');
                return;
            }
            if (!currentUser) {
                showToastRecording('Please login to save voice recording', 'error', '');
                return;
            }

            try {
                showToastRecording(' Saving voice to your music...', 'info', '');

                // Upload to Cloudinary
                const formData = new FormData();
                formData.append('file', soundLibraryState.voiceRecordingBlob);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
                formData.append('folder', 'voice_recordings');

                const response = await fetch(CLOUDINARY_API_URL, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                // Save to Firestore
                const voiceData = {
                    title: `Voice Recording ${new Date().toLocaleString()}`,
                    artist: 'You',
                    audioUrl: data.secure_url,
                    duration: document.getElementById('voiceTimer').textContent,
                    uploadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    category: 'Voice',
                    isTrimable: true,
                    trimStart: 0,
                    trimEnd: null
                };

                await db.collection('users').doc(currentUser.uid).collection('uploadedMusic').add(voiceData);

                // Also add to selected sound
                soundLibraryState.selectedSound = {
                    id: data.public_id,
                    ...voiceData
                };

                console.log(' Voice recording saved to your music');

                // Reset UI
                document.getElementById('voiceTimer').textContent = '00:00';
                document.getElementById('voiceSaveBtn').style.display = 'none';
                document.getElementById('voiceRecordBtn').style.display = 'flex';

                // Reload your music tab
                await loadYourMusic();

                // Show success modal with options
                showVoiceRecordingSuccess();

            } catch (error) {
                console.error('Save error:', error);
                showToastRecording(' Save failed: ' + error.message, 'error', '');
            }
        }

        // Show Voice Recording Success Modal
        function showVoiceRecordingSuccess() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay active';
            modal.id = 'voiceSuccessModal';
            modal.innerHTML = `
                <div class="modal" style="max-width: 400px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;"></div>
                    <h2 style="margin-bottom: 10px;">Voice Over Saved!</h2>
                    <p style="color: #aaa; margin-bottom: 30px;">Your voice over has been added to your music</p>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="modal-btn" onclick="goToYourMusicTab()" style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                            <i class="fas fa-check"></i> Check it out
                        </button>
                        <button class="modal-btn" style="background: #6366f1; display: flex; align-items: center; justify-content: center; gap: 8px;" onclick="makeAnotherVoiceRecording()">
                            <i class="fas fa-plus"></i> Make another one
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        // Go to Your Music Tab
        function goToYourMusicTab() {
            // Close success modal
            const modal = document.getElementById('voiceSuccessModal');
            if (modal) modal.remove();

            // Switch to Your Music tab
            switchSoundTab('yourMusic');

            // Scroll to top
            const tabContent = document.getElementById('yourMusicTab');
            if (tabContent) {
                tabContent.scrollTop = 0;
            }
        }

        // Make Another Voice Recording
        function makeAnotherVoiceRecording() {
            // Close success modal
            const modal = document.getElementById('voiceSuccessModal');
            if (modal) modal.remove();

            // Switch back to Voice Over tab
            switchSoundTab('voiceOver');
        }

    </script>
</body>

</html>
